<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Camera Control Panel</title>
  <style>
    /* æ·±è‰²ä¸»é¢˜ - Cursoré£æ ¼ */
    :root {
      --bg-primary: #1e1e1e;
      --bg-secondary: #252526;
      --bg-tertiary: #2d2d30;
      --bg-hover: #3c3c3c;
      --text-primary: #cccccc;
      --text-secondary: #9cdcfe;
      --border-color: #3e3c42;
      --accent-color: #007acc;
      --accent-hover: #005a9e;
      --success-color: #4ec9b0;
      --warning-color: #dcdcaa;

      /* å†å²è®°å½•å˜æš—é¢œè‰² */
      --history-bg: var(--bg-tertiary);
      --history-text: #8a8a8a;
      --history-timestamp: #555555;
      --history-url-bg: var(--bg-primary);
      --history-url-text: #999999;
      --history-button-border: #666666;
      --history-button-text: #666666;
      --history-data-bg: var(--bg-primary);
      --history-data-text: #999999;

      /* å†å²è®°å½•çŠ¶æ€é¢œè‰² */
      --history-success-border: #2d5a4e;
      --history-error-border: #5a2d2d;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      margin: 0;
      padding: 0;
      line-height: 1.6;
      overflow-x: hidden;
    }

    .main-container {
      display: flex;
      gap: 20px;
      max-width: 1400px;
      margin: 20px auto;
      min-height: calc(100vh - 40px);
      align-items: stretch;
    }

    .left-panel {
      flex: 1;
      background: var(--bg-secondary);
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      min-height: 0;
      max-height: calc(100vh - 40px);
      overflow: hidden;
    }

    .right-panel {
      flex: 1;
      background: var(--bg-secondary);
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      min-height: 0;
      max-height: calc(100vh - 40px);
      box-sizing: border-box;
    }

    .title-section {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 30px;
    }

    .title-section h1 {
      font-size: 28px;
      margin: 0;
      color: var(--text-secondary);
      font-weight: 600;
      flex-shrink: 0;
    }

    .github-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: var(--bg-tertiary);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .github-btn:hover {
      background: var(--bg-hover);
      border-color: var(--accent-color);
      color: var(--accent-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .github-icon {
      width: 20px;
      height: 20px;
    }

    .button-group {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .zcam-doc-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: var(--bg-tertiary);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .zcam-doc-btn:hover {
      background: var(--bg-hover);
      border-color: var(--success-color);
      color: var(--success-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .zcam-doc-icon {
      width: 20px;
      height: 20px;
      filter: brightness(0) saturate(100%) invert(70%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(0.9) contrast(0.9);
    }

    .zcam-doc-btn:hover .zcam-doc-icon {
      filter: brightness(0) saturate(100%) invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(1) contrast(1);
    }

    h1 {
      font-size: 28px;
      margin-bottom: 30px;
      color: var(--text-secondary);
      font-weight: 600;
      text-align: center;
      flex-shrink: 0;
    }

    h2 {
      font-size: 20px;
      margin: 25px 0 15px 0;
      color: var(--text-secondary);
      font-weight: 500;
      flex-shrink: 0;
    }

    .ip-section {
      margin-bottom: 20px;
      padding: 20px;
      background: var(--bg-tertiary);
      border-radius: 6px;
      border: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    .ip-section label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-secondary);
      font-weight: 500;
      font-size: 14px;
    }

    .ip-input-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ip-section input {
      flex: 1;
      padding: 10px 14px;
      font-size: 14px;
      border: 2px solid var(--border-color);
      border-radius: 4px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      transition: all 0.2s ease;
      outline: none;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    }

    .ip-section input:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(0, 122, 204, 0.1);
    }

    .camera-admin-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      padding: 0;
      border: 2px solid var(--border-color);
      border-radius: 4px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      outline: none;
      flex-shrink: 0;
    }

    .camera-admin-btn:hover {
      border-color: var(--accent-color);
      background: var(--bg-tertiary);
      transform: translateY(-1px);
    }

    .camera-admin-btn:active {
      transform: translateY(0);
    }

    .camera-admin-icon {
      width: 20px;
      height: 20px;
    }



    .search-section {
      margin-bottom: 30px;
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      overflow: visible;
      /* å…è®¸å†å²è®°å½•é¢æ¿æº¢å‡ºæ˜¾ç¤º */
    }

    input {
      width: 100%;
      padding: 12px 16px;
      font-size: 16px;
      border: 2px solid var(--border-color);
      border-radius: 6px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      transition: all 0.2s ease;
      outline: none;
      flex-shrink: 0;
    }

    input:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(0, 122, 204, 0.1);
    }

    input::placeholder {
      color: #6a6a6a;
    }

    /* ç¦ç”¨æµè§ˆå™¨é»˜è®¤çš„å†å²è®°å½•ä¸‹æ‹‰ç®­å¤´ */
    input::-webkit-calendar-picker-indicator {
      display: none !important;
    }

    input::-webkit-list-button {
      display: none !important;
    }

    .results-container {
      margin-top: 20px;
      flex: 1;
      min-height: 0;
      max-height: none;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      min-height: 100px;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      min-height: 0;
      max-height: none;
    }

    li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      border: 1px solid var(--border-color);
      margin-bottom: 8px;
      background: var(--bg-tertiary);
      border-radius: 6px;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    li:hover {
      background: var(--bg-hover);
      border-color: var(--accent-color);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    li span {
      cursor: pointer;
      flex: 1;
      color: var(--text-primary);
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 14px;
    }

    li span:hover {
      color: var(--text-secondary);
    }

    .copy-btn {
      margin-left: 12px;
      padding: 6px 12px;
      border: 1px solid var(--accent-color);
      background: var(--bg-tertiary);
      color: var(--accent-color);
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .copy-btn:hover {
      background: var(--accent-color);
      color: white;
      transform: translateY(-1px);
    }

    .open-btn {
      margin-left: 8px;
      padding: 6px 12px;
      border: 1px solid var(--success-color);
      background: var(--bg-tertiary);
      color: var(--success-color);
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .open-btn:hover {
      background: var(--success-color);
      color: #000;
      transform: translateY(-1px);
    }

    .favorites {
      margin-top: auto;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    #fav-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: flex-start;
    }

    .favorites button {
      margin: 0;
      padding: 10px 18px;
      font-size: 14px;
      border: 2px solid var(--accent-color);
      background: var(--bg-tertiary);
      color: var(--accent-color);
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .favorites button:hover {
      background: var(--accent-color);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 122, 204, 0.3);
    }

    .no-results {
      text-align: center;
      color: #6a6a6a;
      font-style: italic;
      padding: 20px;
    }

    .response-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
      flex-shrink: 0;
      box-sizing: border-box;
    }

    .clear-btn {
      padding: 6px 12px;
      border: 1px solid var(--warning-color);
      background: var(--bg-tertiary);
      color: var(--warning-color);
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .clear-btn:hover {
      background: var(--warning-color);
      color: #000;
    }

    .response-content {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 20px;
      min-height: 200px;
      flex: 1;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
      overflow-y: auto;
      overflow-x: hidden;
    }

    /* å‘½ä»¤å“åº”é¡¹æ ·å¼ */
    .response-item {
      margin-bottom: 20px;
      padding: 15px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      border-left: 4px solid var(--accent-color);
      transition: all 0.3s ease;
    }

    .response-item:last-child {
      margin-bottom: 0;
    }

    /* æœ€æ–°æ‰§è¡Œçš„å‘½ä»¤ - é«˜äº®æ˜¾ç¤º */
    .response-item:first-child {
      background: var(--bg-secondary);
      border-color: var(--accent-color);
      box-shadow: 0 2px 8px rgba(0, 122, 204, 0.2);
    }

    /* å†å²è®°å½•å‘½ä»¤ - å˜æš—æ˜¾ç¤º */
    .response-item:not(:first-child) {
      background: var(--history-bg);
      border-color: var(--border-color);
      opacity: 0.7;
    }

    .response-item:not(:first-child):hover {
      opacity: 0.9;
      background: var(--bg-secondary);
    }

    .response-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-color);
    }

    .response-command-name {
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 14px;
    }

    /* å†å²è®°å½•çš„å‘½ä»¤åç§°å˜æš— */
    .response-item:not(:first-child) .response-command-name {
      color: var(--history-text);
    }

    .response-timestamp {
      font-size: 11px;
      color: #6a6a6a;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    }

    /* å†å²è®°å½•çš„æ—¶é—´æˆ³æ›´æš— */
    .response-item:not(:first-child) .response-timestamp {
      color: var(--history-timestamp);
    }

    .response-url {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 11px;
      color: var(--text-primary);
      background: var(--bg-tertiary);
      padding: 8px;
      border-radius: 4px;
      border: 1px solid var(--border-color);
      word-break: break-all;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    /* å†å²è®°å½•çš„URLèƒŒæ™¯æ›´æš— */
    .response-item:not(:first-child) .response-url {
      background: var(--history-url-bg);
      color: var(--history-url-text);
    }

    .response-url-text {
      flex: 1;
      word-break: break-all;
    }

    .response-copy-url-btn {
      flex-shrink: 0;
      padding: 4px 6px;
      border: 1px solid var(--accent-color);
      background: var(--bg-secondary);
      color: var(--accent-color);
      border-radius: 3px;
      cursor: pointer;
      font-size: 10px;
      font-weight: 500;
      transition: all 0.2s ease;
      min-width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .response-copy-url-btn:hover {
      background: var(--accent-color);
      color: white;
      transform: translateY(-1px);
    }

    /* å†å²è®°å½•çš„å¤åˆ¶æŒ‰é’®å˜æš— */
    .response-item:not(:first-child) .response-copy-url-btn {
      border-color: var(--history-button-border);
      color: var(--history-button-text);
      background: var(--history-url-bg);
    }

    .response-item:not(:first-child) .response-copy-url-btn:hover {
      border-color: var(--accent-color);
      color: var(--accent-color);
      background: var(--bg-secondary);
    }

    .response-data {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.4;
      max-height: 200px;
      overflow-y: auto;
      padding: 10px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      border: 1px solid var(--border-color);
    }

    /* å†å²è®°å½•çš„å“åº”æ•°æ®èƒŒæ™¯æ›´æš— */
    .response-item:not(:first-child) .response-data {
      background: var(--history-data-bg);
      color: var(--history-data-text);
    }

    .response-data pre {
      margin: 0;
      font-family: inherit;
      font-size: inherit;
      line-height: inherit;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    /* æˆåŠŸçŠ¶æ€ - æœ€æ–°å‘½ä»¤ */
    .response-item:first-child.response-success {
      border-left-color: var(--success-color);
      box-shadow: 0 2px 8px rgba(78, 201, 176, 0.2);
    }

    /* å¤±è´¥çŠ¶æ€ - æœ€æ–°å‘½ä»¤ */
    .response-item:first-child.response-error {
      border-left-color: #ff6b6b;
      box-shadow: 0 2px 8px rgba(255, 107, 107, 0.2);
    }

    /* æˆåŠŸçŠ¶æ€ - å†å²è®°å½• */
    .response-item:not(:first-child).response-success {
      border-left-color: var(--history-success-border);
      background: var(--history-bg);
    }

    /* å¤±è´¥çŠ¶æ€ - å†å²è®°å½• */
    .response-item:not(:first-child).response-error {
      border-left-color: var(--history-error-border);
      background: var(--history-bg);
    }

    .response-loading {
      border-left-color: var(--accent-color);
      opacity: 0.8;
    }

    .no-response {
      text-align: center;
      color: #6a6a6a;
      font-style: italic;
      padding: 40px 20px;
    }

    .response-loading {
      text-align: center;
      color: var(--text-secondary);
      padding: 40px 20px;
    }

    .response-error {
      color: #ff6b6b;
      padding: 20px;
      border: 1px solid #ff6b6b;
      border-radius: 4px;
      background: rgba(255, 107, 107, 0.1);
    }

    .response-success {
      color: var(--success-color);
    }

    .command-path-section {
      margin-top: 20px;
      padding: 20px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
    }

    .command-path-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-weight: 500;
    }

    .copy-path-btn {
      padding: 4px 10px;
      border: 1px solid var(--accent-color);
      background: var(--bg-secondary);
      color: var(--accent-color);
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .copy-path-btn:hover {
      background: var(--accent-color);
      color: white;
    }

    .command-path-text {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      color: var(--text-primary);
      background: var(--bg-secondary);
      padding: 12px;
      border-radius: 4px;
      border: 1px solid var(--border-color);
      word-break: break-all;
      line-height: 1.4;
    }

    .history-section {
      margin-top: 20px;
      padding: 20px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      max-height: 400px;
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-weight: 500;
    }

    .clear-history-btn {
      padding: 4px 10px;
      border: 1px solid var(--warning-color);
      background: var(--bg-secondary);
      color: var(--warning-color);
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .clear-history-btn:hover {
      background: var(--warning-color);
      color: #000;
    }

    .history-content {
      max-height: 300px;
      overflow-y: auto;
      padding-right: 5px;
    }

    .history-item {
      margin-bottom: 20px;
      padding: 15px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      border-left: 4px solid var(--accent-color);
    }

    .history-item:last-child {
      margin-bottom: 0;
    }

    .history-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-color);
    }

    .history-command-name {
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .history-timestamp {
      font-size: 11px;
      color: #6a6a6a;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    }

    .history-url {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 11px;
      color: var(--text-primary);
      background: var(--bg-tertiary);
      padding: 8px;
      border-radius: 4px;
      border: 1px solid var(--border-color);
      word-break: break-all;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .history-url-text {
      flex: 1;
      word-break: break-all;
    }

    .history-copy-url-btn {
      flex-shrink: 0;
      padding: 4px 6px;
      border: 1px solid var(--accent-color);
      background: var(--bg-secondary);
      color: var(--accent-color);
      border-radius: 3px;
      cursor: pointer;
      font-size: 10px;
      font-weight: 500;
      transition: all 0.2s ease;
      min-width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .history-copy-url-btn:hover {
      background: var(--accent-color);
      color: white;
      transform: translateY(-1px);
    }

    .history-response {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.4;
      max-height: 200px;
      overflow-y: auto;
      padding: 10px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      border: 1px solid var(--border-color);
    }

    .history-response pre {
      margin: 0;
      font-family: inherit;
      font-size: inherit;
      line-height: inherit;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .history-success {
      border-left-color: var(--success-color);
    }

    .history-error {
      border-left-color: #ff6b6b;
    }

    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
    .history-content::-webkit-scrollbar,
    .history-response::-webkit-scrollbar,
    .response-content::-webkit-scrollbar,
    .results-container ul::-webkit-scrollbar {
      width: 8px;
    }

    .history-content::-webkit-scrollbar-track,
    .history-response::-webkit-scrollbar-track,
    .response-content::-webkit-scrollbar-track,
    .results-container ul::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
      border-radius: 4px;
    }

    .history-content::-webkit-scrollbar-thumb,
    .history-response::-webkit-scrollbar-thumb,
    .response-content::-webkit-scrollbar-thumb,
    .results-container ul::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 4px;
    }

    .history-content::-webkit-scrollbar-thumb:hover,
    .history-response::-webkit-scrollbar-thumb:hover,
    .response-content::-webkit-scrollbar-thumb:hover,
    .results-container ul::-webkit-scrollbar-thumb:hover {
      background: var(--accent-color);
    }

    /* æœç´¢å†å²è®°å½•æ ·å¼ */
    .search-history-container {
      position: relative;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      margin-top: 5px;
      margin-bottom: 15px;
      overflow: visible;
      /* æ”¹ä¸ºvisibleï¼Œç¡®ä¿å†…å®¹ä¸è¢«æˆªæ–­ */
      height: auto;
      min-height: 300px;
      /* è®¾ç½®æœ€å°é«˜åº¦ï¼Œç¡®ä¿å®¹å™¨æœ‰è¶³å¤Ÿç©ºé—´ */
      max-height: 400px;
      /* è®¾ç½®æœ€å¤§é«˜åº¦é™åˆ¶ */
      /* ç¡®ä¿å®½åº¦å˜åŒ–æ—¶å¸ƒå±€ç¨³å®š */
      min-width: 200px;
      width: 100%;
      box-sizing: border-box;
      /* å¼ºåˆ¶æ˜¾ç¤ºæ‰€æœ‰å†…å®¹ */
      display: block;
    }

    .search-history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid var(--border-color);
      background: var(--bg-tertiary);
    }

    .search-history-header span {
      color: var(--text-secondary);
      font-weight: 500;
      font-size: 14px;
    }

    .search-history-header .clear-history-btn {
      background: none;
      border: none;
      color: var(--warning-color);
      cursor: pointer;
      font-size: 16px;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .search-history-header .clear-history-btn:hover {
      background: var(--bg-hover);
      transform: scale(1.1);
    }

    .search-history-list {
      max-height: 250px;
      /* æ”¹ä¸ºmax-heightï¼Œå…è®¸è‡ªé€‚åº” */
      overflow-y: auto;
      overflow-x: hidden;
      padding-right: 8px;
      /* ä¸ºæ»šåŠ¨æ¡é¢„ç•™ç©ºé—´ */
      /* å¼ºåˆ¶æ˜¾ç¤ºæ»šåŠ¨æ¡è½¨é“ï¼Œå³ä½¿å†…å®¹ä¸éœ€è¦æ»šåŠ¨ */
      scrollbar-width: thin;
      /* Firefox */
      scrollbar-color: var(--border-color) var(--bg-tertiary);
      /* Firefox */
      /* ç¡®ä¿å†…å®¹èƒ½æ­£ç¡®æ˜¾ç¤º */
      min-height: 200px;
      /* è®¾ç½®æœ€å°é«˜åº¦ */
      /* ç¡®ä¿å®½åº¦å˜åŒ–æ—¶å¸ƒå±€ç¨³å®š */
      width: 100%;
      box-sizing: border-box;
      /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œå½±å“é«˜åº¦è®¡ç®— */
      word-wrap: break-word;
      overflow-wrap: break-word;
      /* å¼ºåˆ¶æ˜¾ç¤ºå†…å®¹ */
      display: block;
      height: auto;
    }

    .search-history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      border-bottom: 1px solid var(--border-color);
      /* ç¡®ä¿å®½åº¦å˜åŒ–æ—¶å¸ƒå±€ç¨³å®š */
      width: 100%;
      box-sizing: border-box;
      /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œå½±å“é«˜åº¦ */
      min-height: 46px;
      flex-shrink: 0;
    }

    .search-history-item:last-child {
      border-bottom: none;
    }

    .search-history-item:hover {
      background: var(--bg-hover);
    }

    .search-history-item .history-text {
      color: var(--text-primary);
      font-size: 14px;
      flex: 1;
      /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œå½±å“é«˜åº¦è®¡ç®— */
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      min-width: 0;
    }

    .search-history-item .remove-history-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 18px;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.2s ease;
      opacity: 0.7;
    }

    .search-history-item .remove-history-btn:hover {
      background: rgba(255, 107, 107, 0.2);
      color: #ff6b6b;
      opacity: 1;
    }

    /* æœç´¢æ¡†å®¹å™¨ç›¸å¯¹å®šä½ */
    .search-section {
      position: relative;
      display: flex;
      flex-direction: column;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
        margin: 10px;
      }

      .left-panel,
      .right-panel {
        padding: 20px;
      }

      input {
        font-size: 16px;
        /* é˜²æ­¢iOSç¼©æ”¾ */
      }
    }

    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ - ç¡®ä¿æœç´¢å†å²åˆ—è¡¨çš„æ»šåŠ¨æ¡å¯è§ */
    .search-history-list::-webkit-scrollbar {
      width: 8px;
      /* å³ä½¿å†…å®¹ä¸éœ€è¦æ»šåŠ¨ï¼Œä¹Ÿæ˜¾ç¤ºæ»šåŠ¨æ¡è½¨é“ */
      display: block;
    }

    .search-history-list::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
      border-radius: 4px;
      /* ç¡®ä¿è½¨é“å§‹ç»ˆå¯è§ */
      min-height: 100px;
    }

    .search-history-list::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 4px;
      /* å³ä½¿å†…å®¹ä¸éœ€è¦æ»šåŠ¨ï¼Œä¹Ÿæ˜¾ç¤ºæ»šåŠ¨æ¡æ»‘å— */
      min-height: 20px;
    }

    .search-history-list::-webkit-scrollbar-thumb:hover {
      background: var(--accent-color);
    }

    /* å½“å†…å®¹ä¸éœ€è¦æ»šåŠ¨æ—¶ï¼Œä»ç„¶æ˜¾ç¤ºæ»šåŠ¨æ¡è½¨é“ */
    .search-history-list::-webkit-scrollbar-thumb:disabled {
      background: var(--border-color);
      opacity: 0.5;
    }

    /* å¼ºåˆ¶æ˜¾ç¤ºæ»šåŠ¨æ¡ï¼Œå½“å†…å®¹è¶…å‡ºæ—¶ */
    .search-history-list.force-scroll::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      opacity: 1;
    }

    .search-history-list.force-scroll::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
      opacity: 1;
    }
  </style>

  <!-- å¤šè¯­è¨€é…ç½® -->
  <script>
    // è¯­è¨€é…ç½®
    const i18n = {
      zh: {
        // UIç•Œé¢æ–‡æœ¬
        ui_title: "ğŸ“· ZCAM Camera Http Commands",
        ui_iplabel: "ğŸŒ ç›®æ ‡IPåœ°å€:",
        ui_ip_placeholder: "192.168.1.100",
        ui_search_placeholder: "è¾“å…¥å…³é”®å­—æœç´¢å‘½ä»¤ï¼Œæˆ–'?' åˆ—å‡ºæ‰€æœ‰å‘½ä»¤",
        ui_favorites_title: "ğŸš€ å¸¸ç”¨å‘½ä»¤",
        ui_response_title: "ğŸ“¡ å‘½ä»¤å“åº”",
        ui_clear_btn: "æ¸…ç©º",
        ui_no_response: "æ‰§è¡Œå·¦ä¾§httpå‘½ä»¤æŸ¥çœ‹å“åº”",

        // æŒ‰é’®æ–‡æœ¬
        ui_btn_copy: "å¤åˆ¶",
        ui_btn_open: "æ‰“å¼€",
        ui_btn_executing: "æ‰§è¡Œä¸­...",

        // æœç´¢å†å²ç›¸å…³
        ui_history_title: "ğŸ” æœç´¢å†å²",
        ui_history_clear_btn: "ğŸ—‘ï¸",
        ui_history_remove_btn: "Ã—",
        ui_history_clear_tooltip: "æ¸…ç©ºæœç´¢å†å²",
        ui_history_remove_tooltip: "åˆ é™¤æ­¤æ¡å†å²",

        // çŠ¶æ€å’Œæ¶ˆæ¯
        ui_msg_executing: "ğŸ”„ æ­£åœ¨æ‰§è¡Œå‘½ä»¤...",
        ui_msg_no_results: "æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å‘½ä»¤",
        ui_msg_copied: "âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿",
        ui_msg_copy_failed: "å¤åˆ¶å¤±è´¥: ",
        ui_msg_parameters_required: "æ­¤å‘½ä»¤éœ€è¦å¡«å†™ä»¥ä¸‹å‚æ•°æ‰èƒ½æ‰§è¡Œï¼š",
        ui_msg_parameters_instruction: "è¯·å°†URLä¸­çš„å‚æ•°å ä½ç¬¦æ›¿æ¢ä¸ºå®é™…å€¼ã€‚",
        ui_msg_warning_command: "âš ï¸è­¦å‘Š",
        ui_msg_warning_command_desc: "æ‚¨å³å°†æ‰§è¡Œä¸€ä¸ªé‡è¦çš„å‘½ä»¤ï¼š",
        ui_msg_warning_command_confirm: "è¯·ç¡®è®¤æ˜¯å¦ç»§ç»­ï¼Ÿ",
        ui_msg_btn_confirm: "ç¡®è®¤æ‰§è¡Œ",
        ui_msg_btn_cancel: "å–æ¶ˆ",
        ui_github_btn_title: "åœ¨GitHubä¸ŠæŸ¥çœ‹",
        ui_zcam_doc_btn_title: "æŸ¥çœ‹ZCAM HTTP APIæ–‡æ¡£",
        ui_camera_admin_btn_title: "æ‰“å¼€ç›¸æœºåå°æ§åˆ¶",

        // é”™è¯¯ä¿¡æ¯
        ui_error_http: "âŒ HTTPé”™è¯¯: ",
        ui_error_timeout: "â° è¯·æ±‚è¶…æ—¶: è¿æ¥è¶…æ—¶ (",
        ui_error_timeout_suffix: "ç§’)ï¼Œç›¸æœºIPåœ°å€é”™è¯¯æˆ–ç›¸æœºæœªå¼€æœº",
        ui_error_network: "âŒ ç½‘ç»œé”™è¯¯: ",
        ui_error_commands_not_loaded: "é”™è¯¯ï¼šæ— æ³•åŠ è½½å‘½ä»¤æ•°æ®",
        ui_error_favorites_not_loaded: "é”™è¯¯ï¼šæ— æ³•åŠ è½½æ”¶è—æ•°æ®",
        ui_error_check_commands_file: "è¯·æ£€æŸ¥commands.jsæ–‡ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½",

        // å…¶ä»–æ–‡æœ¬
        ui_custom_command: "Custom Command",
        ui_copy_url_tooltip: "å¤åˆ¶é“¾æ¥åœ°å€",

        // è°ƒè¯•ä¿¡æ¯
        debug_language_detected: "æ£€æµ‹åˆ°è¯­è¨€",
        debug_container_status: "å®¹å™¨çŠ¶æ€æ£€æŸ¥",
        debug_container_element: "å®¹å™¨å…ƒç´ ",
        debug_container_height: "å®¹å™¨é«˜åº¦",
        debug_container_style: "å®¹å™¨æ ·å¼",
        debug_list_element: "åˆ—è¡¨å…ƒç´ ",
        debug_list_height: "åˆ—è¡¨é«˜åº¦",
        debug_height_calculation: "é«˜åº¦è®¡ç®—è¯Šæ–­",
        debug_panel_width: "é¢æ¿å®½åº¦",
        debug_header_height: "å¤´éƒ¨é«˜åº¦",
        debug_item_count: "åˆ—è¡¨é¡¹æ•°é‡",
        debug_item_height: "æ¯ä¸ªé¡¹ç›®é«˜åº¦",
        debug_total_height: "åˆ—è¡¨é¡¹æ€»é«˜åº¦",
        debug_actual_height: "å®é™…éœ€è¦æ€»é«˜åº¦",
        debug_available_space: "å¯ç”¨ç©ºé—´",
        debug_search_bottom: "æœç´¢æ¡†åº•éƒ¨ä½ç½®",
        debug_favorites_top: "å¸¸ç”¨å‘½ä»¤é¡¶éƒ¨ä½ç½®",
        debug_url_test: "URLç»„åˆæµ‹è¯•",
        debug_input: "è¾“å…¥",
        debug_output: "è¾“å‡º",

        // æ—¶é—´æˆ³æœ¬åœ°åŒ–
        timestamp_locale_zh: "zh-CN",
        timestamp_locale_en: "en-US"
      },

      en: {
        // UI Interface Text
        ui_title: "ğŸ“· ZCAM Camera Http Commands",
        ui_iplabel: "ğŸŒ Target IP Address:",
        ui_ip_placeholder: "192.168.1.100",
        ui_search_placeholder: "Enter keywords to search commands, or '?' to list all commands",
        ui_favorites_title: "ğŸš€ Favorite Commands",
        ui_response_title: "ğŸ“¡ Command Response",
        ui_clear_btn: "Clear",
        ui_no_response: "Execute the http command on the left to view the response",

        // Button Text
        ui_btn_copy: "Copy",
        ui_btn_open: "Open",
        ui_btn_executing: "Executing...",

        // Search History Related
        ui_history_title: "ğŸ” Search History",
        ui_history_clear_btn: "ğŸ—‘ï¸",
        ui_history_remove_btn: "Ã—",
        ui_history_clear_tooltip: "Clear search history",
        ui_history_remove_tooltip: "Delete this history item",

        // Status and Messages
        ui_msg_executing: "ğŸ”„ Executing command...",
        ui_msg_no_results: "No matching commands found",
        ui_msg_copied: "âœ… Copied to clipboard",
        ui_msg_copy_failed: "Copy failed: ",
        ui_msg_parameters_required: "This command requires the following parameters to execute:",
        ui_msg_parameters_instruction: "Please replace the parameter placeholders in the URL with actual values.",
        ui_msg_warning_command: "âš ï¸Warning",
        ui_msg_warning_command_desc: "You are about to execute an important command:",
        ui_msg_warning_command_confirm: "Do you want to continue?",
        ui_msg_btn_confirm: "Confirm",
        ui_msg_btn_cancel: "Cancel",
        ui_github_btn_title: "View on GitHub",
        ui_zcam_doc_btn_title: "View ZCAM Http API Doc",
        ui_camera_admin_btn_title: "Open Camera Admin Panel",

        // Error Messages
        ui_error_http: "âŒ HTTP Error: ",
        ui_error_timeout: "â° Request Timeout: Connection timeout (",
        ui_error_timeout_suffix: " seconds), camera IP address error or camera not powered on",
        ui_error_network: "âŒ Network Error: ",
        ui_error_commands_not_loaded: "Error: Failed to load command data",
        ui_error_favorites_not_loaded: "Error: Failed to load favorites data",
        ui_error_check_commands_file: "Please check if commands.js file is loaded correctly",

        // Other Text
        ui_custom_command: "Custom Command",
        ui_copy_url_tooltip: "Copy link address",

        // Debug Information
        debug_language_detected: "Language detected",
        debug_container_status: "Container Status Check",
        debug_container_element: "Container Element",
        debug_container_height: "Container Height",
        debug_container_style: "Container Style",
        debug_list_element: "List Element",
        debug_list_height: "List Height",
        debug_height_calculation: "Height Calculation Diagnosis",
        debug_panel_width: "Panel Width",
        debug_header_height: "Header Height",
        debug_item_count: "Item Count",
        debug_item_height: "Item Height",
        debug_total_height: "Total Item Height",
        debug_actual_height: "Actual Required Height",
        debug_available_space: "Available Space",
        debug_search_bottom: "Search Input Bottom Position",
        debug_favorites_top: "Favorites Top Position",
        debug_url_test: "URL Combination Test",
        debug_input: "Input",
        debug_output: "Output",

        // Timestamp Localization
        timestamp_locale_zh: "zh-CN",
        timestamp_locale_en: "en-US"
      }
    };

    // è¯­è¨€æ£€æµ‹å’Œè®¾ç½®
    function detectLanguage() {
      const browserLang = navigator.language || navigator.userLanguage;
      const langCode = browserLang.toLowerCase().startsWith('zh') ? 'zh' : 'en';

      // è®¾ç½®HTML langå±æ€§
      document.documentElement.lang = langCode;

      // è®¾ç½®é¡µé¢æ ‡é¢˜
      document.title = i18n[langCode].ui_title;

      return langCode;
    }

    // è·å–å½“å‰è¯­è¨€
    function getCurrentLanguage() {
      return document.documentElement.lang || 'en';
    }

    // è·å–ç¿»è¯‘æ–‡æœ¬
    function t(key) {
      const lang = getCurrentLanguage();
      return i18n[lang][key] || i18n.en[key] || key;
    }

    // è·å–å½“å‰è¯­è¨€çš„æ—¶é—´æˆ³æœ¬åœ°åŒ–è®¾ç½®
    function getTimestampLocale() {
      const lang = getCurrentLanguage();
      return i18n[lang].timestamp_locale_zh || i18n.en.timestamp_locale_en || 'en-US';
    }

    // åº”ç”¨è¯­è¨€åˆ°é¡µé¢
    function applyLanguage() {
      // å¤„ç†æ‰€æœ‰å¸¦æœ‰ data-i18n å±æ€§çš„å…ƒç´ 
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (key) {
          element.textContent = t(key);
        }
      });

      // å¤„ç†æ‰€æœ‰å¸¦æœ‰ data-i18n-placeholder å±æ€§çš„å…ƒç´ 
      document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (key) {
          element.placeholder = t(key);
        }
      });

      // å¤„ç†æ‰€æœ‰å¸¦æœ‰ data-i18n-title å±æ€§çš„å…ƒç´ 
      document.querySelectorAll('[data-i18n-title]').forEach(element => {
        const key = element.getAttribute('data-i18n-title');
        if (key) {
          element.title = t(key);
        }
      });
    }
  </script>
</head>

<body>
  <div class="main-container">
    <div class="left-panel">
      <div class="title-section">
        <h1 data-i18n="ui_title">ğŸ“· ZCam Http Commands</h1>
        <div class="button-group">
          <a href="https://github.com/Jack-vexel-ws/zcamhttp" id="github-link" class="github-btn" title="View on GitHub" target="_blank">
            <svg class="github-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
          </a>
          <a href="https://github.com/imaginevision/Z-Camera-Doc/blob/master/E2/protocol/http/http.md" id="zcam-doc-btn" class="zcam-doc-btn" title="View ZCAM Http API Doc" target="_blank">
            <img src="images/zcam_icon.svg" class="zcam-doc-icon" alt="ZCAM Icon">
          </a>
        </div>
      </div>

      <!-- IPåœ°å€è¾“å…¥æ¡† -->
      <div class="ip-section">
        <label for="ip-input" data-i18n="ui_iplabel">ğŸŒ ç›®æ ‡IPåœ°å€:</label>
        <div class="ip-input-container">
          <input type="text" id="ip-input" placeholder="192.168.1.100" value="192.168.1.100">
          <button id="camera-admin-btn" class="camera-admin-btn" data-i18n-title="ui_camera_admin_btn_title" onclick="openCameraAdmin()">
            <svg class="camera-admin-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- æœç´¢æ¡† -->
      <div class="search-section">
        <input type="text" id="search" data-i18n-placeholder="ui_search_placeholder"
          placeholder="è¾“å…¥å…³é”®å­—æœç´¢å‘½ä»¤ï¼Œæˆ–ç‚¹å‡»æœç´¢ç»“æœå°†URLå¡«å…¥æ­¤å¤„ï¼ŒæŒ‰å›è½¦æ‰§è¡Œ" autocomplete="off">
        <div class="results-container">
          <ul id="results"></ul>
        </div>
      </div>

      <!-- å¸¸ç”¨å‘½ä»¤æŒ‰é’® -->
      <div class="favorites">
        <h2 data-i18n="ui_favorites_title">ğŸš€ å¸¸ç”¨å‘½ä»¤</h2>
        <div id="fav-buttons"></div>
      </div>
    </div>

    <!-- å³ä¾§å“åº”æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="right-panel">
      <div class="response-header">
        <h2 data-i18n="ui_response_title">ğŸ“¡ å‘½ä»¤å“åº”</h2>
        <button id="clear-response" class="clear-btn" data-i18n="ui_clear_btn">æ¸…ç©º</button>
      </div>
      <div id="response-content" class="response-content">
        <div class="no-response" data-i18n="ui_no_response">ç‚¹å‡»å·¦ä¾§å‘½ä»¤é“¾æ¥æŸ¥çœ‹å“åº”</div>
      </div>
    </div>
  </div>

  <script src="commands.js"></script>
  <script>
    // æ·»åŠ é”™è¯¯å¤„ç†å’Œè°ƒè¯•ä¿¡æ¯
    console.log("HTML page loading started");

    // æ£€æµ‹å¹¶è®¾ç½®è¯­è¨€
    const currentLang = detectLanguage();
    console.log(t("debug_language_detected") + ":", currentLang);

    // æ£€æŸ¥commandså’Œfavoriteså˜é‡æ˜¯å¦å·²åŠ è½½
    if (typeof commands === 'undefined') {
      console.error("commands variable is undefined!");
      document.body.innerHTML = '<h1>' + t('ui_error_commands_not_loaded') + '</h1><p>' + t('ui_error_check_commands_file') + '</p>';
      throw new Error("commands variable is undefined");
    }

    if (typeof favorites === 'undefined') {
      console.error("favorites variable is undefined!");
      document.body.innerHTML = '<h1>' + t('ui_error_favorites_not_loaded') + '</h1><p>' + t('ui_error_check_commands_file') + '</p>';
      throw new Error("favorites variable is undefined");
    }

    console.log("Variable check passed, starting page initialization");

    // IPåœ°å€æœ¬åœ°å­˜å‚¨ç®¡ç†
    const IP_STORAGE_KEY = 'zcamLastIP';
    const DEFAULT_IP = '192.168.1.100';

    const ipInput = document.getElementById("ip-input");
    const input = document.getElementById("search");
    const results = document.getElementById("results");
    const favButtons = document.getElementById("fav-buttons");
    const responseContent = document.getElementById("response-content");
    const clearResponseBtn = document.getElementById("clear-response");

    // åˆå§‹åŒ–IPåœ°å€è¾“å…¥æ¡†
    const savedIP = loadIPFromStorage();
    ipInput.value = savedIP;
    console.log('IP input initialized with:', savedIP);

    // æœç´¢å†å²è®°å½•ç®¡ç†
    let searchHistory = JSON.parse(localStorage.getItem('zcamSearchHistory') || '[]');
    const maxHistoryItems = 10; // Maximum 10 search history items

    // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œæ·»åŠ ä¸€äº›ç¤ºä¾‹URLè®°å½•ç”¨äºæµ‹è¯•
    if (searchHistory.length === 0) {
      const currentIP = getCurrentIP();
      searchHistory = [
        `http://${currentIP}/battery`,
        `http://${currentIP}/zoom`,
        `http://${currentIP}/status`
      ];
      localStorage.setItem('zcamSearchHistory', JSON.stringify(searchHistory));
      console.log('Added sample URL history records');
    }

    console.log('Initializing search history:', searchHistory);

    // Get current IP address
    function getCurrentIP() {
      return ipInput.value.trim() || DEFAULT_IP;
    }

    // ä¿å­˜IPåœ°å€åˆ°æœ¬åœ°å­˜å‚¨
    function saveIPToStorage(ip) {
      if (ip && ip.trim() !== '') {
        localStorage.setItem(IP_STORAGE_KEY, ip.trim());
        console.log('IP address saved to storage:', ip.trim());
      }
    }

    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½IPåœ°å€
    function loadIPFromStorage() {
      const savedIP = localStorage.getItem(IP_STORAGE_KEY);
      if (savedIP && savedIP.trim() !== '') {
        console.log('IP address loaded from storage:', savedIP);
        return savedIP.trim();
      }
      console.log('No saved IP found, using default:', DEFAULT_IP);
      return DEFAULT_IP;
    }

    // æ·»åŠ æœç´¢å†å²è®°å½• - åªä¿å­˜å®Œæ•´çš„HTTP URL
    function addSearchHistory(query) {
      console.log('addSearchHistory called, query:', query);
      if (query.trim() === "" || query === "?" || query === "ï¼Ÿ") {
        console.log('Skipping invalid query');
        return;
      }

      // åªä¿å­˜å®Œæ•´çš„HTTP URLï¼Œä¸ä¿å­˜å…³é”®å­—æˆ–å‘½ä»¤æè¿°
      if (!query.startsWith('http://') && !query.startsWith('https://')) {
        console.log('Skipping non-URL query, only saving complete HTTP URLs');
        return;
      }

      // Remove duplicates
      searchHistory = searchHistory.filter(item => item !== query);

      // Add to beginning
      searchHistory.unshift(query);

      // Limit history count
      if (searchHistory.length > maxHistoryItems) {
        searchHistory = searchHistory.slice(0, maxHistoryItems);
      }

      // Save to local storage
      localStorage.setItem('zcamSearchHistory', JSON.stringify(searchHistory));
      console.log('Search history updated, current history:', searchHistory);
    }

    // æ˜¾ç¤ºæœç´¢å†å²è®°å½•
    function showSearchHistory() {
      console.log('showSearchHistory called, history count:', searchHistory.length);
      if (searchHistory.length === 0) {
        console.log('No search history records');
        return;
      }

      const historyContainer = document.createElement('div');
      historyContainer.className = 'search-history-container';

      // è·å–å½“å‰IPåœ°å€
      const currentIP = getCurrentIP();

      // Process history records, replace IP address if it's a complete URL
      const processedHistory = searchHistory.map(item => {
        if (item.startsWith('http://') || item.startsWith('https://')) {
          // Is complete URL, replace IP address
          const updatedURL = replaceIPInURL(item, currentIP);
          console.log(`History URL updated: ${item} -> ${updatedURL}`);
          return updatedURL;
        }
        // Not a URL, keep as is
        return item;
      });

      historyContainer.innerHTML = `
           <div class="search-history-header">
             <span>${t('ui_history_title')}</span>
             <button class="clear-history-btn" onclick="clearSearchHistory()" title="${t('ui_history_clear_tooltip')}">${t('ui_history_clear_btn')}</button>
           </div>
          <div class="search-history-list">
            ${processedHistory.map((item, index) => `
              <div class="search-history-item" onclick="selectHistoryItem('${item}', ${index})">
                <span class="history-text">${item}</span>
                <button class="remove-history-btn" onclick="removeHistoryItem('${searchHistory[index]}', event)" title="${t('ui_history_remove_tooltip')}">${t('ui_history_remove_btn')}</button>
              </div>
            `).join('')}
          </div>
        `;

      // Remove existing history container
      const existingHistory = document.querySelector('.search-history-container');
      if (existingHistory) {
        existingHistory.remove();
      }

      // Insert below search box, before results-container
      const searchSection = input.parentNode;
      const resultsContainer = searchSection.querySelector('.results-container');
      searchSection.insertBefore(historyContainer, resultsContainer);

      // Force wait for DOM rendering to complete before calculating height
      setTimeout(() => {
        // Dynamically calculate and set maximum height of history panel
        adjustHistoryPanelHeight(historyContainer);

        // Check container status again
        console.log('=== ' + t('debug_container_status') + ' ===');
        console.log(t('debug_container_element') + ':', historyContainer);
        console.log(t('debug_container_height') + ':', historyContainer.offsetHeight);
        console.log(t('debug_container_style') + ':', getComputedStyle(historyContainer));
        console.log(t('debug_list_element') + ':', historyContainer.querySelector('.search-history-list'));
        console.log(t('debug_list_height') + ':', historyContainer.querySelector('.search-history-list').offsetHeight);

        console.log('Search history displayed');
      }, 100);
    }

    // é€‰æ‹©å†å²è®°å½•é¡¹
    function selectHistoryItem(query, index) {
      // If index is provided, this is a processed URL, need to get original history item
      const originalQuery = index !== undefined ? searchHistory[index] : query;

      // Use processed URL (if query is a URL)
      input.value = query;
      input.focus();

      // Check if it's URL format
      if (query.startsWith('http://') || query.startsWith('https://')) {
        // Is URL, clear search results, wait for user to press Enter
        results.innerHTML = "";
        // å…¨é€‰URLæ–‡æœ¬ï¼Œå°±åƒæµè§ˆå™¨åœ°å€æ é‚£æ ·
        input.select();
      } else if (query === "?" || query === "ï¼Ÿ") {
        // Is question mark, show all commands
        showResults(commands.map(cmd => ({
          ...cmd,
          url: replaceIPInURL(cmd.url, getCurrentIP())
        })));
      } else {
        // Is search keyword, execute search
        showResults(searchCommands(query));
      }

      // Hide history
      hideSearchHistory();
    }

    // åˆ é™¤å•æ¡å†å²è®°å½•
    function removeHistoryItem(query, event) {
      event.stopPropagation();
      searchHistory = searchHistory.filter(item => item !== query);
      localStorage.setItem('zcamSearchHistory', JSON.stringify(searchHistory));

      // Re-display history
      showSearchHistory();
    }

    // æ¸…ç©ºæœç´¢å†å²
    function clearSearchHistory() {
      searchHistory = [];
      localStorage.removeItem('zcamSearchHistory');
      hideSearchHistory();
    }

    // Dynamically adjust history panel height
    function adjustHistoryPanelHeight(historyContainer) {
      if (!historyContainer) return;

      // Get position of favorites section
      const favoritesSection = document.querySelector('.favorites');
      if (!favoritesSection) return;

      // Get position of search input
      const searchInput = document.getElementById('search');
      if (!searchInput) return;

      // Use more stable height calculation method - not dependent on panel width
      const searchInputBottom = searchInput.offsetTop + searchInput.offsetHeight;
      const favoritesTop = favoritesSection.offsetTop;
      const availableHeight = favoritesTop - searchInputBottom - 20; // Subtract 20px margin

      // Get current content height of history panel
      const headerHeight = historyContainer.querySelector('.search-history-header').offsetHeight;
      const listElement = historyContainer.querySelector('.search-history-list');

      // Calculate actual required height - use more stable calculation method
      const historyItems = document.querySelectorAll('.search-history-item');
      const itemHeight = 46; // Base height of each history item
      const totalContentHeight = historyItems.length * itemHeight;

      // Key fix: actual required height = header height + total list item height
      const actualTotalHeight = headerHeight + totalContentHeight;

      // Add width change diagnostic information
      const leftPanel = document.querySelector('.left-panel');
      const panelWidth = leftPanel ? leftPanel.offsetWidth : 'unknown';

      console.log('=== ' + t('debug_height_calculation') + ' ===');
      console.log(t('debug_panel_width') + ':', panelWidth);
      console.log(t('debug_header_height') + ':', headerHeight);
      console.log(t('debug_item_count') + ':', historyItems.length);
      console.log(t('debug_item_height') + ':', itemHeight);
      console.log(t('debug_total_height') + ':', totalContentHeight);
      console.log(t('debug_actual_height') + ':', actualTotalHeight);
      console.log(t('debug_available_space') + ':', availableHeight);
      console.log(t('debug_search_bottom') + ':', searchInputBottom);
      console.log(t('debug_favorites_top') + ':', favoritesTop);

      // Use more stable height calculation strategy
      let calculatedHeight;

      if (availableHeight > actualTotalHeight + 50) {
        // Sufficient space: use actual required height + buffer space
        calculatedHeight = actualTotalHeight + 40;
        console.log('Strategy 1: Sufficient space, use actual required height + buffer');
      } else if (availableHeight > headerHeight + 100) {
        // Limited space: use available space minus header height
        calculatedHeight = availableHeight - headerHeight - 20;
        console.log('Strategy 2: Limited space, use available space minus header height');
      } else {
        // Very limited space: use minimum height, ensure all content can be displayed
        calculatedHeight = Math.max(250, actualTotalHeight + 20);
        console.log('Strategy 3: Very limited space, use minimum height');
      }

      // Set list height
      listElement.style.maxHeight = `${calculatedHeight}px`;
      console.log('Final list height set to:', calculatedHeight);

      // Force apply styles and recalculate layout
      listElement.style.display = 'block';
      listElement.style.height = 'auto';
      listElement.style.minHeight = `${calculatedHeight}px`;

      // Force container to recalculate height
      historyContainer.style.display = 'block';
      historyContainer.style.height = 'auto';
      historyContainer.style.minHeight = `${actualTotalHeight + 20}px`;

      // Force browser to recalculate layout
      listElement.offsetHeight; // Trigger reflow
      historyContainer.offsetHeight; // Trigger reflow
    }


    // éšè—æœç´¢å†å²
    function hideSearchHistory() {
      const historyContainer = document.querySelector('.search-history-container');
      if (historyContainer) {
        historyContainer.remove();
      }
    }

    // Replace IP address in URL
    function replaceIPInURL(url, newIP) {
      // If URL is already complete http:// format, replace IP address
      if (url.startsWith('http://') || url.startsWith('https://')) {
        return url.replace(/http:\/\/[0-9.]+/, `http://${newIP}`);
      }

      // If URL is relative path (starts with /), combine with IP address
      if (url.startsWith('/')) {
        return `http://${newIP}${url}`;
      }

      // If URL is neither complete path nor relative path, add IP address and /
      return `http://${newIP}/${url}`;
    }

    // Test URL combination logic (for development use, can be deleted in production)
    function testURLCombination() {
      const testIP = "192.168.1.100";
      const testCases = [
        "/info",
        "/ctrl/nick_name",
        "/camera_status",
        "http://192.168.1.200/info",
        "relative_path"
      ];

      console.log("=== " + t('debug_url_test') + " ===");
      testCases.forEach(testURL => {
        const result = replaceIPInURL(testURL, testIP);
        console.log(`${t('debug_input')}: ${testURL} -> ${t('debug_output')}: ${result}`);
      });
    }

    // Run test after page loads
    if (typeof window !== 'undefined') {
      window.addEventListener('load', () => {
        setTimeout(testURLCombination, 1000);
      });
    }

    // Extract command name from URL
    function extractCommandNameFromURL(url) {
      try {
        // First try to find exact URL match in commands.js
        const currentIP = getCurrentIP();

        // Remove IP address part, get relative path
        let relativePath = '';
        if (url.startsWith('http://') || url.startsWith('https://')) {
          // Remove protocol and IP address parts
          const urlWithoutProtocol = url.replace(/^https?:\/\//, '');
          const ipPattern = /^[0-9.]+/;
          const match = urlWithoutProtocol.match(ipPattern);
          if (match) {
            relativePath = urlWithoutProtocol.substring(match[0].length);
          } else {
            relativePath = urlWithoutProtocol;
          }
        } else {
          relativePath = url;
        }

        // Ensure relative path starts with /
        if (!relativePath.startsWith('/')) {
          relativePath = '/' + relativePath;
        }

        console.log('Extracted relative path:', relativePath);

        // Find exact URL match in commands.js
        const exactMatch = commands.find(cmd => cmd.url === relativePath);
        if (exactMatch) {
          console.log('Found exact match command:', exactMatch.key);
          const description = exactMatch.description;
          return `${exactMatch.key} - ${description}`;
        }

        // If no exact match, try to find similar URL (ignore query parameters)
        const relativePathWithoutQuery = relativePath.split('?')[0];
        const similarMatch = commands.find(cmd => {
          const cmdUrlWithoutQuery = cmd.url.split('?')[0];
          return cmdUrlWithoutQuery === relativePathWithoutQuery;
        });

        if (similarMatch) {
          console.log('Found similar match command:', similarMatch.key);
          const description = similarMatch.description;
          return `${similarMatch.key} - ${description}`;
        }

        // If none found, use previous extraction logic
        console.log('No matching command found, using default extraction logic');

        // Try to extract command name from URL path
        const urlObj = new URL(url);
        const pathname = urlObj.pathname;
        const search = urlObj.search;

        // If there are query parameters (containing equals sign)
        if (search && search.includes('=')) {
          // æå–æ‰€æœ‰ç­‰å·åé¢çš„å€¼
          const params = new URLSearchParams(search);
          const values = [];

          for (const [key, value] of params) {
            if (value && value.trim() !== '') {
              values.push(value.trim());
            }
          }

          // å¦‚æœæœ‰å€¼ï¼Œè¿”å›ç”¨ç©ºæ ¼è¿æ¥çš„ç»“æœ
          if (values.length > 0) {
            return values.join(' ');
          }
        }

        // If no query parameters or query parameters are empty, take characters after last slash
        const pathParts = pathname.split('/').filter(part => part);
        if (pathParts.length > 0) {
          return pathParts[pathParts.length - 1];
        }

        // If no path, return hostname
        return urlObj.hostname;

      } catch (e) {
        // If URL parsing fails, try simple string processing
        try {
          // ç§»é™¤åè®®éƒ¨åˆ†
          let cleanUrl = url.replace(/^https?:\/\//, '');

          // ç§»é™¤IPåœ°å€éƒ¨åˆ†
          const ipPattern = /^[0-9.]+/;
          const match = cleanUrl.match(ipPattern);
          if (match) {
            cleanUrl = cleanUrl.substring(match[0].length);
          }

          // ç¡®ä¿ä»¥/å¼€å¤´
          if (!cleanUrl.startsWith('/')) {
            cleanUrl = '/' + cleanUrl;
          }

          // åœ¨commands.jsä¸­æŸ¥æ‰¾åŒ¹é…
          const exactMatch = commands.find(cmd => cmd.url === cleanUrl);
          if (exactMatch) {
            const description = exactMatch.description;
            return `${exactMatch.key} - ${description}`;
          }

          // æ£€æŸ¥æ˜¯å¦æœ‰æŸ¥è¯¢å‚æ•°ï¼ˆåŒ…å«ç­‰å·ï¼‰
          if (cleanUrl.includes('=')) {
            // åˆ†å‰²è·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°
            const [pathPart, queryPart] = cleanUrl.split('?');

            if (queryPart && queryPart.includes('=')) {
              // Extract all values after equals sign
              const values = [];
              const params = queryPart.split('&');

              for (const param of params) {
                if (param.includes('=')) {
                  const [, value] = param.split('=');
                  if (value && value.trim() !== '') {
                    values.push(value.trim());
                  }
                }
              }

              // If there are values, return space-separated result
              if (values.length > 0) {
                return values.join(' ');
              }
            }
          }

          // å¦‚æœæ²¡æœ‰æŸ¥è¯¢å‚æ•°æˆ–æŸ¥è¯¢å‚æ•°ä¸ºç©ºï¼Œåˆ†å‰²è·¯å¾„
          const pathParts = cleanUrl.split('?')[0].split('/').filter(part => part);

          if (pathParts.length > 0) {
            return pathParts[pathParts.length - 1];
          }

          return 'Custom Command';
        } catch (fallbackError) {
          return 'Custom Command';
        }
      }
    }

    // æ ¼å¼åŒ–JSONæ˜¾ç¤º
    function formatJSON(jsonString) {
      try {
        const obj = JSON.parse(jsonString);
        return JSON.stringify(obj, null, 2);
      } catch (e) {
        return jsonString; // å¦‚æœä¸æ˜¯æœ‰æ•ˆJSONï¼Œç›´æ¥è¿”å›åŸå­—ç¬¦ä¸²
      }
    }

    // å‘½ä»¤å“åº”ç®¡ç†
    let commandResponses = [];

    // æ·»åŠ å‘½ä»¤å“åº”
    function addCommandResponse(commandName, url, responseText, isSuccess, timestamp) {
      const responseItem = {
        commandName,
        url,
        responseText,
        isSuccess,
        timestamp
      };

      commandResponses.unshift(responseItem); // æ·»åŠ åˆ°å¼€å¤´

      // Limit response count (maximum 20 items)
      if (commandResponses.length > 20) {
        commandResponses = commandResponses.slice(0, 20);
      }

      renderCommandResponses();
    }

    // æ¸²æŸ“å‘½ä»¤å“åº”
    function renderCommandResponses() {
      if (commandResponses.length === 0) {
        responseContent.innerHTML = `<div class="no-response">${t('ui_no_response')}</div>`;
        return;
      }

      responseContent.innerHTML = '';

      commandResponses.forEach((item, index) => {
        const responseItem = document.createElement('div');
        responseItem.className = `response-item ${item.isSuccess ? 'response-success' : 'response-error'}`;

        // æ ¼å¼åŒ–å“åº”å†…å®¹
        let formattedResponse = item.responseText;

        // å°è¯•æ£€æµ‹å¹¶æ ¼å¼åŒ–JSONå†…å®¹
        if (item.responseText.includes('{') || item.responseText.includes('[')) {
          try {
            // ç§»é™¤å¯èƒ½çš„é”™è¯¯å‰ç¼€ï¼ˆå¦‚ âŒ HTTPé”™è¯¯:ï¼‰
            let cleanText = item.responseText;
            if (cleanText.includes('âŒ')) {
              // æ‰¾åˆ°ç¬¬ä¸€ä¸ª { æˆ– [ çš„ä½ç½®
              const jsonStart = cleanText.search(/[{\[]/);
              if (jsonStart !== -1) {
                const jsonPart = cleanText.substring(jsonStart);
                try {
                  const parsed = JSON.parse(jsonPart);
                  formattedResponse = cleanText.substring(0, jsonStart) + '\n' + JSON.stringify(parsed, null, 2);
                } catch (e) {
                  // å¦‚æœJSONéƒ¨åˆ†è§£æå¤±è´¥ï¼Œä¿æŒåŸæ ·
                }
              }
            } else {
              // å°è¯•ç›´æ¥è§£æä¸ºJSON
              const parsed = JSON.parse(item.responseText);
              formattedResponse = JSON.stringify(parsed, null, 2);
            }
          } catch (e) {
            // å¦‚æœä¸æ˜¯æœ‰æ•ˆJSONï¼Œä¿æŒåŸæ–‡æœ¬
          }
        }

        responseItem.innerHTML = `
           <div class="response-item-header">
             <span class="response-command-name">${item.commandName}</span>
             <span class="response-timestamp">${item.timestamp}</span>
           </div>
           <div class="response-url">
             <span class="response-url-text">${item.url}</span>
             <button class="response-copy-url-btn" onclick="copyToClipboard('${item.url}')" title="${t('ui_copy_url_tooltip')}">ğŸ“‹</button>
           </div>
           <div class="response-data"><pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word;">${formattedResponse}</pre></div>
         `;

        responseContent.appendChild(responseItem);
      });

      // è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°å“åº”
      responseContent.scrollTop = 0;
    }



    // æ£€æŸ¥æ˜¯å¦æ˜¯å±é™©å‘½ä»¤
    function isDangerousCommand(commandName) {
      const dangerousCommands = [
      'reboot', 'shutdown', 
      'clear settings', 
      'stop record', 
      'format storage card', 
      'format to fat32', 
      'format to exfat',
      'delete file in card'
      ];
      const commandNameLower = commandName.toLowerCase();
      
      // æ£€æŸ¥commandNameæ˜¯å¦åŒ…å«ä»»ä½•å±é™©å‘½ä»¤çš„key
      return dangerousCommands.some(dangerousKey => 
        commandNameLower.includes(dangerousKey.toLowerCase())
      );
    }

    // æ˜¾ç¤ºå±é™©å‘½ä»¤ç¡®è®¤å¯¹è¯æ¡†
    function showDangerousCommandConfirm(commandName, url, callback) {
      // ä½¿ç”¨åŸç”Ÿconfirmå¯¹è¯æ¡†
      const message = `${t('ui_msg_warning_command')}\n\n${t('ui_msg_warning_command_desc')}\n${commandName}\n\n${t('ui_msg_warning_command_confirm')}`;
      
      const confirmed = confirm(message);
      callback(confirmed);
    }

    // æ‰§è¡ŒHTTPè¯·æ±‚å¹¶æ˜¾ç¤ºå“åº”
    async function executeCommand(url, commandName) {
      // æ£€æŸ¥æ˜¯å¦æ˜¯å±é™©å‘½ä»¤
      if (isDangerousCommand(commandName)) {
        showDangerousCommandConfirm(commandName, url, (confirmed) => {
          if (confirmed) {
            // ç”¨æˆ·ç¡®è®¤åæ‰§è¡Œå‘½ä»¤
            executeCommandInternal(url, commandName);
          }
        });
        return;
      }

      // ç›´æ¥æ‰§è¡Œå‘½ä»¤
      executeCommandInternal(url, commandName);
    }

    // å†…éƒ¨æ‰§è¡Œå‘½ä»¤å‡½æ•°
    async function executeCommandInternal(url, commandName) {
      // å®šä¹‰è¶…æ—¶æ—¶é—´ï¼ˆåœ¨å‡½æ•°é¡¶éƒ¨ï¼Œç¡®ä¿æ‰€æœ‰ä»£ç å—éƒ½èƒ½è®¿é—®ï¼‰
      const timeout = 30000; // 3 second timeout, can be adjusted as needed
      let loadingItem = null;
      let timeoutId = null;

      try {
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        loadingItem = document.createElement('div');
        loadingItem.className = 'response-item response-loading';
        loadingItem.innerHTML = `
            <div class="response-item-header">
              <span class="response-command-name">${commandName}</span>
              <span class="response-timestamp">${t('ui_btn_executing')}</span>
            </div>
            <div class="response-url">
              <span class="response-url-text">${url}</span>
              <button class="response-copy-url-btn" onclick="copyToClipboard('${url}')" title="${t('ui_copy_url_tooltip')}">ğŸ“‹</button>
            </div>
            <div class="response-data">
              <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                ğŸ”„ ${t('ui_msg_executing')}
              </div>
            </div>
          `;

        // å°†åŠ è½½é¡¹æ·»åŠ åˆ°å¼€å¤´
        responseContent.insertBefore(loadingItem, responseContent.firstChild);
        responseContent.scrollTop = 0;

        // åˆ›å»ºå¸¦è¶…æ—¶çš„fetchè¯·æ±‚
        const controller = new AbortController();
        timeoutId = setTimeout(() => controller.abort(), timeout);

        // æ‰§è¡ŒHTTPè¯·æ±‚
        const response = await fetch(url, {
          signal: controller.signal
        });

        clearTimeout(timeoutId); // æ¸…é™¤è¶…æ—¶å®šæ—¶å™¨
        const contentType = response.headers.get('content-type');

        if (response.ok) {
          let responseText = await response.text();
          let isSuccess = true;

          // å°è¯•è§£æJSONå¹¶æ£€æŸ¥codeå€¼
          if (contentType && contentType.includes('application/json')) {
            try {
              const jsonObj = JSON.parse(responseText);
              if (jsonObj.code !== undefined && jsonObj.code !== 0) {
                isSuccess = false;
              }
              responseText = formatJSON(responseText);
            } catch (e) {
              // JSONè§£æå¤±è´¥ï¼Œä¿æŒåŸæ–‡æœ¬
            }
          }

          // ç§»é™¤åŠ è½½é¡¹ï¼Œæ·»åŠ å®é™…å“åº”
          responseContent.removeChild(loadingItem);
          const timestamp = new Date().toLocaleString(getTimestampLocale());
          addCommandResponse(commandName, url, responseText, isSuccess, timestamp);
        } else {
          const errorText = `${t('ui_error_http')}${response.status} ${response.statusText}`;

          // ç§»é™¤åŠ è½½é¡¹ï¼Œæ·»åŠ é”™è¯¯å“åº”
          responseContent.removeChild(loadingItem);
          const timestamp = new Date().toLocaleString(getTimestampLocale());
          addCommandResponse(commandName, url, errorText, false, timestamp);
        }
      } catch (error) {
        let errorText = '';

        // æ£€æŸ¥æ˜¯å¦æ˜¯è¶…æ—¶é”™è¯¯
        if (error.name === 'AbortError') {
          errorText = `${t('ui_error_timeout')}${timeout / 1000}${t('ui_error_timeout_suffix')}`;
        } else {
          errorText = `${t('ui_error_network')}${error.message}`;
        }

        // æ¸…ç†è¶…æ—¶å®šæ—¶å™¨
        if (timeoutId) {
          clearTimeout(timeoutId);
        }

        // ç§»é™¤åŠ è½½é¡¹ï¼Œæ·»åŠ é”™è¯¯å“åº”
        if (loadingItem && loadingItem.parentNode) {
          responseContent.removeChild(loadingItem);
        }
        const timestamp = new Date().toLocaleString(getTimestampLocale());
        addCommandResponse(commandName, url, errorText, false, timestamp);
      } finally {
        // ç¡®ä¿æ¸…ç†è¶…æ—¶å®šæ—¶å™¨
        if (timeoutId) {
          clearTimeout(timeoutId);
        }
      }
    }

    // æœç´¢åŠŸèƒ½ - åŒæ—¶æœç´¢å‘½ä»¤çš„keyã€descriptionå’Œurlï¼Œæ”¯æŒå¤šè¯­è¨€æè¿°æœç´¢
    function searchCommands(query) {
      query = query.toLowerCase();
      const currentIP = getCurrentIP();

      // é¦–å…ˆå°è¯•å¸¸è§„æœç´¢ï¼ˆkeyã€å½“å‰è¯­è¨€çš„descriptionå’Œurlï¼‰
      let results = commands.filter(c => {
        // æ£€æŸ¥keyå’Œdescription
        const keyMatch = c.key.toLowerCase().includes(query);
        const descMatch = c.description && c.description.toLowerCase().includes(query);
        
        // æ£€æŸ¥åŸå§‹urlï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
        const urlMatch = c.url.toLowerCase().includes(query);
        
        // æ£€æŸ¥å®Œæ•´URLï¼ˆåŒ…å«IPåœ°å€ï¼‰
        const fullURL = replaceIPInURL(c.url, currentIP);
        const fullURLMatch = fullURL.toLowerCase().includes(query);
        
        return keyMatch || descMatch || urlMatch || fullURLMatch;
      });

      // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç»“æœï¼Œå°è¯•é€šè¿‡å¤šè¯­è¨€æè¿°æœç´¢
      if (results.length === 0 && typeof searchWithDescription === 'function') {
        const descriptionResults = searchWithDescription(query);
        if (descriptionResults.length > 0) {
          // å°†å¤šè¯­è¨€æœç´¢ç»“æœè½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
          results = descriptionResults.map(cmd => ({
            ...cmd,
            // ä½¿ç”¨åŒ¹é…åˆ°çš„æè¿°ä½œä¸ºæ˜¾ç¤ºæè¿°
            displayDescription: cmd.matchedDescription || cmd.description
          }));
        }
      }

      // ä¸ºæ‰€æœ‰ç»“æœæ·»åŠ åŠ¨æ€URL
      return results.map(cmd => ({
        ...cmd,
        url: replaceIPInURL(cmd.url, currentIP)
      }));
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        // åˆ›å»ºä¸´æ—¶æç¤º
        const toast = document.createElement('div');
        toast.textContent = t('ui_msg_copied');
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: var(--success-color);
          color: #000;
          padding: 12px 20px;
          border-radius: 6px;
          font-weight: 500;
          z-index: 1000;
          animation: slideIn 0.3s ease;
        `;
        document.body.appendChild(toast);

        setTimeout(() => {
          toast.remove();
        }, 2000);
      }).catch(err => {
        alert(`${t('ui_msg_copy_failed')}${err}`);
      });
    }

    function showResults(list) {
      results.innerHTML = "";

      if (list.length === 0) {
        results.innerHTML = `<div class="no-results">${t('ui_msg_no_results')}</div>`;
        return;
      }

      list.forEach(cmd => {
        const li = document.createElement("li");

        // ç‚¹å‡»å‘½ä»¤å°†URLå¡«å…¥æœç´¢æ¡†
        const span = document.createElement("span");
        // å¦‚æœæœ‰åŒ¹é…åˆ°çš„å¤šè¯­è¨€æè¿°ï¼Œä¼˜å…ˆæ˜¾ç¤ºå®ƒ
        const displayText = cmd.displayDescription ? 
          `${cmd.key} (${cmd.displayDescription}) â†’ ${cmd.url}` : 
          `${cmd.key} â†’ ${cmd.url}`;
        span.textContent = displayText;
        span.onclick = () => {
          // å°†å®Œæ•´URLå¡«å…¥æœç´¢æ¡†
          input.value = cmd.url;
          input.focus();

            // Select all URL text, like browser address bar
            input.select();

            // æ¸…ç©ºæœç´¢ç»“æœ
            results.innerHTML = "";

          // å°†å®Œæ•´URLæ·»åŠ åˆ°å†å²è®°å½•
          addSearchHistory(cmd.url);
        };

        // å¤åˆ¶æŒ‰é’®
        const copyBtn = document.createElement("button");
        copyBtn.textContent = t('ui_btn_copy');
        copyBtn.className = "copy-btn";
        copyBtn.onclick = (e) => {
          e.stopPropagation();
          copyToClipboard(cmd.url);
        };

        // æ‰“å¼€æŒ‰é’®ï¼ˆåœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€ï¼‰
        const openBtn = document.createElement("button");
        openBtn.textContent = t('ui_btn_open');
        openBtn.className = "open-btn";
        openBtn.onclick = (e) => {
          e.stopPropagation();
          // æ£€æŸ¥URLä¸­æ˜¯å¦éœ€è¦å¡«å†™å‚æ•°
          if (checkURLParameters(cmd.url)) {
            window.open(cmd.url, '_blank');
          }
        };

        li.appendChild(span);
        li.appendChild(copyBtn);
        li.appendChild(openBtn);
        results.appendChild(li);
      });
    }

    // æ¸…ç©ºå“åº”æŒ‰é’®äº‹ä»¶
    clearResponseBtn.addEventListener("click", () => {
      commandResponses = [];
      responseContent.innerHTML = `<div class="no-response">${t('ui_no_response')}</div>`;
    });



    // IPåœ°å€å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“å¸¸ç”¨å‘½ä»¤æŒ‰é’®
    ipInput.addEventListener("input", () => {
      // ä¿å­˜IPåœ°å€åˆ°æœ¬åœ°å­˜å‚¨
      const currentIP = ipInput.value.trim();
      if (currentIP !== '') {
        saveIPToStorage(currentIP);
      }

      renderFavorites();
      // å¦‚æœå½“å‰æœ‰æœç´¢ç»“æœï¼Œä¹Ÿé‡æ–°æ˜¾ç¤º
      const query = input.value.trim();
      if (query !== "") {
        showResults(searchCommands(query));
      }

      // å¦‚æœå†å²è®°å½•é¢æ¿æ­£åœ¨æ˜¾ç¤ºï¼Œé‡æ–°æ˜¾ç¤ºä»¥æ›´æ–°URL
      const historyContainer = document.querySelector('.search-history-container');
      if (historyContainer) {
        showSearchHistory();
      }
    });

    // æœç´¢æ¡†è¾“å…¥äº‹ä»¶
    input.addEventListener("input", () => {
      const query = input.value.trim();
      if (query === "") {
        results.innerHTML = "";
        // å½“è¾“å…¥æ¡†ä¸ºç©ºæ—¶ï¼Œæ˜¾ç¤ºå†å²è®°å½•
        showSearchHistory();
      } else if (query === "?" || query === "ï¼Ÿ") {
        // å½“è¾“å…¥é—®å·æ—¶ï¼Œæ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤ï¼ˆæ”¯æŒä¸­è‹±æ–‡é—®å·ï¼‰
        showResults(commands.map(cmd => ({
          ...cmd,
          url: replaceIPInURL(cmd.url, getCurrentIP())
        })));
        hideSearchHistory(); // éšè—å†å²è®°å½•
      } else {
        showResults(searchCommands(query));
        hideSearchHistory(); // éšè—å†å²è®°å½•
      }
    });

    // æœç´¢æ¡†å¤±å»ç„¦ç‚¹æ—¶ï¼Œå¦‚æœæ˜¯å®Œæ•´URLåˆ™æ·»åŠ åˆ°å†å²è®°å½•
    input.addEventListener("blur", () => {
      const query = input.value.trim();
      if (query !== "" && query !== "?" && query !== "ï¼Ÿ" &&
        (query.startsWith('http://') || query.startsWith('https://'))) {
        addSearchHistory(query);
      }

      // å»¶è¿Ÿéšè—å†å²è®°å½•ï¼Œè®©ç‚¹å‡»äº‹ä»¶å…ˆè§¦å‘
      // å¢åŠ å»¶è¿Ÿæ—¶é—´ï¼Œç¡®ä¿ç‚¹å‡»äº‹ä»¶èƒ½å¤Ÿæ­£å¸¸å¤„ç†
      setTimeout(() => {
        hideSearchHistory();
      }, 500);
    });

    // æœç´¢æ¡†è·å¾—ç„¦ç‚¹æ—¶æ˜¾ç¤ºå†å²è®°å½•
    input.addEventListener("focus", () => {
      console.log('Search input focused, current value:', input.value.trim());
      // ç¦ç”¨æµè§ˆå™¨çš„é»˜è®¤å†å²è®°å½•
      input.setAttribute('autocomplete', 'off');
      input.setAttribute('list', '');

      if (input.value.trim() === "") {
        console.log('Search input is empty, showing history');
        showSearchHistory();
      } else {
        console.log('Search input has content, not showing history');
      }
    });

    // IPåœ°å€è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶ä¿å­˜IPåœ°å€
    ipInput.addEventListener("blur", () => {
      const currentIP = ipInput.value.trim();
      if (currentIP !== '') {
        saveIPToStorage(currentIP);
      }
    });

    // æœç´¢æ¡†å¤±å»ç„¦ç‚¹æ—¶éšè—å†å²è®°å½•ï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼Œè®©ç‚¹å‡»äº‹ä»¶å…ˆè§¦å‘ï¼‰
    // æ³¨æ„ï¼šè¿™ä¸ªäº‹ä»¶ç›‘å¬å™¨å·²ç»åœ¨ä¸Šé¢åˆå¹¶åˆ°æ–°çš„bluräº‹ä»¶ä¸­äº†

    // æ£€æŸ¥URLä¸­æ˜¯å¦éœ€è¦å¡«å†™å‚æ•°
    function checkURLParameters(url) {
      // ä½¿ç”¨æ›´ç²¾ç¡®çš„æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…å‚æ•°
      // åŒ¹é… $ åé¢è·Ÿç€é /ã€&ã€? çš„å­—ç¬¦åºåˆ—
      const dollarMatches = url.match(/\$([^/&?]+)/g);
      if (dollarMatches && dollarMatches.length > 0) {
        // ä¿ç•™å®Œæ•´çš„å‚æ•°åç§°ï¼ˆåŒ…æ‹¬$ç¬¦å·ï¼‰ï¼Œç”¨æ¢è¡Œç¬¦åˆ†éš”
        const parameterList = dollarMatches.join('\n');
        
        // æ˜¾ç¤ºå¤šè¯­è¨€å‚æ•°æé†’
        alert(`${t('ui_msg_parameters_required')}\n${parameterList}\n\n${t('ui_msg_parameters_instruction')}`);
        return false; // è¿”å›falseè¡¨ç¤ºéœ€è¦å¡«å†™å‚æ•°
      }
      return true; // è¿”å›trueè¡¨ç¤ºå¯ä»¥æ‰§è¡Œ
    }

    // æŒ‰å›è½¦é”®æ—¶æ‰§è¡Œå‘½ä»¤æˆ–æ·»åŠ æœç´¢å†å²
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        const query = input.value.trim();

        // æ£€æŸ¥æ˜¯å¦æ˜¯URLæ ¼å¼
        if (query.startsWith('http://') || query.startsWith('https://')) {
          // æ£€æŸ¥æ˜¯å¦éœ€è¦å¡«å†™å‚æ•°
          if (checkURLParameters(query)) {
            // æ˜¯URLï¼Œæ‰§è¡Œå‘½ä»¤å¹¶æ·»åŠ åˆ°å†å²è®°å½•
            const commandName = extractCommandNameFromURL(query);
            executeCommand(query, commandName);
            addSearchHistory(query);
          }
        }
      }
    });

    // å¸¸ç”¨å‘½ä»¤æŒ‰é’®ç”Ÿæˆ
    function renderFavorites() {
      // æ¸…ç©ºç°æœ‰æŒ‰é’®
      favButtons.innerHTML = "";

      favorites.forEach(favKey => {
        const cmd = commands.find(c => c.key === favKey);
        if (cmd) {
          const btn = document.createElement("button");
          btn.textContent = cmd.description;
          btn.onclick = () => {
            const currentIP = getCurrentIP();
            const dynamicURL = replaceIPInURL(cmd.url, currentIP);

            // å°†å®Œæ•´URLæ·»åŠ åˆ°æœç´¢å†å²
            addSearchHistory(dynamicURL);

              // å°†URLå¡«å…¥æœç´¢æ¡†ï¼Œè€Œä¸æ˜¯ç›´æ¥æ‰§è¡Œ
              input.value = dynamicURL;
              input.focus();

              // å…¨é€‰URLæ–‡æœ¬ï¼Œå°±åƒæµè§ˆå™¨åœ°å€æ é‚£æ ·
              input.select();

            // æ¸…ç©ºæœç´¢ç»“æœ
            results.innerHTML = "";
          };
          favButtons.appendChild(btn);
        }
      });
    }

    // ç¡®ä¿æœç´¢æ¡†ç¦ç”¨æµè§ˆå™¨é»˜è®¤å†å²è®°å½•
    input.setAttribute('autocomplete', 'off');
    input.setAttribute('list', '');

    // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œé‡æ–°è°ƒæ•´å†å²è®°å½•é¢æ¿é«˜åº¦
    window.addEventListener('resize', () => {
      const historyContainer = document.querySelector('.search-history-container');
      if (historyContainer) {
        adjustHistoryPanelHeight(historyContainer);
      }
    });

    // åº”ç”¨è¯­è¨€åˆ°é¡µé¢
    applyLanguage();

    // åˆå§‹åŒ–å‘½ä»¤æè¿°
    if (typeof initializeCommandDescriptions === 'function') {
      initializeCommandDescriptions();
      console.log('Command descriptions initialized');
    }

    console.log("Starting to render favorite buttons");
    renderFavorites();

    console.log("Page initialization completed");

    // è®¾ç½®GitHubé“¾æ¥
    const githubLink = document.getElementById('github-link');
    if (githubLink) {
      // è¿™é‡Œæ‚¨å¯ä»¥è®¾ç½®æ‚¨çš„GitHubä»“åº“åœ°å€
      githubLink.href = 'https://github.com/Jack-vexel-ws/zcamhttp';
      console.log('GitHub button initialized');
    }

    // è®¾ç½®ZCAMæ–‡æ¡£é“¾æ¥
    const zcamDocLink = document.getElementById('zcam-doc-btn');
    if (zcamDocLink) {
      // è¿™é‡Œæ‚¨å¯ä»¥è®¾ç½®ZCAMå®˜æ–¹HTTPæ–‡æ¡£åœ°å€
      zcamDocLink.href = 'https://github.com/imaginevision/Z-Camera-Doc/blob/master/E2/protocol/http/http.md';
      console.log('ZCAM Doc button initialized');
    }

    // è®¾ç½®æŒ‰é’®çš„titleä¸ºå¤šè¯­è¨€
    const githubBtn = document.getElementById('github-link');
    if (githubBtn) {
      githubBtn.title = t('ui_github_btn_title');
    }

    if (zcamDocLink) {
      zcamDocLink.title = t('ui_zcam_doc_btn_title');
    }

    // æ‰“å¼€ç›¸æœºåå°æ§åˆ¶é¡µé¢
    function openCameraAdmin() {
      const currentIP = getCurrentIP();
      const adminURL = `http://${currentIP}/www/index.html`;
      
      // åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€ç›¸æœºåå°æ§åˆ¶é¡µé¢
      window.open(adminURL, '_blank');
      
      console.log('Opening camera admin panel:', adminURL);
    }

    // å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä¾›HTML onclickäº‹ä»¶è°ƒç”¨
    window.selectHistoryItem = selectHistoryItem;
    window.removeHistoryItem = removeHistoryItem;
    window.clearSearchHistory = clearSearchHistory;
    window.openCameraAdmin = openCameraAdmin;
    window.isDangerousCommand = isDangerousCommand;
    window.showDangerousCommandConfirm = showDangerousCommandConfirm;
    window.executeCommandInternal = executeCommandInternal;
    window.saveIPToStorage = saveIPToStorage; 
    window.loadIPFromStorage = loadIPFromStorage;
  </script>
</body>

</html>