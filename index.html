<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Camera Control Panel</title>
  <style>
    /* æ·±è‰²ä¸»é¢˜ - Cursoré£æ ¼ */
    :root {
      --bg-primary: #1e1e1e;
      --bg-secondary: #252526;
      --bg-tertiary: #2d2d30;
      --bg-hover: #3c3c3c;
      --text-primary: #cccccc;
      --text-secondary: #9cdcfe;
      --border-color: #3e3c42;
      --accent-color: #007acc;
      --accent-hover: #005a9e;
      --success-color: #4ec9b0;
      --warning-color: #dcdcaa;

      /* å†å²è®°å½•å˜æš—é¢œè‰² */
      --history-bg: var(--bg-tertiary);
      --history-text: #8a8a8a;
      --history-timestamp: #555555;
      --history-url-bg: var(--bg-primary);
      --history-url-text: #999999;
      --history-button-border: #666666;
      --history-button-text: #666666;
      --history-data-bg: var(--bg-primary);
      --history-data-text: #999999;

      /* å†å²è®°å½•çŠ¶æ€é¢œè‰² */
      --history-success-border: #2d5a4e;
      --history-error-border: #5a2d2d;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      margin: 0;
      padding: 0;
      line-height: 1.6;
      overflow-x: hidden;
    }

    .main-container {
      display: flex;
      gap: 20px;
      max-width: 1610px;
      margin: 20px auto;
      min-height: calc(100vh - 40px);
      align-items: stretch;
    }

    .left-panel {
      flex: 1;
      background: var(--bg-secondary);
      border-radius: 8px;
      padding: 20px 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      min-height: 0;
      max-height: calc(100vh - 40px);
      overflow: hidden;
    }

    .right-panel {
      flex: 1;
      background: var(--bg-secondary);
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      min-height: 0;
      max-height: calc(100vh - 40px);
      box-sizing: border-box;
    }

    .title-section {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .title-section h1 {
      font-size: 28px;
      margin: 0;
      color: var(--text-secondary);
      font-weight: 600;
      flex-shrink: 0;
    }

    .github-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: var(--bg-tertiary);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .github-btn:hover {
      background: var(--bg-hover);
      border-color: var(--accent-color);
      color: var(--accent-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .github-icon {
      width: 20px;
      height: 20px;
    }

    .button-group {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .zcam-doc-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: var(--bg-tertiary);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .zcam-doc-btn:hover {
      background: var(--bg-hover);
      border-color: var(--success-color);
      color: var(--success-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .zcam-doc-icon {
      width: 20px;
      height: 20px;
      filter: brightness(0) saturate(100%) invert(70%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(0.9) contrast(0.9);
    }

    .zcam-doc-btn:hover .zcam-doc-icon {
      filter: brightness(0) saturate(100%) invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(1) contrast(1);
    }

    /* è¯­è¨€åˆ‡æ¢å™¨ */
    .language-switcher {
      display: flex;
      align-items: center;
      background: var(--bg-tertiary);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      padding: 2px;
      gap: 2px;
      height: 40px;
      box-sizing: border-box;
    }

    .lang-btn {
      padding: 0;
      background: transparent;
      border: none;
      border-radius: 4px;
      color: var(--text-secondary);
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 30px;
      height: 36px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .lang-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .lang-btn.active {
      background: var(--accent-color);
      color: #ffffff;
      box-shadow: 0 2px 8px rgba(0, 122, 204, 0.3);
    }

    h1 {
      font-size: 28px;
      margin-bottom: 30px;
      color: var(--text-secondary);
      font-weight: 600;
      text-align: center;
      flex-shrink: 0;
    }

    h2 {
      font-size: 20px;
      margin: 25px 0 15px 0;
      color: var(--text-secondary);
      font-weight: 500;
      flex-shrink: 0;
    }

    .ip-section {
      margin-bottom: 12px;
      padding: 0;
      background: var(--bg-secondary);
      border-radius: 6px;
      border: 1px solid var(--border-color);
      flex-shrink: 0;
      overflow: hidden;
    }

    .ip-section label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-secondary);
      font-weight: 500;
      font-size: 14px;
    }

    .ip-input-container {
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }

    .ip-section input {
      flex: 1;
      padding: 10px 14px;
      font-size: 14px;
      border: 2px solid var(--border-color);
      border-radius: 4px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      transition: all 0.2s ease;
      outline: none;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    }

    .ip-section input:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(0, 122, 204, 0.1);
    }

    .camera-admin-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      padding: 0;
      border: 2px solid var(--border-color);
      border-radius: 4px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      outline: none;
      flex-shrink: 0;
    }

    .camera-admin-btn:hover {
      border-color: var(--accent-color);
      background: var(--bg-tertiary);
      transform: translateY(-1px);
    }

    .camera-admin-btn:active {
      transform: translateY(0);
    }

    .camera-admin-icon {
      width: 20px;
      height: 20px;
    }

    /* IPæ¨¡å¼é€‰æ‹©å™¨æ ·å¼ - æ ‡ç­¾é¡µ */
    .ip-mode-selector {
      display: flex;
      gap: 0;
      margin-bottom: 0;
      border-bottom: 2px solid var(--border-color);
      background: var(--bg-tertiary);
      border-top-left-radius: 6px;
      border-top-right-radius: 6px;
    }

    .ip-mode-tab {
      flex: 1;
      padding: 8px 16px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--text-primary);
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      outline: none;
      position: relative;
      top: 0;
    }

    .ip-mode-tab:hover {
      background: var(--bg-hover);
      color: var(--text-secondary);
    }

    .ip-mode-tab.active {
      background: var(--bg-secondary);
      color: var(--accent-color);
      border-bottom-color: var(--accent-color);
      font-weight: 600;
    }

    .ip-mode-tab:first-child {
      border-top-left-radius: 6px;
    }

    .ip-mode-tab:last-child {
      border-top-right-radius: 6px;
    }

    .ip-mode-container {
      margin-top: 0;
      padding: 12px 16px;
      background: var(--bg-secondary);
      border-bottom-left-radius: 6px;
      border-bottom-right-radius: 6px;
      min-height: 100px; /* ç»Ÿä¸€æœ€å°é«˜åº¦ï¼Œç¡®ä¿æ‰€æœ‰é¢æ¿é«˜åº¦ä¸€è‡´ */
    }

    .ip-mode-container label {
      display: block;
      margin-bottom: 6px;
      color: var(--text-secondary);
      font-weight: 500;
      font-size: 14px;
    }

    .ip-mode-container input {
      width: 100%;
      margin-bottom: 0; /* ç§»é™¤åº•éƒ¨marginï¼Œç»Ÿä¸€é«˜åº¦ */
    }

    /* è¿ç»­IPæ¨¡å¼ï¼šå¹¶æ’å¸ƒå±€ */
    .ip-mode-container[data-mode="continuous"] .ip-input-row {
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .ip-mode-container[data-mode="continuous"] .ip-input-group {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .ip-mode-container[data-mode="continuous"] .ip-input-group label {
      margin-bottom: 6px;
    }

    .ip-mode-container[data-mode="continuous"] .ip-input-group input {
      width: 100%;
      margin-bottom: 0;
    }

    /* åˆ·æ–°é—´éš”è¾“å…¥æ¡†åŒ…è£…å™¨ï¼ˆç”¨äºç»“æŸIPè¾“å…¥æ¡†ï¼‰ */
    .refresh-interval-wrapper {
      position: relative;
      display: inline-flex;
      align-items: center;
      width: 100%;
    }

    .refresh-interval-input {
      width: 100%;
      padding: 6px 24px 6px 8px;
      font-size: 12px;
      border: 1.5px solid var(--border-color);
      border-radius: 6px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      text-align: center;
      outline: none;
      transition: all 0.2s ease;
      font-weight: 500;
      appearance: textfield; /* æ ‡å‡†å±æ€§ï¼Œéšè—spinner */
      -moz-appearance: textfield; /* Firefoxéšè—spinner */
    }

    /* éšè—Chrome/Safari/Edgeçš„spinner */
    .refresh-interval-input::-webkit-outer-spin-button,
    .refresh-interval-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .refresh-interval-input:focus {
      border-color: var(--accent-color);
      background: var(--bg-secondary);
      box-shadow: 0 0 0 3px rgba(0, 122, 204, 0.15);
    }

    .refresh-interval-input:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      background: var(--bg-secondary);
      border-color: var(--border-color);
    }

    .refresh-interval-input:hover:not(:disabled) {
      border-color: var(--accent-color);
    }

    /* è‡ªå®šä¹‰ä¸Šä¸‹ç®­å¤´æŒ‰é’® */
    .refresh-interval-controls {
      position: absolute;
      right: 2px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 1px;
      pointer-events: none;
    }

    .refresh-interval-btn {
      width: 18px;
      height: 11px;
      padding: 0;
      border: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
      transition: all 0.15s ease;
      border-radius: 2px;
    }

    .refresh-interval-btn:hover:not(:disabled) {
      background: var(--bg-hover);
    }

    .refresh-interval-btn:active:not(:disabled) {
      background: var(--accent-color);
    }

    .refresh-interval-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .refresh-interval-btn svg {
      width: 10px;
      height: 10px;
      fill: var(--text-secondary);
      transition: fill 0.15s ease;
    }

    .refresh-interval-btn:hover:not(:disabled) svg {
      fill: var(--accent-color);
    }

    .refresh-interval-btn:active:not(:disabled) svg {
      fill: white;
    }

    .ip-format-hint {
      display: none; /* éšè—æç¤ºå­—ç¬¦ */
    }

    /* IPè¾“å…¥æç¤ºtooltip */
    .ip-tooltip {
      cursor: help;
      position: relative;
    }

    /* åŠ¨æ€tooltipå®¹å™¨ */
    .ip-tooltip-popup {
      position: fixed;
      padding: 8px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 12px;
      white-space: pre-line; /* æ”¯æŒæ¢è¡Œç¬¦æ¢è¡Œ */
      width: max-content;
      max-width: 90vw;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s ease;
      z-index: 10000;
      line-height: 1.6;
      display: none;
    }

    .ip-tooltip-popup.show {
      display: block;
      opacity: 1;
    }

    /* æ±‡æ€»å“åº”é¡¹æ ·å¼ */
    .response-summary {
      border-left: 4px solid var(--accent-color);
      cursor: pointer;
      user-select: none;
    }

    .response-summary:hover {
      background: var(--bg-hover);
    }

    .response-summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .response-summary-stats {
      display: flex;
      gap: 15px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .response-summary-stat {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .response-summary-stat.success {
      color: var(--success-color);
    }

    .response-summary-stat.error {
      color: #ff6b6b;
    }

    .response-summary-expand {
      font-size: 12px;
      color: var(--accent-color);
      transition: transform 0.2s ease;
    }

    .response-summary.expanded .response-summary-expand {
      transform: rotate(90deg);
    }

    .response-details {
      display: none;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid var(--border-color);
    }

    .response-summary.expanded .response-details {
      display: block;
    }

    .response-ip-badge {
      display: inline-block;
      padding: 2px 8px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 11px;
      color: var(--text-secondary);
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      margin-right: 8px;
    }

    .response-detail-item {
      margin-bottom: 12px;
      padding: 12px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      border-left: 3px solid var(--border-color);
    }

    .response-detail-item.success {
      border-left-color: var(--success-color);
    }

    .response-detail-item.error {
      border-left-color: #ff6b6b;
    }

    .response-detail-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .response-detail-ip {
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 13px;
    }

    .response-detail-status {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 3px;
    }

    .response-detail-status.success {
      background: rgba(78, 201, 176, 0.2);
      color: var(--success-color);
    }

    .response-detail-status.error {
      background: rgba(255, 107, 107, 0.2);
      color: #ff6b6b;
    }

    .search-section {
      margin-bottom: 30px;
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      overflow: hidden;
      /* æ”¹ä¸ºhiddenï¼Œé˜²æ­¢å†å²è®°å½•é¢æ¿æº¢å‡ºè¦†ç›–å¸¸ç”¨å‘½ä»¤åŒºåŸŸ */
      position: relative;
      /* æ·»åŠ ç›¸å¯¹å®šä½ï¼Œä¸ºå­å…ƒç´ æä¾›å®šä½ä¸Šä¸‹æ–‡ */
    }

    .search-input-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 0;
    }

    input {
      flex: 1;
      padding: 12px 16px;
      font-size: 16px;
      border: 2px solid var(--border-color);
      border-radius: 6px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      transition: all 0.2s ease;
      outline: none;
      flex-shrink: 0;
      box-sizing: border-box;
    }

    /* æœç´¢è¾“å…¥æ¡†æ ·å¼ - ä¸æ‰§è¡ŒæŒ‰é’®é«˜åº¦ä¸€è‡´ */
    #search {
      height: 36px;
      padding: 0 16px;
      font-size: 14px;
      display: flex;
      align-items: center;
    }

    input:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(0, 122, 204, 0.1);
    }

    input::placeholder {
      color: #6a6a6a;
    }

    /* ç¦ç”¨æµè§ˆå™¨é»˜è®¤çš„å†å²è®°å½•ä¸‹æ‹‰ç®­å¤´ */
    input::-webkit-calendar-picker-indicator {
      display: none !important;
    }

    input::-webkit-list-button {
      display: none !important;
    }

    .results-container {
      margin-top: 20px;
      flex: 1;
      min-height: 0;
      max-height: none;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      min-height: 100px;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      min-height: 0;
      max-height: none;
    }

    li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      margin-bottom: 6px;
      background: var(--bg-tertiary);
      border-radius: 6px;
      transition: all 0.2s ease;
      flex-shrink: 0;
      min-height: 52px; /* ç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´æ˜¾ç¤º2è¡Œå†…å®¹ */
    }

    li:hover {
      background: var(--bg-hover);
      border-color: var(--accent-color);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    /* å‘½ä»¤å†…å®¹åŒºåŸŸ - æ”¯æŒ2è¡Œæ˜¾ç¤º */
    .command-content {
      cursor: pointer;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 3px;
      min-width: 0; /* å…è®¸æ–‡æœ¬æˆªæ–­ */
      justify-content: center; /* å‚ç›´å±…ä¸­ */
    }

    /* å‘½ä»¤æè¿°ï¼ˆç¬¬ä¸€è¡Œï¼‰ */
    .command-description {
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* å‘½ä»¤è·¯å¾„ï¼ˆç¬¬äºŒè¡Œï¼‰ */
    .command-url {
      color: var(--text-primary);
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* å¤åˆ¶æŒ‰é’® - å›¾æ ‡æ ·å¼ */
    .copy-btn-icon {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 16px;
      padding: 2px 6px;
      border-radius: 4px;
      transition: all 0.2s ease;
      opacity: 0.7;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .copy-btn-icon:hover {
      background: rgba(0, 122, 204, 0.2);
      color: var(--accent-color);
      opacity: 1;
    }

    .favorites {
      margin-top: auto;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
      flex-shrink: 0;
      position: relative;
      z-index: 1001;
      /* ç¡®ä¿å¸¸ç”¨å‘½ä»¤åŒºåŸŸåœ¨å†å²è®°å½•é¢æ¿ä¹‹ä¸Š */
      background: var(--bg-secondary);
      /* æ·»åŠ èƒŒæ™¯è‰²ï¼Œç¡®ä¿å®Œå…¨è¦†ç›–ä¸‹æ–¹çš„å…ƒç´  */
    }

    #fav-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: flex-start;
    }

    .favorites button {
      margin: 0;
      padding: 0 18px;
      height: 36px;
      font-size: 14px;
      border: none;
      background: #2d3a4a;
      color: #e8f4f8;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      flex-shrink: 0;
    }

    .favorites button:hover {
      background: #3a4f66;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 122, 204, 0.4);
    }

    .favorites button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* æ‰§è¡ŒæŒ‰é’®æ ·å¼ - ä¸ multi-camera-index.html ä¿æŒä¸€è‡´ */
    .action-btn {
      padding: 0 18px;
      height: 36px;
      font-size: 14px;
      border: none;
      background: #2d3a4a;
      color: #e8f4f8;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      flex-shrink: 0;
    }

    .action-btn:hover {
      background: #3a4f66;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 122, 204, 0.4);
    }

    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* æ‰§è¡ŒæŒ‰é’®ç‰¹æ®Šæ ·å¼ - ä½¿ç”¨æ·±ç»¿è‰²ç³»é…è‰²ï¼Œå®½åº¦è‡ªé€‚åº”å†…å®¹ */
    .action-btn-execute {
      flex: 0 0 auto; /* ä¸è‡ªåŠ¨ä¼¸ç¼© */
      min-width: auto; /* å®½åº¦è‡ªé€‚åº”å†…å®¹ */
      padding: 0 16px; /* é€‚å½“çš„å†…è¾¹è·ï¼Œç¡®ä¿æŒ‰é’®ä¸ä¼šå¤ªçª„ */
      background: #2d8659;
      color: white;
      border-color: #2d8659;
      font-weight: 600;
    }

    .action-btn-execute:hover {
      background: #3a9d73;
      border-color: #3a9d73;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(45, 134, 89, 0.4);
    }

    .action-btn-execute:disabled {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      border-color: var(--border-color);
      opacity: 0.5;
    }

    .no-results {
      text-align: center;
      color: #6a6a6a;
      font-style: italic;
      padding: 20px;
    }

    .response-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
      flex-shrink: 0;
      box-sizing: border-box;
    }

    .clear-btn {
      padding: 6px 12px;
      border: 1px solid var(--warning-color);
      background: var(--bg-tertiary);
      color: var(--warning-color);
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .clear-btn:hover {
      background: var(--warning-color);
      color: #000;
    }

    .response-content {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 20px;
      min-height: 200px;
      flex: 1;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
      overflow-y: auto;
      overflow-x: hidden;
    }

    /* å‘½ä»¤å“åº”é¡¹æ ·å¼ */
    .response-item {
      margin-bottom: 20px;
      padding: 15px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      border-left: 4px solid var(--accent-color);
      transition: all 0.3s ease;
    }

    .response-item:last-child {
      margin-bottom: 0;
    }

    /* æœ€æ–°æ‰§è¡Œçš„å‘½ä»¤ - é«˜äº®æ˜¾ç¤º */
    .response-item:first-child {
      background: var(--bg-secondary);
      border-color: var(--accent-color);
      box-shadow: 0 2px 8px rgba(0, 122, 204, 0.2);
    }

    /* å†å²è®°å½•å‘½ä»¤ - å˜æš—æ˜¾ç¤º */
    .response-item:not(:first-child) {
      background: var(--history-bg);
      border-color: var(--border-color);
      opacity: 0.7;
    }

    .response-item:not(:first-child):hover {
      opacity: 0.9;
      background: var(--bg-secondary);
    }

    .response-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-color);
    }

    .response-command-name {
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 14px;
    }

    /* å†å²è®°å½•çš„å‘½ä»¤åç§°å˜æš— */
    .response-item:not(:first-child) .response-command-name {
      color: var(--history-text);
    }

    .response-timestamp {
      font-size: 11px;
      color: #6a6a6a;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    }

    /* å†å²è®°å½•çš„æ—¶é—´æˆ³æ›´æš— */
    .response-item:not(:first-child) .response-timestamp {
      color: var(--history-timestamp);
    }

    .response-url {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 11px;
      color: var(--text-primary);
      background: var(--bg-tertiary);
      padding: 8px;
      border-radius: 4px;
      border: 1px solid var(--border-color);
      word-break: break-all;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    /* å†å²è®°å½•çš„URLèƒŒæ™¯æ›´æš— */
    .response-item:not(:first-child) .response-url {
      background: var(--history-url-bg);
      color: var(--history-url-text);
    }

    .response-url-text {
      flex: 1;
      word-break: break-all;
    }

    .response-copy-url-btn {
      flex-shrink: 0;
      padding: 4px 6px;
      border: 1px solid var(--accent-color);
      background: var(--bg-secondary);
      color: var(--accent-color);
      border-radius: 3px;
      cursor: pointer;
      font-size: 10px;
      font-weight: 500;
      transition: all 0.2s ease;
      min-width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .response-copy-url-btn:hover {
      background: var(--accent-color);
      color: white;
      transform: translateY(-1px);
    }

    /* å†å²è®°å½•çš„å¤åˆ¶æŒ‰é’®å˜æš— */
    .response-item:not(:first-child) .response-copy-url-btn {
      border-color: var(--history-button-border);
      color: var(--history-button-text);
      background: var(--history-url-bg);
    }

    .response-item:not(:first-child) .response-copy-url-btn:hover {
      border-color: var(--accent-color);
      color: var(--accent-color);
      background: var(--bg-secondary);
    }

    .response-data {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.4;
      max-height: 200px;
      overflow-y: auto;
      padding: 10px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      border: 1px solid var(--border-color);
    }

    /* å†å²è®°å½•çš„å“åº”æ•°æ®èƒŒæ™¯æ›´æš— */
    .response-item:not(:first-child) .response-data {
      background: var(--history-data-bg);
      color: var(--history-data-text);
    }

    .response-data pre {
      margin: 0;
      font-family: inherit;
      font-size: inherit;
      line-height: inherit;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    /* æˆåŠŸçŠ¶æ€ - æœ€æ–°å‘½ä»¤ */
    .response-item:first-child.response-success {
      border-left-color: var(--success-color);
      box-shadow: 0 2px 8px rgba(78, 201, 176, 0.2);
    }

    /* å¤±è´¥çŠ¶æ€ - æœ€æ–°å‘½ä»¤ */
    .response-item:first-child.response-error {
      border-left-color: #ff6b6b;
      box-shadow: 0 2px 8px rgba(255, 107, 107, 0.2);
    }

    /* æˆåŠŸçŠ¶æ€ - å†å²è®°å½• */
    .response-item:not(:first-child).response-success {
      border-left-color: var(--history-success-border);
      background: var(--history-bg);
    }

    /* å¤±è´¥çŠ¶æ€ - å†å²è®°å½• */
    .response-item:not(:first-child).response-error {
      border-left-color: var(--history-error-border);
      background: var(--history-bg);
    }

    .response-loading {
      border-left-color: var(--accent-color);
      opacity: 0.8;
    }

    .no-response {
      text-align: center;
      color: #6a6a6a;
      font-style: italic;
      padding: 40px 20px;
    }

    .response-loading {
      text-align: center;
      color: var(--text-secondary);
      padding: 40px 20px;
    }

    .response-error {
      color: #ff6b6b;
      padding: 20px;
      border: 1px solid #ff6b6b;
      border-radius: 4px;
      background: rgba(255, 107, 107, 0.1);
    }

    .response-success {
      color: var(--success-color);
    }

    .command-path-section {
      margin-top: 20px;
      padding: 20px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
    }

    .command-path-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-weight: 500;
    }

    .copy-path-btn {
      padding: 4px 10px;
      border: 1px solid var(--accent-color);
      background: var(--bg-secondary);
      color: var(--accent-color);
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .copy-path-btn:hover {
      background: var(--accent-color);
      color: white;
    }

    .command-path-text {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      color: var(--text-primary);
      background: var(--bg-secondary);
      padding: 12px;
      border-radius: 4px;
      border: 1px solid var(--border-color);
      word-break: break-all;
      line-height: 1.4;
    }

    .history-section {
      margin-top: 20px;
      padding: 20px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      max-height: 400px;
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-weight: 500;
    }

    .clear-history-btn {
      padding: 4px 10px;
      border: 1px solid var(--warning-color);
      background: var(--bg-secondary);
      color: var(--warning-color);
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .clear-history-btn:hover {
      background: var(--warning-color);
      color: #000;
    }

    .history-content {
      max-height: 300px;
      overflow-y: auto;
      padding-right: 5px;
    }

    .history-item {
      margin-bottom: 20px;
      padding: 15px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      border-left: 4px solid var(--accent-color);
    }

    .history-item:last-child {
      margin-bottom: 0;
    }

    .history-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-color);
    }

    .history-command-name {
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .history-timestamp {
      font-size: 11px;
      color: #6a6a6a;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    }

    .history-url {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 11px;
      color: var(--text-primary);
      background: var(--bg-tertiary);
      padding: 8px;
      border-radius: 4px;
      border: 1px solid var(--border-color);
      word-break: break-all;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .history-url-text {
      flex: 1;
      word-break: break-all;
    }

    .history-copy-url-btn {
      flex-shrink: 0;
      padding: 4px 6px;
      border: 1px solid var(--accent-color);
      background: var(--bg-secondary);
      color: var(--accent-color);
      border-radius: 3px;
      cursor: pointer;
      font-size: 10px;
      font-weight: 500;
      transition: all 0.2s ease;
      min-width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .history-copy-url-btn:hover {
      background: var(--accent-color);
      color: white;
      transform: translateY(-1px);
    }

    .history-response {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.4;
      max-height: 200px;
      overflow-y: auto;
      padding: 10px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      border: 1px solid var(--border-color);
    }

    .history-response pre {
      margin: 0;
      font-family: inherit;
      font-size: inherit;
      line-height: inherit;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .history-success {
      border-left-color: var(--success-color);
    }

    .history-error {
      border-left-color: #ff6b6b;
    }

    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
    .history-content::-webkit-scrollbar,
    .history-response::-webkit-scrollbar,
    .response-content::-webkit-scrollbar,
    .results-container ul::-webkit-scrollbar {
      width: 8px;
    }

    .history-content::-webkit-scrollbar-track,
    .history-response::-webkit-scrollbar-track,
    .response-content::-webkit-scrollbar-track,
    .results-container ul::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
      border-radius: 4px;
    }

    .history-content::-webkit-scrollbar-thumb,
    .history-response::-webkit-scrollbar-thumb,
    .response-content::-webkit-scrollbar-thumb,
    .results-container ul::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 4px;
    }

    .history-content::-webkit-scrollbar-thumb:hover,
    .history-response::-webkit-scrollbar-thumb:hover,
    .response-content::-webkit-scrollbar-thumb:hover,
    .results-container ul::-webkit-scrollbar-thumb:hover {
      background: var(--accent-color);
    }

    /* æœç´¢å†å²è®°å½•æ ·å¼ - å‚è€ƒ .results-container çš„å®ç° */
    .search-history-container {
      position: relative;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      margin-top: 5px;
      margin-bottom: 10px;
      /* å‡å°‘åº•éƒ¨marginï¼Œæ›´å……åˆ†åˆ©ç”¨ç©ºé—´ */
      /* ä½¿ç”¨ä¸ .results-container ç›¸åŒçš„å¸ƒå±€æ–¹å¼ */
      display: flex;
      flex-direction: column;
      overflow: hidden;
      /* å…³é”®ï¼šå¤–å±‚å®¹å™¨ overflow: hidden */
      /* ä¸ä½¿ç”¨ flex: 1ï¼Œå› ä¸ºä¼šä¸ .results-container ç«äº‰ç©ºé—´ */
      /* é«˜åº¦ç”± JavaScript æ ¹æ®å¯ç”¨ç©ºé—´åŠ¨æ€è®¾ç½® */
      min-width: 200px;
      width: 100%;
      box-sizing: border-box;
    }

    .search-history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      border-bottom: 1px solid var(--border-color);
      background: var(--bg-tertiary);
      flex-shrink: 0;
      /* å…³é”®ï¼šheaderä¸å‚ä¸flexä¼¸ç¼©ï¼Œä¿æŒå›ºå®šé«˜åº¦ */
    }

    .search-history-header span {
      color: var(--text-secondary);
      font-weight: 500;
      font-size: 13px;
    }

    .search-history-header .clear-history-btn {
      background: none;
      border: none;
      color: var(--warning-color);
      cursor: pointer;
      font-size: 14px;
      padding: 2px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .search-history-header .clear-history-btn:hover {
      background: var(--bg-hover);
      transform: scale(1.1);
    }

    .search-history-list {
      /* ä½¿ç”¨ä¸ ul (æœç´¢ç»“æœåˆ—è¡¨) å®Œå…¨ç›¸åŒçš„æ»šåŠ¨å®ç° */
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      min-height: 0;
      /* å…³é”®ï¼šmin-height: 0 å…è®¸flexå­å…ƒç´ ç¼©å° */
      max-height: none;
      /* ä¸è®¾ç½®max-heightï¼Œç”±flexå¸ƒå±€è‡ªåŠ¨æ§åˆ¶ */
      padding-right: 8px;
      /* ä¸ºæ»šåŠ¨æ¡é¢„ç•™ç©ºé—´ */
      width: 100%;
      box-sizing: border-box;
      /* æ»šåŠ¨æ¡æ ·å¼ - Firefox */
      scrollbar-width: thin;
      scrollbar-color: var(--border-color) var(--bg-tertiary);
    }

    .search-history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      border-bottom: 1px solid var(--border-color);
      /* ç¡®ä¿å®½åº¦å˜åŒ–æ—¶å¸ƒå±€ç¨³å®š */
      width: 100%;
      box-sizing: border-box;
      /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œå½±å“é«˜åº¦ */
      min-height: 36px;
      flex-shrink: 0;
    }

    .search-history-item:last-child {
      border-bottom: none;
    }

    .search-history-item:hover {
      background: var(--bg-hover);
    }

    .search-history-item .history-text {
      color: var(--text-primary);
      font-size: 13px;
      flex: 1;
      /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œå½±å“é«˜åº¦è®¡ç®— */
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      min-width: 0;
    }

    .search-history-item .remove-history-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 16px;
      padding: 2px 6px;
      border-radius: 4px;
      transition: all 0.2s ease;
      opacity: 0.7;
    }

    .search-history-item .remove-history-btn:hover {
      background: rgba(255, 107, 107, 0.2);
      color: #ff6b6b;
      opacity: 1;
    }

    /* æœç´¢æ¡†å®¹å™¨ç›¸å¯¹å®šä½ */
    .search-section {
      position: relative;
      display: flex;
      flex-direction: column;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
        margin: 10px;
      }

      .left-panel,
      .right-panel {
        padding: 20px;
      }

      input {
        font-size: 16px;
        /* é˜²æ­¢iOSç¼©æ”¾ */
      }
    }

    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ - ç¡®ä¿æœç´¢å†å²åˆ—è¡¨çš„æ»šåŠ¨æ¡å¯è§ */
    .search-history-list::-webkit-scrollbar {
      width: 8px;
      /* å³ä½¿å†…å®¹ä¸éœ€è¦æ»šåŠ¨ï¼Œä¹Ÿæ˜¾ç¤ºæ»šåŠ¨æ¡è½¨é“ */
      display: block;
    }

    .search-history-list::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
      border-radius: 4px;
      /* ç¡®ä¿è½¨é“å§‹ç»ˆå¯è§ */
      min-height: 100px;
    }

    .search-history-list::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 4px;
      /* å³ä½¿å†…å®¹ä¸éœ€è¦æ»šåŠ¨ï¼Œä¹Ÿæ˜¾ç¤ºæ»šåŠ¨æ¡æ»‘å— */
      min-height: 20px;
    }

    .search-history-list::-webkit-scrollbar-thumb:hover {
      background: var(--accent-color);
    }

    /* å½“å†…å®¹ä¸éœ€è¦æ»šåŠ¨æ—¶ï¼Œä»ç„¶æ˜¾ç¤ºæ»šåŠ¨æ¡è½¨é“ */
    .search-history-list::-webkit-scrollbar-thumb:disabled {
      background: var(--border-color);
      opacity: 0.5;
    }

    /* å¼ºåˆ¶æ˜¾ç¤ºæ»šåŠ¨æ¡ï¼Œå½“å†…å®¹è¶…å‡ºæ—¶ */
    .search-history-list.force-scroll::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      opacity: 1;
    }

    .search-history-list.force-scroll::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
      opacity: 1;
    }
  </style>

  <!-- å¤šè¯­è¨€é…ç½® -->
  <script>
    // è¯­è¨€é…ç½®
    const i18n = {
      zh: {
        // UIç•Œé¢æ–‡æœ¬
        ui_title: "ğŸ“· ZCAM Camera Http Commands",
        ui_iplabel: "ğŸŒ ç›®æ ‡IPåœ°å€:",
        ui_ip_discrete_label: "IPåœ°å€èŒƒå›´:",
        ui_ip_mode_single: "å•ç›®æ ‡IP",
        ui_ip_mode_continuous: "è¿ç»­IP",
        ui_ip_mode_discrete: "ç¦»æ•£IP",
        ui_ip_start_label: "èµ·å§‹IPåœ°å€:",
        ui_ip_end_label: "ç»“æŸIPï¼ˆç¬¬4æ®µæ•°å­—ï¼‰:",
        ui_ip_placeholder: "192.168.1.100",
        ui_search_placeholder: "è¾“å…¥å…³é”®å­—æœç´¢å‘½ä»¤ï¼Œæˆ–'?' åˆ—å‡ºæ‰€æœ‰å‘½ä»¤",
        ui_favorites_title: "ğŸš€ å¸¸ç”¨å‘½ä»¤",
        ui_response_title: "ğŸ“¡ å‘½ä»¤å“åº”",
        ui_clear_btn: "æ¸…ç©º",
        ui_no_response: "æ‰§è¡Œå·¦ä¾§httpå‘½ä»¤æŸ¥çœ‹å“åº”",

        // æŒ‰é’®æ–‡æœ¬
        ui_btn_copy: "å¤åˆ¶",
        ui_btn_open: "æ‰“å¼€",
        ui_btn_execute: "æ‰§è¡Œ",
        ui_btn_executing: "æ‰§è¡Œä¸­...",

        // æœç´¢å†å²ç›¸å…³
        ui_history_title: "ğŸ” æœç´¢å†å²",
        ui_history_clear_btn: "ğŸ—‘ï¸",
        ui_history_remove_btn: "Ã—",
        ui_history_clear_tooltip: "æ¸…ç©ºæœç´¢å†å²",
        ui_history_remove_tooltip: "åˆ é™¤æ­¤æ¡å†å²",

        // çŠ¶æ€å’Œæ¶ˆæ¯
        ui_msg_executing: "ğŸ”„ æ­£åœ¨æ‰§è¡Œå‘½ä»¤...",
        ui_msg_no_results: "æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å‘½ä»¤",
        ui_msg_copied: "âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿",
        ui_msg_copy_failed: "å¤åˆ¶å¤±è´¥: ",
        ui_msg_parameters_required: "æ­¤å‘½ä»¤éœ€è¦å¡«å†™ä»¥ä¸‹å‚æ•°æ‰èƒ½æ‰§è¡Œï¼š",
        ui_msg_parameters_instruction: "è¯·å°†URLä¸­çš„å‚æ•°å ä½ç¬¦æ›¿æ¢ä¸ºå®é™…å€¼ã€‚",
        ui_msg_warning_command: "âš ï¸è­¦å‘Š",
        ui_msg_warning_command_desc: "æ‚¨å³å°†æ‰§è¡Œä¸€ä¸ªé‡è¦çš„å‘½ä»¤ï¼š",
        ui_msg_warning_command_confirm: "è¯·ç¡®è®¤æ˜¯å¦ç»§ç»­ï¼Ÿ",
        ui_msg_warning_command_multi_camera: "å°†å½±å“ {count} å°ç›¸æœº",
        ui_msg_executing_multi_ip: "æ­£åœ¨æ‰§è¡Œ {count} ä¸ªIPåœ°å€...",
        ui_msg_executing_multi_camera: "({count} å°ç›¸æœº)",
        ui_msg_btn_confirm: "ç¡®è®¤æ‰§è¡Œ",
        ui_error_no_valid_ip: "æœªæ‰¾åˆ°æœ‰æ•ˆçš„IPåœ°å€ï¼Œè¯·æ£€æŸ¥IPé…ç½®",
        ui_msg_btn_cancel: "å–æ¶ˆ",
        ui_github_btn_title: "åœ¨GitHubä¸ŠæŸ¥çœ‹",
        ui_zcam_doc_btn_title: "æŸ¥çœ‹ZCAM HTTP APIæ–‡æ¡£",
        ui_camera_admin_btn_title: "æ‰“å¼€ç›¸æœºåå°æ§åˆ¶",

        // é”™è¯¯ä¿¡æ¯
        ui_error_http: "âŒ HTTPé”™è¯¯: ",
        ui_error_timeout: "â° è¯·æ±‚è¶…æ—¶: è¿æ¥è¶…æ—¶ (",
        ui_error_timeout_suffix: "ç§’)ï¼Œç›¸æœºIPåœ°å€é”™è¯¯æˆ–ç›¸æœºæœªå¼€æœº",
        ui_error_network: "âŒ ç½‘ç»œé”™è¯¯: ",
        ui_error_commands_not_loaded: "é”™è¯¯ï¼šæ— æ³•åŠ è½½å‘½ä»¤æ•°æ®",
        ui_error_favorites_not_loaded: "é”™è¯¯ï¼šæ— æ³•åŠ è½½æ”¶è—æ•°æ®",
        ui_error_check_commands_file: "è¯·æ£€æŸ¥commands.jsæ–‡ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½",

        // å…¶ä»–æ–‡æœ¬
        ui_custom_command: "Custom Command",
        ui_copy_url_tooltip: "å¤åˆ¶é“¾æ¥åœ°å€",
        ui_ip_hint_tip: "IPåœ°å€èŒƒå›´æ”¯æŒçš„æ ¼å¼\n1ï¼šèµ·å§‹IP - ç»ˆæ­¢IPçš„ç¬¬4ä½æ•°ï¼Œæ¯”å¦‚ 192.168.1.2 - 100\n2ï¼šå®Œæ•´ç‹¬ç«‹çš„IPï¼Œæ¯”å¦‚ 192.168.2.2, 192.168.2.116\n3ï¼šä»…IPçš„ç¬¬4ä½æ•°ï¼Œè‡ªåŠ¨ä½¿ç”¨å‰ä¸€ä¸ªIPçš„å‰3æ®µï¼Œæ¯”å¦‚ 192.168.2.100,112,130\nä½¿ç”¨åŠè§’/å…¨è§’é€—å·,æˆ–åˆ†å·;æˆ–åæ–œæ /åˆ†éš”è¿™äº›è¾“å…¥çš„IP",

        // è°ƒè¯•ä¿¡æ¯
        debug_language_detected: "æ£€æµ‹åˆ°è¯­è¨€",
        debug_container_status: "å®¹å™¨çŠ¶æ€æ£€æŸ¥",
        debug_container_element: "å®¹å™¨å…ƒç´ ",
        debug_container_height: "å®¹å™¨é«˜åº¦",
        debug_container_style: "å®¹å™¨æ ·å¼",
        debug_list_element: "åˆ—è¡¨å…ƒç´ ",
        debug_list_height: "åˆ—è¡¨é«˜åº¦",
        debug_height_calculation: "é«˜åº¦è®¡ç®—è¯Šæ–­",
        debug_panel_width: "é¢æ¿å®½åº¦",
        debug_header_height: "å¤´éƒ¨é«˜åº¦",
        debug_item_count: "åˆ—è¡¨é¡¹æ•°é‡",
        debug_item_height: "æ¯ä¸ªé¡¹ç›®é«˜åº¦",
        debug_total_height: "åˆ—è¡¨é¡¹æ€»é«˜åº¦",
        debug_actual_height: "å®é™…éœ€è¦æ€»é«˜åº¦",
        debug_available_space: "å¯ç”¨ç©ºé—´",
        debug_search_bottom: "æœç´¢æ¡†åº•éƒ¨ä½ç½®",
        debug_favorites_top: "å¸¸ç”¨å‘½ä»¤é¡¶éƒ¨ä½ç½®",
        debug_url_test: "URLç»„åˆæµ‹è¯•",
        debug_input: "è¾“å…¥",
        debug_output: "è¾“å‡º",

        // æ—¶é—´æˆ³æœ¬åœ°åŒ–
        timestamp_locale_zh: "zh-CN",
        timestamp_locale_en: "en-US"
      },

      en: {
        // UI Interface Text
        ui_title: "ğŸ“· ZCAM Camera Http Commands",
        ui_iplabel: "ğŸŒ Target IP Address:",
        ui_ip_discrete_label: "IP Address Range:",
        ui_ip_mode_single: "Single IP",
        ui_ip_mode_continuous: "Continuous IP",
        ui_ip_mode_discrete: "Discrete IP",
        ui_ip_start_label: "Start IP Address:",
        ui_ip_end_label: "End IP (4th Segment):",
        ui_ip_placeholder: "192.168.1.100",
        ui_search_placeholder: "Enter keywords to search commands, or '?' to list all commands",
        ui_favorites_title: "ğŸš€ Favorite Commands",
        ui_response_title: "ğŸ“¡ Command Response",
        ui_clear_btn: "Clear",
        ui_no_response: "Execute the http command on the left to view the response",

        // Button Text
        ui_btn_copy: "Copy",
        ui_btn_open: "Open",
        ui_btn_execute: "Execute",
        ui_btn_executing: "Executing...",

        // Search History Related
        ui_history_title: "ğŸ” Search History",
        ui_history_clear_btn: "ğŸ—‘ï¸",
        ui_history_remove_btn: "Ã—",
        ui_history_clear_tooltip: "Clear search history",
        ui_history_remove_tooltip: "Delete this history item",

        // Status and Messages
        ui_msg_executing: "ğŸ”„ Executing command...",
        ui_msg_no_results: "No matching commands found",
        ui_msg_copied: "âœ… Copied to clipboard",
        ui_msg_copy_failed: "Copy failed: ",
        ui_msg_parameters_required: "This command requires the following parameters to execute:",
        ui_msg_parameters_instruction: "Please replace the parameter placeholders in the URL with actual values.",
        ui_msg_warning_command: "âš ï¸Warning",
        ui_msg_warning_command_desc: "You are about to execute an important command:",
        ui_msg_warning_command_confirm: "Do you want to continue?",
        ui_msg_warning_command_multi_camera: "Will affect {count} cameras",
        ui_msg_executing_multi_ip: "Executing {count} IP addresses...",
        ui_msg_executing_multi_camera: "({count} cameras)",
        ui_msg_btn_confirm: "Confirm",
        ui_error_no_valid_ip: "No valid IP address found, please check IP configuration",
        ui_msg_btn_cancel: "Cancel",
        ui_github_btn_title: "View on GitHub",
        ui_zcam_doc_btn_title: "View ZCAM Http API Doc",
        ui_camera_admin_btn_title: "Open Camera Admin Panel",

        // Error Messages
        ui_error_http: "âŒ HTTP Error: ",
        ui_error_timeout: "â° Request Timeout: Connection timeout (",
        ui_error_timeout_suffix: " seconds), camera IP address error or camera not powered on",
        ui_error_network: "âŒ Network Error: ",
        ui_error_commands_not_loaded: "Error: Failed to load command data",
        ui_error_favorites_not_loaded: "Error: Failed to load favorites data",
        ui_error_check_commands_file: "Please check if commands.js file is loaded correctly",

        // Other Text
        ui_custom_command: "Custom Command",
        ui_copy_url_tooltip: "Copy link address",
        ui_ip_hint_tip: "Supported IP address range formats:\n1: Start IP - End IP 4th segment, e.g. 192.168.1.2 - 100\n2: Complete independent IPs, e.g. 192.168.2.2, 192.168.2.116\n3: Only 4th segment, automatically uses the first 3 segments of the previous IP, e.g. 192.168.2.100,112,130\nUse comma, semicolon, or slash to separate these IP inputs",

        // Debug Information
        debug_language_detected: "Language detected",
        debug_container_status: "Container Status Check",
        debug_container_element: "Container Element",
        debug_container_height: "Container Height",
        debug_container_style: "Container Style",
        debug_list_element: "List Element",
        debug_list_height: "List Height",
        debug_height_calculation: "Height Calculation Diagnosis",
        debug_panel_width: "Panel Width",
        debug_header_height: "Header Height",
        debug_item_count: "Item Count",
        debug_item_height: "Item Height",
        debug_total_height: "Total Item Height",
        debug_actual_height: "Actual Required Height",
        debug_available_space: "Available Space",
        debug_search_bottom: "Search Input Bottom Position",
        debug_favorites_top: "Favorites Top Position",
        debug_url_test: "URL Combination Test",
        debug_input: "Input",
        debug_output: "Output",

        // Timestamp Localization
        timestamp_locale_zh: "zh-CN",
        timestamp_locale_en: "en-US"
      }
    };

    // è·å–æµè§ˆå™¨è¯­è¨€
    function getBrowserLanguage() {
      const browserLang = navigator.language || navigator.userLanguage;
      return browserLang.toLowerCase().startsWith('zh') ? 'zh' : 'en';
    }

    // è¯­è¨€æ£€æµ‹å’Œè®¾ç½®ï¼ˆæ”¯æŒlocalStorageï¼‰
    function detectLanguage() {
      // ä¼˜å…ˆä»localStorageè¯»å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨æµè§ˆå™¨è¯­è¨€
      let langCode = localStorage.getItem(LANGUAGE_STORAGE_KEY);
      if (!langCode || (langCode !== 'zh' && langCode !== 'en')) {
        langCode = getBrowserLanguage();
      }

      // è®¾ç½®HTML langå±æ€§
      document.documentElement.lang = langCode;

      // è®¾ç½®é¡µé¢æ ‡é¢˜
      document.title = i18n[langCode].ui_title;

      return langCode;
    }

    // è·å–å½“å‰è¯­è¨€
    function getCurrentLanguage() {
      return document.documentElement.lang || 'en';
    }

    // è·å–ç¿»è¯‘æ–‡æœ¬
    function t(key) {
      const lang = getCurrentLanguage();
      return i18n[lang][key] || i18n.en[key] || key;
    }

    // è·å–å½“å‰è¯­è¨€çš„æ—¶é—´æˆ³æœ¬åœ°åŒ–è®¾ç½®
    function getTimestampLocale() {
      const lang = getCurrentLanguage();
      return i18n[lang].timestamp_locale_zh || i18n.en.timestamp_locale_en || 'en-US';
    }

    // åº”ç”¨è¯­è¨€åˆ°é¡µé¢
    function applyLanguage() {
      // å¤„ç†æ‰€æœ‰å¸¦æœ‰ data-i18n å±æ€§çš„å…ƒç´ 
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (key) {
          element.textContent = t(key);
        }
      });

      // å¤„ç†æ‰€æœ‰å¸¦æœ‰ data-i18n-placeholder å±æ€§çš„å…ƒç´ 
      document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (key) {
          element.placeholder = t(key);
        }
      });

      // å¤„ç†æ‰€æœ‰å¸¦æœ‰ data-i18n-title å±æ€§çš„å…ƒç´ 
      document.querySelectorAll('[data-i18n-title]').forEach(element => {
        const key = element.getAttribute('data-i18n-title');
        if (key) {
          element.title = t(key);
        }
      });

      // æ›´æ–°IPè¾“å…¥tooltipæ–‡æœ¬
      const ipLabel = document.querySelector('label[for="ip-input-discrete"]');
      if (ipLabel) {
        ipLabel.setAttribute('data-tooltip', t('ui_ip_hint_tip'));
      }
    }

    // æ›´æ–°è¯­è¨€æŒ‰é’®çŠ¶æ€
    function updateLanguageButtons(lang) {
      const langButtons = document.querySelectorAll('.lang-btn');
      langButtons.forEach(btn => {
        if (btn.dataset.lang === lang) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }

    // åˆ‡æ¢è¯­è¨€
    function switchLanguage(lang) {
      if (lang !== 'zh' && lang !== 'en') return;
      
      // è®¾ç½®HTML langå±æ€§
      document.documentElement.lang = lang;
      
      // ä¿å­˜åˆ°localStorage
      localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
      
      // æ›´æ–°é¡µé¢æ ‡é¢˜
      document.title = i18n[lang].ui_title;
      
      // æ›´æ–°å‘½ä»¤æè¿°ï¼ˆå¦‚æœcommands.jsæ”¯æŒå¤šè¯­è¨€ï¼‰
      if (typeof initializeCommandDescriptions === 'function') {
        initializeCommandDescriptions();
      }
      
      // åº”ç”¨è¯­è¨€åˆ°é¡µé¢
      applyLanguage();
      
      // æ›´æ–°è¯­è¨€æŒ‰é’®çŠ¶æ€
      updateLanguageButtons(lang);
      
      // é‡æ–°æ¸²æŸ“å¸¸ç”¨å‘½ä»¤æŒ‰é’®
      if (typeof renderFavorites === 'function') {
        renderFavorites();
      }
      
      console.log('Language switched to:', lang);
    }

    // åˆå§‹åŒ–è¯­è¨€åˆ‡æ¢å™¨
    function initLanguageSwitcher() {
      const langButtons = document.querySelectorAll('.lang-btn');
      langButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const lang = btn.dataset.lang;
          switchLanguage(lang);
        });
      });
      
      // åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€
      const currentLang = getCurrentLanguage();
      updateLanguageButtons(currentLang);
    }
  </script>
</head>

<body>
  <div class="main-container">
    <div class="left-panel">
      <div class="title-section">
        <h1 data-i18n="ui_title">ğŸ“· ZCam Http Commands</h1>
        <div class="button-group">
          <a href="https://github.com/Jack-vexel-ws/zcamhttp" id="github-link" class="github-btn" data-i18n-title="ui_github_btn_title" target="_blank">
            <svg class="github-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
          </a>
          <a href="https://github.com/imaginevision/Z-Camera-Doc/blob/master/E2/protocol/http/http.md" id="zcam-doc-btn" class="zcam-doc-btn" data-i18n-title="ui_zcam_doc_btn_title" target="_blank">
            <img src="images/zcam_icon.svg" class="zcam-doc-icon" alt="ZCAM Icon">
          </a>
          <div class="language-switcher">
            <button class="lang-btn" data-lang="zh" title="ä¸­æ–‡">ä¸­</button>
            <button class="lang-btn" data-lang="en" title="English">EN</button>
          </div>
        </div>
      </div>

      <!-- IPåœ°å€è¾“å…¥æ¡† -->
      <div class="ip-section">
        <!-- æ¨¡å¼é€‰æ‹©å™¨ - æ ‡ç­¾é¡µ -->
        <div class="ip-mode-selector">
          <button class="ip-mode-tab active" data-mode="single" data-i18n="ui_ip_mode_single">å•ç›®æ ‡IP</button>
          <button class="ip-mode-tab" data-mode="continuous" data-i18n="ui_ip_mode_continuous">è¿ç»­IP</button>
          <button class="ip-mode-tab" data-mode="discrete" data-i18n="ui_ip_mode_discrete">ç¦»æ•£IP</button>
        </div>

        <!-- å•IPæ¨¡å¼å®¹å™¨ -->
        <div class="ip-mode-container" data-mode="single">
          <label for="ip-input-single" data-i18n="ui_iplabel">ğŸŒ ç›®æ ‡IPåœ°å€:</label>
          <div class="ip-input-container">
            <input type="text" id="ip-input-single" placeholder="192.168.1.100" value="192.168.1.100">
            <button id="camera-admin-btn" class="camera-admin-btn" data-i18n-title="ui_camera_admin_btn_title" onclick="openCameraAdmin()">
              <svg class="camera-admin-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- è¿ç»­IPæ¨¡å¼å®¹å™¨ -->
        <div class="ip-mode-container" data-mode="continuous" style="display:none;">
          <div class="ip-input-row">
            <div class="ip-input-group">
              <label for="ip-input-start" data-i18n="ui_ip_start_label">èµ·å§‹IPåœ°å€:</label>
              <input type="text" id="ip-input-start" placeholder="192.168.1.100" value="192.168.1.100">
            </div>
            <div class="ip-input-group">
              <label for="ip-input-end" data-i18n="ui_ip_end_label">ç»“æŸIPï¼ˆç¬¬4æ®µæ•°å­—ï¼‰:</label>
              <div class="refresh-interval-wrapper">
                <input type="number" id="ip-input-end" class="refresh-interval-input" placeholder="200" value="200" min="1" max="255">
                <div class="refresh-interval-controls">
                  <button type="button" class="refresh-interval-btn" id="ip-end-increase">
                    <svg viewBox="0 0 10 10" fill="currentColor">
                      <path d="M5 2L8 7H2L5 2Z"/>
                    </svg>
                  </button>
                  <button type="button" class="refresh-interval-btn" id="ip-end-decrease">
                    <svg viewBox="0 0 10 10" fill="currentColor">
                      <path d="M5 8L2 3H8L5 8Z"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ç¦»æ•£IPæ¨¡å¼å®¹å™¨ -->
        <div class="ip-mode-container" data-mode="discrete" style="display:none;">
          <label for="ip-input-discrete" class="ip-tooltip" data-i18n="ui_ip_discrete_label">IPåœ°å€èŒƒå›´:</label>
          <input type="text" id="ip-input-discrete" placeholder="192.168.1.100-200, 192.168.1.4, 192.168.1.116,121,119" value="">
        </div>
      </div>

      <!-- æœç´¢æ¡† -->
      <div class="search-section">
        <div class="search-input-group">
          <input type="text" id="search" data-i18n-placeholder="ui_search_placeholder"
            placeholder="è¾“å…¥å…³é”®å­—æœç´¢å‘½ä»¤ï¼Œæˆ–ç‚¹å‡»æœç´¢ç»“æœå°†URLå¡«å…¥æ­¤å¤„ï¼ŒæŒ‰å›è½¦æ‰§è¡Œ" autocomplete="off">
          <button class="action-btn action-btn-execute" id="btn-execute-command" data-i18n="ui_btn_execute">æ‰§è¡Œ</button>
        </div>
        <div class="results-container">
          <ul id="results"></ul>
        </div>
      </div>

      <!-- å¸¸ç”¨å‘½ä»¤æŒ‰é’® -->
      <div class="favorites">
        <h2 data-i18n="ui_favorites_title">ğŸš€ å¸¸ç”¨å‘½ä»¤</h2>
        <div id="fav-buttons"></div>
      </div>
    </div>

    <!-- å³ä¾§å“åº”æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="right-panel">
      <div class="response-header">
        <h2 data-i18n="ui_response_title">ğŸ“¡ å‘½ä»¤å“åº”</h2>
        <button id="clear-response" class="clear-btn" data-i18n="ui_clear_btn">æ¸…ç©º</button>
      </div>
      <div id="response-content" class="response-content">
        <div class="no-response" data-i18n="ui_no_response">ç‚¹å‡»å·¦ä¾§å‘½ä»¤é“¾æ¥æŸ¥çœ‹å“åº”</div>
      </div>
    </div>
  </div>

  <script src="commands.js"></script>
  <script>
    // æ·»åŠ é”™è¯¯å¤„ç†å’Œè°ƒè¯•ä¿¡æ¯
    console.log("HTML page loading started");

    // è¯­è¨€é€‰æ‹©æœ¬åœ°å­˜å‚¨ç®¡ç†ï¼ˆéœ€è¦åœ¨detectLanguageä¹‹å‰å®šä¹‰ï¼‰
    const LANGUAGE_STORAGE_KEY = 'zcamLanguage';

    // æ£€æµ‹å¹¶è®¾ç½®è¯­è¨€
    const currentLang = detectLanguage();
    console.log(t("debug_language_detected") + ":", currentLang);

    // æ£€æŸ¥commandså’Œfavoriteså˜é‡æ˜¯å¦å·²åŠ è½½
    if (typeof commands === 'undefined') {
      console.error("commands variable is undefined!");
      document.body.innerHTML = '<h1>' + t('ui_error_commands_not_loaded') + '</h1><p>' + t('ui_error_check_commands_file') + '</p>';
      throw new Error("commands variable is undefined");
    }

    if (typeof favorites === 'undefined') {
      console.error("favorites variable is undefined!");
      document.body.innerHTML = '<h1>' + t('ui_error_favorites_not_loaded') + '</h1><p>' + t('ui_error_check_commands_file') + '</p>';
      throw new Error("favorites variable is undefined");
    }

    console.log("Variable check passed, starting page initialization");

    // IPåœ°å€æœ¬åœ°å­˜å‚¨ç®¡ç†
    const IP_STORAGE_KEY = 'zcamLastIP';
    const IP_MODE_KEY = 'zcamIPMode';
    const DEFAULT_IP = '192.168.1.100';
    
    // HTTPè¯·æ±‚è¶…æ—¶æ—¶é—´é…ç½®ï¼ˆæ¯«ç§’ï¼‰
    // å½“ç›¸æœºIPä¸å­˜åœ¨æˆ–ç›¸æœºå·²å…³æœºæ—¶ï¼Œéœ€è¦ç­‰å¾…æ­¤æ—¶é—´åæ‰ä¼šè¶…æ—¶
    // é»˜è®¤30ç§’ï¼Œå¯æ ¹æ®ç½‘ç»œç¯å¢ƒè°ƒæ•´ï¼šå±€åŸŸç½‘å»ºè®®10-30ç§’ï¼Œå¹¿åŸŸç½‘å»ºè®®30-60ç§’
    const HTTP_REQUEST_TIMEOUT = 3000; // 3ç§’

    // DOMå…ƒç´ å¼•ç”¨
    const ipInputSingle = document.getElementById("ip-input-single");
    const ipInputStart = document.getElementById("ip-input-start");
    const ipInputEnd = document.getElementById("ip-input-end");
    const ipInputDiscrete = document.getElementById("ip-input-discrete");
    const ipModeTabs = document.querySelectorAll('.ip-mode-tab');
    const input = document.getElementById("search");
    const results = document.getElementById("results");
    const favButtons = document.getElementById("fav-buttons");
    const responseContent = document.getElementById("response-content");
    const clearResponseBtn = document.getElementById("clear-response");

    // å‘åå…¼å®¹ï¼šä¿ç•™æ—§çš„ipInputå¼•ç”¨æŒ‡å‘å•IPè¾“å…¥æ¡†
    const ipInput = ipInputSingle;

    // åˆå§‹åŒ–IPæ¨¡å¼
    const savedMode = localStorage.getItem(IP_MODE_KEY) || 'single';
    // è®¾ç½®æ ‡ç­¾é¡µactiveçŠ¶æ€
    ipModeTabs.forEach(tab => {
      if (tab.getAttribute('data-mode') === savedMode) {
        tab.classList.add('active');
      } else {
        tab.classList.remove('active');
      }
    });
    switchIPMode(savedMode);

    // åˆå§‹åŒ–IPåœ°å€è¾“å…¥æ¡†
    const savedIP = loadIPFromStorage();
    if (savedMode === 'single') {
      ipInputSingle.value = savedIP;
    } else if (savedMode === 'continuous') {
      const savedStart = localStorage.getItem('zcamLastIP_continuous_start') || savedIP;
      const savedEnd = localStorage.getItem('zcamLastIP_continuous_end') || '200';
      ipInputStart.value = savedStart;
      ipInputEnd.value = savedEnd;
    } else if (savedMode === 'discrete') {
      const savedDiscrete = localStorage.getItem('zcamLastIP_discrete') || '';
      ipInputDiscrete.value = savedDiscrete;
    }
    console.log('IP input initialized with mode:', savedMode, 'value:', savedIP);

    // æœç´¢å†å²è®°å½•ç®¡ç†
    let searchHistory = JSON.parse(localStorage.getItem('zcamSearchHistory') || '[]');
    const maxHistoryItems = 10; // Maximum 10 search history items

    // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œæ·»åŠ ä¸€äº›ç¤ºä¾‹URLè®°å½•ç”¨äºæµ‹è¯•
    if (searchHistory.length === 0) {
      const currentIP = getCurrentIP();
      searchHistory = [
        `http://${currentIP}/battery`,
        `http://${currentIP}/zoom`,
        `http://${currentIP}/status`
      ];
      localStorage.setItem('zcamSearchHistory', JSON.stringify(searchHistory));
      console.log('Added sample URL history records');
    }

    console.log('Initializing search history:', searchHistory);

    // ===== IPè§£æå‡½æ•°ç»„ =====
    
    // è·å–å½“å‰IPæ¨¡å¼
    function getCurrentIPMode() {
      const activeTab = document.querySelector('.ip-mode-tab.active');
      return activeTab ? activeTab.getAttribute('data-mode') : 'single';
    }

    // è§£æå•IP
    function parseSingleIP() {
      const ip = ipInputSingle.value.trim();
      if (!ip) return [];
      // éªŒè¯IPæ ¼å¼
      const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
      if (!ipRegex.test(ip)) return [];
      return [ip];
    }

    // è§£æè¿ç»­IP
    function parseContinuousIP() {
      const startIP = ipInputStart.value.trim();
      const endNum = parseInt(ipInputEnd.value.trim());
      
      if (!startIP || isNaN(endNum)) return [];
      
      // éªŒè¯èµ·å§‹IPæ ¼å¼
      const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
      if (!ipRegex.test(startIP)) return [];
      
      // æå–å‰3æ®µIP
      const parts = startIP.split('.');
      if (parts.length !== 4) return [];
      
      const baseIP = parts.slice(0, 3).join('.');
      const startNum = parseInt(parts[3]);
      
      if (isNaN(startNum) || startNum < 1 || startNum > 255) return [];
      if (endNum < 1 || endNum > 255) return [];
      
      // å¦‚æœèµ·å§‹æ•°å­—å¤§äºç»“æŸæ•°å­—ï¼Œè‡ªåŠ¨äº¤æ¢å®ƒä»¬
      let actualStartNum = startNum;
      let actualEndNum = endNum;
      if (startNum > endNum) {
        actualStartNum = endNum;
        actualEndNum = startNum;
      }
      
      // ç”ŸæˆIPåˆ—è¡¨ï¼ˆåŒ…å«ä¸¤ç«¯ï¼‰
      const ipList = [];
      for (let i = actualStartNum; i <= actualEndNum; i++) {
        ipList.push(`${baseIP}.${i}`);
      }
      
      return ipList;
    }

    // è§£æç¦»æ•£IP
    function parseDiscreteIP() {
      const input = ipInputDiscrete.value.trim();
      if (!input) return [];
      
      const ipList = [];
      // æ”¯æŒå¤šç§åˆ†éš”ç¬¦ï¼šåŠè§’/å…¨è§’é€—å·ã€åˆ†å·ã€åæ–œæ 
      // æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼š, ï¼Œ ; ï¼› / ï¼
      const parts = input.split(/[,\sï¼Œï¼›;\/ï¼]+/).map(p => p.trim()).filter(p => p);
      let currentBaseIP = ''; // å­˜å‚¨å½“å‰çš„åŸºç¡€IPï¼ˆå‰3æ®µï¼‰ï¼Œç”¨äºå¤„ç†ç®€å†™æ•°å­—
      
      for (const part of parts) {
        // æ£€æŸ¥æ˜¯å¦æ˜¯èŒƒå›´æ ¼å¼ (192.168.1.100-200 æˆ– 192.168.1.100~200)
        const rangeMatch = part.match(/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.)(\d{1,3})\s*[-~]\s*(\d{1,3})$/);
        if (rangeMatch) {
          const baseIP = rangeMatch[1];
          let startNum = parseInt(rangeMatch[2]);
          let endNum = parseInt(rangeMatch[3]);
          
          if (startNum >= 1 && startNum <= 255 && endNum >= 1 && endNum <= 255) {
            // å¦‚æœèµ·å§‹æ•°å­—å¤§äºç»“æŸæ•°å­—ï¼Œè‡ªåŠ¨äº¤æ¢å®ƒä»¬
            if (startNum > endNum) {
              const temp = startNum;
              startNum = endNum;
              endNum = temp;
            }
            
            // æ›´æ–°å½“å‰åŸºç¡€IP
            currentBaseIP = baseIP;
            for (let i = startNum; i <= endNum; i++) {
              ipList.push(`${baseIP}${i}`);
            }
          }
        } else {
          // æ£€æŸ¥æ˜¯å¦æ˜¯å®Œæ•´IP (192.168.1.116)
          const ipRegex = /^(\d{1,3}\.\d{1,3}\.\d{1,3}\.)(\d{1,3})$/;
          const ipMatch = part.match(ipRegex);
          if (ipMatch) {
            // å®Œæ•´IPï¼Œæ›´æ–°å½“å‰åŸºç¡€IPå¹¶æ·»åŠ åˆ°åˆ—è¡¨
            currentBaseIP = ipMatch[1];
            const fullIP = part;
            // éªŒè¯IPå„éƒ¨åˆ†æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
            const ipParts = fullIP.split('.').map(Number);
            if (ipParts.every(p => p >= 0 && p <= 255)) {
              ipList.push(fullIP);
            }
          } else {
            // æ£€æŸ¥æ˜¯å¦åªæ˜¯æ•°å­— (å¦‚ 121)
            const numMatch = part.match(/^(\d{1,3})$/);
            if (numMatch) {
              const num = parseInt(numMatch[1]);
              if (num >= 1 && num <= 255 && currentBaseIP) {
                // ä½¿ç”¨å½“å‰åŸºç¡€IP + æ•°å­—
                ipList.push(`${currentBaseIP}${num}`);
              }
              // å¦‚æœæ²¡æœ‰åŸºç¡€IPï¼Œå¿½ç•¥è¿™ä¸ªæ•°å­—ï¼ˆæˆ–å¯ä»¥æŠ¥é”™ï¼Œä½†è¿™é‡Œé€‰æ‹©å¿½ç•¥ï¼‰
            }
          }
        }
      }
      
      // å»é‡å¹¶æ’åº
      return [...new Set(ipList)].sort((a, b) => {
        const aParts = a.split('.').map(Number);
        const bParts = b.split('.').map(Number);
        for (let i = 0; i < 4; i++) {
          if (aParts[i] !== bParts[i]) {
            return aParts[i] - bParts[i];
          }
        }
        return 0;
      });
    }

    // ä¸»è§£æå‡½æ•°ï¼šæ ¹æ®å½“å‰æ¨¡å¼è§£æIPåˆ—è¡¨
    function parseIPList() {
      const mode = getCurrentIPMode();
      switch (mode) {
        case 'single':
          return parseSingleIP();
        case 'continuous':
          return parseContinuousIP();
        case 'discrete':
          return parseDiscreteIP();
        default:
          return parseSingleIP();
      }
    }

    // è·å–ä»£è¡¨æ€§IPåœ°å€ï¼ˆç”¨äºæ˜¾ç¤ºå’ŒURLç»„åˆï¼‰
    function _getMainIP() {
      const mode = getCurrentIPMode();
      switch (mode) {
        case 'single':
          return ipInputSingle.value.trim() || DEFAULT_IP;
        case 'continuous':
          return ipInputStart.value.trim() || DEFAULT_IP;
        case 'discrete':
          const ipList = parseDiscreteIP();
          return ipList.length > 0 ? ipList[0] : DEFAULT_IP;
        default:
          return DEFAULT_IP;
      }
    }

    // Get current IP address (ä¿æŒå‘åå…¼å®¹)
    function getCurrentIP() {
      return _getMainIP();
    }

    // åŠ è½½IPåœ°å€åˆ°è¾“å…¥æ¡†ï¼ˆæ ¹æ®æ¨¡å¼ï¼‰
    function loadIPToInputs(mode) {
      if (mode === 'single') {
        const savedIP = localStorage.getItem('zcamLastIP_single') || localStorage.getItem(IP_STORAGE_KEY) || DEFAULT_IP;
        if (ipInputSingle) {
          ipInputSingle.value = savedIP;
        }
      } else if (mode === 'continuous') {
        const savedStart = localStorage.getItem('zcamLastIP_continuous_start') || DEFAULT_IP;
        const savedEnd = localStorage.getItem('zcamLastIP_continuous_end') || '200';
        if (ipInputStart) {
          ipInputStart.value = savedStart;
        }
        if (ipInputEnd) {
          ipInputEnd.value = savedEnd;
        }
      } else if (mode === 'discrete') {
        const savedDiscrete = localStorage.getItem('zcamLastIP_discrete') || '';
        if (ipInputDiscrete) {
          ipInputDiscrete.value = savedDiscrete;
        }
      }
    }

    // IPæ¨¡å¼åˆ‡æ¢å‡½æ•°
    function switchIPMode(mode) {
      // å…ˆä¿å­˜å½“å‰æ¨¡å¼çš„é…ç½®ï¼ˆåœ¨åˆ‡æ¢å‰ä¿å­˜ï¼‰
      const currentMode = getCurrentIPMode();
      if (currentMode !== mode) {
        saveIPToStorage();
      }
      
      // éšè—æ‰€æœ‰æ¨¡å¼å®¹å™¨
      document.querySelectorAll('.ip-mode-container').forEach(container => {
        container.style.display = 'none';
      });
      
      // æ˜¾ç¤ºé€‰ä¸­çš„æ¨¡å¼å®¹å™¨
      const selectedContainer = document.querySelector(`.ip-mode-container[data-mode="${mode}"]`);
      if (selectedContainer) {
        selectedContainer.style.display = 'block';
      }
      
      // åŠ è½½æ–°æ¨¡å¼çš„ä¿å­˜å€¼
      loadIPToInputs(mode);
      
      // ä¿å­˜æ¨¡å¼åˆ°æœ¬åœ°å­˜å‚¨
      localStorage.setItem(IP_MODE_KEY, mode);
      console.log('IP mode switched to:', mode);
      
      // å¦‚æœæ˜¯ç¦»æ•£IPæ¨¡å¼ï¼Œé‡æ–°åˆå§‹åŒ–tooltipï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿DOMå·²æ›´æ–°ï¼‰
      if (mode === 'discrete') {
        setTimeout(() => {
          if (typeof initIPTooltip === 'function') {
            initIPTooltip();
          }
        }, 100);
      }
    }

    // ä¿å­˜IPåœ°å€åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆæ ¹æ®å½“å‰æ¨¡å¼ï¼‰
    function saveIPToStorage(ip) {
      const mode = getCurrentIPMode();
      if (mode === 'single') {
        // å•IPæ¨¡å¼ï¼šä¼˜å…ˆä½¿ç”¨ä¼ å…¥çš„å‚æ•°ï¼Œå¦åˆ™ä»è¾“å…¥æ¡†è¯»å–
        const singleIP = ip ? ip.trim() : (ipInputSingle ? ipInputSingle.value.trim() : '');
        if (singleIP !== '') {
          localStorage.setItem(IP_STORAGE_KEY, singleIP);
          localStorage.setItem('zcamLastIP_single', singleIP);
          console.log('Single IP address saved to storage:', singleIP);
        }
      } else if (mode === 'continuous') {
        // è¿ç»­IPæ¨¡å¼ï¼šä¿å­˜èµ·å§‹IPå’Œç»“æŸæ•°å­—
        const startIP = ipInputStart ? ipInputStart.value.trim() : '';
        const endNum = ipInputEnd ? ipInputEnd.value.trim() : '';
        if (startIP !== '') {
          localStorage.setItem('zcamLastIP_continuous_start', startIP);
          console.log('Continuous IP start saved to storage:', startIP);
        }
        if (endNum !== '') {
          localStorage.setItem('zcamLastIP_continuous_end', endNum);
          console.log('Continuous IP end saved to storage:', endNum);
        }
        // å‘åå…¼å®¹ï¼šå¦‚æœæœ‰ä¼ å…¥ipå‚æ•°ï¼Œä¹Ÿä¿å­˜åˆ°æ—§é”®
        if (ip && ip.trim() !== '') {
          localStorage.setItem(IP_STORAGE_KEY, ip.trim());
        }
      } else if (mode === 'discrete') {
        // ç¦»æ•£IPæ¨¡å¼ï¼šä¿å­˜å®Œæ•´çš„IPåˆ—è¡¨å­—ç¬¦ä¸²
        const discreteIP = ipInputDiscrete ? ipInputDiscrete.value.trim() : '';
        if (discreteIP !== '') {
          localStorage.setItem('zcamLastIP_discrete', discreteIP);
          console.log('Discrete IP list saved to storage:', discreteIP);
        }
      }
    }

    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½IPåœ°å€ï¼ˆå‘åå…¼å®¹ï¼‰
    function loadIPFromStorage() {
      const mode = getCurrentIPMode();
      if (mode === 'single') {
        const savedIP = localStorage.getItem('zcamLastIP_single') || localStorage.getItem(IP_STORAGE_KEY);
        if (savedIP && savedIP.trim() !== '') {
          console.log('IP address loaded from storage:', savedIP);
          return savedIP.trim();
        }
      } else if (mode === 'continuous') {
        const savedStart = localStorage.getItem('zcamLastIP_continuous_start');
        if (savedStart) return savedStart;
      } else if (mode === 'discrete') {
        const savedDiscrete = localStorage.getItem('zcamLastIP_discrete');
        if (savedDiscrete) return savedDiscrete;
      }
      
      // å‘åå…¼å®¹ï¼šå°è¯•åŠ è½½æ—§çš„IP_STORAGE_KEY
      const savedIP = localStorage.getItem(IP_STORAGE_KEY);
      if (savedIP && savedIP.trim() !== '') {
        console.log('IP address loaded from storage (legacy):', savedIP);
        return savedIP.trim();
      }
      
      console.log('No saved IP found, using default:', DEFAULT_IP);
      return DEFAULT_IP;
    }

    // æ·»åŠ æœç´¢å†å²è®°å½• - åªä¿å­˜å®Œæ•´çš„HTTP URL
    function addSearchHistory(query) {
      console.log('addSearchHistory called, query:', query);
      if (query.trim() === "" || query === "?" || query === "ï¼Ÿ") {
        console.log('Skipping invalid query');
        return;
      }

      // åªä¿å­˜å®Œæ•´çš„HTTP URLï¼Œä¸ä¿å­˜å…³é”®å­—æˆ–å‘½ä»¤æè¿°
      if (!query.startsWith('http://') && !query.startsWith('https://')) {
        console.log('Skipping non-URL query, only saving complete HTTP URLs');
        return;
      }

      // Remove duplicates
      searchHistory = searchHistory.filter(item => item !== query);

      // Add to beginning
      searchHistory.unshift(query);

      // Limit history count
      if (searchHistory.length > maxHistoryItems) {
        searchHistory = searchHistory.slice(0, maxHistoryItems);
      }

      // Save to local storage
      localStorage.setItem('zcamSearchHistory', JSON.stringify(searchHistory));
      console.log('Search history updated, current history:', searchHistory);
    }

    // æ˜¾ç¤ºæœç´¢å†å²è®°å½•
    function showSearchHistory() {
      console.log('showSearchHistory called, history count:', searchHistory.length);
      if (searchHistory.length === 0) {
        console.log('No search history records');
        return;
      }

      const historyContainer = document.createElement('div');
      historyContainer.className = 'search-history-container';

      // è·å–å½“å‰IPåœ°å€
      const currentIP = getCurrentIP();

      // Process history records, replace IP address if it's a complete URL
      const processedHistory = searchHistory.map(item => {
        if (item.startsWith('http://') || item.startsWith('https://')) {
          // Is complete URL, replace IP address
          const updatedURL = replaceIPInURL(item, currentIP);
          console.log(`History URL updated: ${item} -> ${updatedURL}`);
          return updatedURL;
        }
        // Not a URL, keep as is
        return item;
      });

      historyContainer.innerHTML = `
           <div class="search-history-header">
             <span>${t('ui_history_title')}</span>
             <button class="clear-history-btn" onclick="clearSearchHistory()" title="${t('ui_history_clear_tooltip')}">${t('ui_history_clear_btn')}</button>
           </div>
          <div class="search-history-list">
            ${processedHistory.map((item, index) => `
              <div class="search-history-item" onclick="selectHistoryItem('${item}', ${index})">
                <span class="history-text">${item}</span>
                <button class="remove-history-btn" onclick="removeHistoryItem('${searchHistory[index]}', event)" title="${t('ui_history_remove_tooltip')}">${t('ui_history_remove_btn')}</button>
              </div>
            `).join('')}
          </div>
        `;

      // Remove existing history container
      const existingHistory = document.querySelector('.search-history-container');
      if (existingHistory) {
        existingHistory.remove();
      }

      // Insert below search input group, before results-container
      const searchSection = input.closest('.search-section');
      const searchInputGroup = input.closest('.search-input-group');
      const resultsContainer = searchSection.querySelector('.results-container');
      
      // æ’å…¥åˆ°æœç´¢è¾“å…¥ç»„ä¹‹åï¼Œç»“æœå®¹å™¨ä¹‹å‰
      if (searchInputGroup && searchInputGroup.nextSibling) {
        searchSection.insertBefore(historyContainer, searchInputGroup.nextSibling);
      } else {
        searchSection.insertBefore(historyContainer, resultsContainer);
      }
      
      // å…³é”®ï¼šå½“å†å²é¢æ¿æ˜¾ç¤ºæ—¶ï¼Œä¸´æ—¶éšè—ç»“æœå®¹å™¨ï¼Œé¿å…flexå¸ƒå±€ç«äº‰ç©ºé—´
      if (resultsContainer) {
        resultsContainer.style.display = 'none';
      }

      // Force wait for DOM rendering to complete before calculating height
      // ä½¿ç”¨åŒé‡å»¶è¿Ÿï¼Œç¡®ä¿DOMå®Œå…¨æ¸²æŸ“å’Œå¸ƒå±€è®¡ç®—å®Œæˆ
      setTimeout(() => {
        // Dynamically calculate and set maximum height of history panel
        adjustHistoryPanelHeight(historyContainer);
        
        // å†æ¬¡å»¶è¿Ÿï¼Œç¡®ä¿é«˜åº¦è®¾ç½®ç”Ÿæ•ˆ
        setTimeout(() => {
          // å¼ºåˆ¶è§¦å‘é‡æ’ï¼Œç¡®ä¿é«˜åº¦è®¾ç½®ç”Ÿæ•ˆ
          historyContainer.offsetHeight;
          
          // Check container status again
          console.log('=== ' + t('debug_container_status') + ' ===');
          console.log(t('debug_container_element') + ':', historyContainer);
          console.log(t('debug_container_height') + ':', historyContainer.offsetHeight);
          console.log(t('debug_container_style') + ':', getComputedStyle(historyContainer));
          console.log(t('debug_list_element') + ':', historyContainer.querySelector('.search-history-list'));
          console.log(t('debug_list_height') + ':', historyContainer.querySelector('.search-history-list').offsetHeight);

          console.log('Search history displayed');
        }, 50);
      }, 100);
    }

    // é€‰æ‹©å†å²è®°å½•é¡¹
    function selectHistoryItem(query, index) {
      // If index is provided, this is a processed URL, need to get original history item
      const originalQuery = index !== undefined ? searchHistory[index] : query;

      // Use processed URL (if query is a URL)
      input.value = query;
      input.focus();
      
      // æ›´æ–°æ‰§è¡ŒæŒ‰é’®çŠ¶æ€
      updateExecuteButtonState();

      // Check if it's URL format
      if (query.startsWith('http://') || query.startsWith('https://')) {
        // Is URL, clear search results, wait for user to press Enter
        results.innerHTML = "";
        // å…¨é€‰URLæ–‡æœ¬ï¼Œå°±åƒæµè§ˆå™¨åœ°å€æ é‚£æ ·
        input.select();
      } else if (query === "?" || query === "ï¼Ÿ") {
        // Is question mark, show all commands
        showResults(commands.map(cmd => ({
          ...cmd,
          url: replaceIPInURL(cmd.url, getCurrentIP())
        })));
      } else {
        // Is search keyword, execute search
        showResults(searchCommands(query));
      }

      // Hide history
      hideSearchHistory();
    }

    // åˆ é™¤å•æ¡å†å²è®°å½•
    function removeHistoryItem(query, event) {
      event.stopPropagation();
      searchHistory = searchHistory.filter(item => item !== query);
      localStorage.setItem('zcamSearchHistory', JSON.stringify(searchHistory));

      // Re-display history
      showSearchHistory();
    }

    // æ¸…ç©ºæœç´¢å†å²
    function clearSearchHistory() {
      searchHistory = [];
      localStorage.removeItem('zcamSearchHistory');
      hideSearchHistory();
    }

    // Dynamically adjust history panel height - ç®€åŒ–ç‰ˆæœ¬ï¼Œä½¿ç”¨ä¸æœç´¢ç»“æœåˆ—è¡¨ç›¸åŒçš„flexå¸ƒå±€
    function adjustHistoryPanelHeight(historyContainer) {
      if (!historyContainer) {
        console.error('adjustHistoryPanelHeight: historyContainer is null');
        return;
      }

      // Get position of favorites section
      const favoritesSection = document.querySelector('.favorites');
      if (!favoritesSection) {
        console.error('adjustHistoryPanelHeight: favoritesSection not found');
        return;
      }

      // Get position of search input group (which contains both input and execute button)
      const searchInput = document.getElementById('search');
      if (!searchInput) {
        console.error('adjustHistoryPanelHeight: search input not found');
        return;
      }
      const searchInputGroup = searchInput.closest('.search-input-group');
      if (!searchInputGroup) {
        console.error('adjustHistoryPanelHeight: search-input-group not found');
        return;
      }

      // è®¡ç®—å¯ç”¨é«˜åº¦ï¼ˆæ›´ç²¾ç¡®çš„è®¡ç®—ï¼Œå‡å°‘ç©ºé—´æµªè´¹ï¼‰
      const searchInputBottom = searchInputGroup.offsetTop + searchInputGroup.offsetHeight;
      const favoritesTop = favoritesSection.offsetTop;
      // åªå‡å»å†å²é¢æ¿çš„ margin-top (5px) å’Œ margin-bottom (10px)
      const availableHeight = favoritesTop - searchInputBottom - 5 - 10; // åªå‡å»15pxï¼ˆmargin-top + margin-bottomï¼‰

      // è·å–headeré«˜åº¦
      const headerElement = historyContainer.querySelector('.search-history-header');
      if (!headerElement) {
        console.error('adjustHistoryPanelHeight: header not found');
        return;
      }
      const headerHeight = headerElement.offsetHeight;
      
      // è·å–åˆ—è¡¨å…ƒç´ 
      const listElement = historyContainer.querySelector('.search-history-list');
      if (!listElement) {
        console.error('adjustHistoryPanelHeight: list element not found');
        return;
      }
      
      // è·å–å†å²è®°å½•é¡¹æ•°é‡
      const historyItems = historyContainer.querySelectorAll('.search-history-item');
      const itemCount = historyItems.length;
      const itemHeight = 36; // æ¯ä¸ªå†å²è®°å½•é¡¹çš„é«˜åº¦ï¼ˆå·²è°ƒæ•´ä¸ºæ›´ç´§å‡‘ï¼‰
      const totalContentHeight = itemCount * itemHeight;
      
      // ç›´æ¥è®¾ç½®å®¹å™¨é«˜åº¦ä¸ºå¯ç”¨é«˜åº¦ï¼Œç¡®ä¿å æ®æ‰€æœ‰å¯ç”¨ç©ºé—´
      // ä½¿ç”¨ !important ç¡®ä¿è¦†ç›–å…¶ä»–å¯èƒ½å½±å“é«˜åº¦çš„æ ·å¼
      // ä¸é™åˆ¶æœ€å¤§400pxï¼Œç›´æ¥ä½¿ç”¨å¯ç”¨é«˜åº¦ï¼ˆä½†è‡³å°‘200pxï¼‰
      const containerHeight = Math.max(200, availableHeight);
      
      // æ£€æŸ¥ .search-section çš„å®é™…é«˜åº¦ï¼Œç¡®ä¿å†å²é¢æ¿ä¸ä¼šè¶…å‡º
      const searchSection = historyContainer.closest('.search-section');
      const searchSectionHeight = searchSection ? searchSection.clientHeight : null;
      const searchSectionAvailable = searchSection ? searchSection.scrollHeight : null;
      
      console.log('Search section dimensions:', {
        clientHeight: searchSectionHeight,
        scrollHeight: searchSectionAvailable,
        offsetHeight: searchSection ? searchSection.offsetHeight : null
      });
      console.log('Calculated container height:', containerHeight);
      
      // å¦‚æœ search-section çš„å®é™…å¯ç”¨é«˜åº¦æ›´å°ï¼Œä½¿ç”¨è¾ƒå°çš„å€¼
      let finalHeight = containerHeight;
      if (searchSectionHeight) {
        // è®¡ç®— search-section ä¸­å†å²é¢æ¿å¯ä»¥ä½¿ç”¨çš„å®é™…ç©ºé—´
        // å‡å»è¾“å…¥æ¡†é«˜åº¦ã€å†å²é¢æ¿çš„ margin-top å’Œ margin-bottom
        const sectionAvailable = searchSectionHeight - searchInputGroup.offsetHeight - 5 - 10;
        if (sectionAvailable < containerHeight) {
          finalHeight = Math.max(200, sectionAvailable);
          console.log('Adjusted height due to search-section limit:', finalHeight, '(section available:', sectionAvailable, ')');
        }
      }
      
      historyContainer.style.setProperty('height', `${finalHeight}px`, 'important');
      historyContainer.style.setProperty('max-height', `${finalHeight}px`, 'important');
      historyContainer.style.setProperty('flex', 'none', 'important');
      // ç§»é™¤ flex: 1ï¼Œä½¿ç”¨å›ºå®šé«˜åº¦ï¼Œé¿å…è¢«å…¶ä»–flexå…ƒç´ å‹ç¼©
      
      const listAvailableHeight = containerHeight - headerHeight;
      
      console.log('=== History Panel Height Calculation ===');
      console.log('Search input group:', {
        offsetTop: searchInputGroup.offsetTop,
        offsetHeight: searchInputGroup.offsetHeight,
        bottom: searchInputBottom
      });
      console.log('Favorites section:', {
        offsetTop: favoritesTop
      });
      console.log('Available height calculation:', {
        favoritesTop: favoritesTop,
        searchInputBottom: searchInputBottom,
        marginTop: 5,
        marginBottom: 15,
        extraMargin: 5,
        availableHeight: availableHeight
      });
      console.log('Container dimensions:', {
        headerHeight: headerHeight,
        containerHeight: containerHeight,
        listAvailableHeight: listAvailableHeight
      });
      console.log('Content dimensions:', {
        itemCount: itemCount,
        itemHeight: itemHeight,
        totalContentHeight: totalContentHeight,
        willShowScrollbar: totalContentHeight > listAvailableHeight
      });
      console.log('Computed styles:', {
        containerHeight: getComputedStyle(historyContainer).height,
        containerMaxHeight: getComputedStyle(historyContainer).maxHeight,
        listHeight: getComputedStyle(listElement).height,
        listMaxHeight: getComputedStyle(listElement).maxHeight,
        listFlex: getComputedStyle(listElement).flex
      });
      console.log('Actual dimensions:', {
        containerOffsetHeight: historyContainer.offsetHeight,
        containerClientHeight: historyContainer.clientHeight,
        listOffsetHeight: listElement.offsetHeight,
        listClientHeight: listElement.clientHeight,
        listScrollHeight: listElement.scrollHeight
      });
    }


    // éšè—æœç´¢å†å²
    function hideSearchHistory() {
      const historyContainer = document.querySelector('.search-history-container');
      if (historyContainer) {
        historyContainer.remove();
      }
      
      // æ¢å¤ç»“æœå®¹å™¨çš„æ˜¾ç¤º
      const resultsContainer = document.querySelector('.results-container');
      if (resultsContainer) {
        resultsContainer.style.display = '';
      }
    }

    // Replace IP address in URL
    function replaceIPInURL(url, newIP) {
      // If URL is already complete http:// format, replace IP address
      if (url.startsWith('http://') || url.startsWith('https://')) {
        return url.replace(/http:\/\/[0-9.]+/, `http://${newIP}`);
      }

      // If URL is relative path (starts with /), combine with IP address
      if (url.startsWith('/')) {
        return `http://${newIP}${url}`;
      }

      // If URL is neither complete path nor relative path, add IP address and /
      return `http://${newIP}/${url}`;
    }

    // Test URL combination logic (for development use, can be deleted in production)
    function testURLCombination() {
      const testIP = "192.168.1.100";
      const testCases = [
        "/info",
        "/ctrl/nick_name",
        "/camera_status",
        "http://192.168.1.200/info",
        "relative_path"
      ];

      console.log("=== " + t('debug_url_test') + " ===");
      testCases.forEach(testURL => {
        const result = replaceIPInURL(testURL, testIP);
        console.log(`${t('debug_input')}: ${testURL} -> ${t('debug_output')}: ${result}`);
      });
    }

    // Run test after page loads
    if (typeof window !== 'undefined') {
      window.addEventListener('load', () => {
        setTimeout(testURLCombination, 1000);
      });
    }

    // Extract command name from URL
    function extractCommandNameFromURL(url) {
      try {
        // First try to find exact URL match in commands.js
        const currentIP = getCurrentIP();

        // Remove IP address part, get relative path
        let relativePath = '';
        if (url.startsWith('http://') || url.startsWith('https://')) {
          // Remove protocol and IP address parts
          const urlWithoutProtocol = url.replace(/^https?:\/\//, '');
          const ipPattern = /^[0-9.]+/;
          const match = urlWithoutProtocol.match(ipPattern);
          if (match) {
            relativePath = urlWithoutProtocol.substring(match[0].length);
          } else {
            relativePath = urlWithoutProtocol;
          }
        } else {
          relativePath = url;
        }

        // Ensure relative path starts with /
        if (!relativePath.startsWith('/')) {
          relativePath = '/' + relativePath;
        }

        console.log('Extracted relative path:', relativePath);

        // Find exact URL match in commands.js
        const exactMatch = commands.find(cmd => cmd.url === relativePath);
        if (exactMatch) {
          console.log('Found exact match command:', exactMatch.key);
          const description = exactMatch.description;
          return `${exactMatch.key} - ${description}`;
        }

        // If none found, return unknown command
        console.log('No matching command found, returning unknown command');
        return '';

      } catch (e) {
        // If URL parsing fails, try simple string processing
        try {
          // ç§»é™¤åè®®éƒ¨åˆ†
          let cleanUrl = url.replace(/^https?:\/\//, '');

          // ç§»é™¤IPåœ°å€éƒ¨åˆ†
          const ipPattern = /^[0-9.]+/;
          const match = cleanUrl.match(ipPattern);
          if (match) {
            cleanUrl = cleanUrl.substring(match[0].length);
          }

          // ç¡®ä¿ä»¥/å¼€å¤´
          if (!cleanUrl.startsWith('/')) {
            cleanUrl = '/' + cleanUrl;
          }

          // åœ¨commands.jsä¸­æŸ¥æ‰¾åŒ¹é…
          const exactMatch = commands.find(cmd => cmd.url === cleanUrl);
          if (exactMatch) {
            const description = exactMatch.description;
            return `${exactMatch.key} - ${description}`;
          }

          // å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„å‘½ä»¤ï¼Œè¿”å›ç©º
          return '';
        } catch (fallbackError) {
          return '';
        }
      }
    }

    // æ ¼å¼åŒ–JSONæ˜¾ç¤º
    function formatJSON(jsonString) {
      try {
        const obj = JSON.parse(jsonString);
        return JSON.stringify(obj, null, 2);
      } catch (e) {
        return jsonString; // å¦‚æœä¸æ˜¯æœ‰æ•ˆJSONï¼Œç›´æ¥è¿”å›åŸå­—ç¬¦ä¸²
      }
    }

    // å‘½ä»¤å“åº”ç®¡ç†
    // å“åº”å†å²æœ¬åœ°å­˜å‚¨é…ç½®
    const RESPONSE_HISTORY_STORAGE_KEY = 'zcamResponseHistory';
    const MAX_RESPONSE_HISTORY = 20; // å¯ä¿®æ”¹ä¸Šé™

    let commandResponses = [];

    // ä¿å­˜å“åº”å†å²åˆ°æœ¬åœ°å­˜å‚¨
    function saveCommandResponsesToStorage() {
      try {
        const dataToSave = commandResponses.slice(0, MAX_RESPONSE_HISTORY);
        localStorage.setItem(RESPONSE_HISTORY_STORAGE_KEY, JSON.stringify(dataToSave));
      } catch (e) {
        console.warn('Failed to save response history:', e);
      }
    }

    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å“åº”å†å²
    function loadCommandResponsesFromStorage() {
      try {
        const raw = localStorage.getItem(RESPONSE_HISTORY_STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (e) {
        console.warn('Failed to load response history:', e);
        return [];
      }
    }

    // æ·»åŠ å‘½ä»¤å“åº”
    function addCommandResponse(commandName, url, responseText, isSuccess, timestamp) {
      const responseItem = {
        commandName,
        url,
        responseText,
        isSuccess,
        timestamp
      };

      commandResponses.unshift(responseItem); // æ·»åŠ åˆ°å¼€å¤´

      // é™åˆ¶å†å²æ•°é‡ï¼ˆä½¿ç”¨å¯é…ç½®ä¸Šé™ï¼‰
      if (commandResponses.length > MAX_RESPONSE_HISTORY) {
        commandResponses = commandResponses.slice(0, MAX_RESPONSE_HISTORY);
      }

      // æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨
      saveCommandResponsesToStorage();

      renderCommandResponses();
    }

    // æ¸²æŸ“å‘½ä»¤å“åº”
    function renderCommandResponses() {
      if (commandResponses.length === 0) {
        responseContent.innerHTML = `<div class="no-response">${t('ui_no_response')}</div>`;
        return;
      }

      responseContent.innerHTML = '';

      commandResponses.forEach((item, index) => {
        const responseItem = document.createElement('div');
        responseItem.className = `response-item ${item.isSuccess ? 'response-success' : 'response-error'}`;

        // æ ¼å¼åŒ–å“åº”å†…å®¹
        let formattedResponse = item.responseText;

        // å°è¯•æ£€æµ‹å¹¶æ ¼å¼åŒ–JSONå†…å®¹
        if (item.responseText.includes('{') || item.responseText.includes('[')) {
          try {
            // ç§»é™¤å¯èƒ½çš„é”™è¯¯å‰ç¼€ï¼ˆå¦‚ âŒ HTTPé”™è¯¯:ï¼‰
            let cleanText = item.responseText;
            if (cleanText.includes('âŒ')) {
              // æ‰¾åˆ°ç¬¬ä¸€ä¸ª { æˆ– [ çš„ä½ç½®
              const jsonStart = cleanText.search(/[{\[]/);
              if (jsonStart !== -1) {
                const jsonPart = cleanText.substring(jsonStart);
                try {
                  const parsed = JSON.parse(jsonPart);
                  formattedResponse = cleanText.substring(0, jsonStart) + '\n' + JSON.stringify(parsed, null, 2);
                } catch (e) {
                  // å¦‚æœJSONéƒ¨åˆ†è§£æå¤±è´¥ï¼Œä¿æŒåŸæ ·
                }
              }
            } else {
              // å°è¯•ç›´æ¥è§£æä¸ºJSON
              const parsed = JSON.parse(item.responseText);
              formattedResponse = JSON.stringify(parsed, null, 2);
            }
          } catch (e) {
            // å¦‚æœä¸æ˜¯æœ‰æ•ˆJSONï¼Œä¿æŒåŸæ–‡æœ¬
          }
        }

        responseItem.innerHTML = `
           <div class="response-item-header">
             <span class="response-command-name">${item.commandName}</span>
             <span class="response-timestamp">${item.timestamp}</span>
           </div>
           <div class="response-url">
             <span class="response-url-text">${item.url}</span>
             <button class="response-copy-url-btn" onclick="copyToClipboard('${item.url}')" title="${t('ui_copy_url_tooltip')}">ğŸ“‹</button>
           </div>
           <div class="response-data"><pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word;">${formattedResponse}</pre></div>
         `;

        responseContent.appendChild(responseItem);
      });

      // è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°å“åº”
      responseContent.scrollTop = 0;
    }



    // é¡µé¢åˆå§‹åŒ–æ—¶åŠ è½½å¹¶æ˜¾ç¤ºå·²ä¿å­˜çš„å“åº”å†å²
    const __initialResponses = loadCommandResponsesFromStorage();
    if (Array.isArray(__initialResponses) && __initialResponses.length > 0) {
      commandResponses = __initialResponses.slice(0, MAX_RESPONSE_HISTORY);
      renderCommandResponses();
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯å±é™©å‘½ä»¤
    function isDangerousCommand(commandName) {
      const dangerousCommands = [
      'reboot', 'shutdown', 
      'clear setting',  // æ¸…é™¤ç›¸æœºè®¾ç½®ï¼ˆæ³¨æ„ï¼šå‘½ä»¤keyæ˜¯å•æ•°"setting"ï¼‰
      'stop record', 
      'format storage card', 
      'format to fat32', 
      'format to exfat',
      'delete file in card'
      ];
      const commandNameLower = commandName.toLowerCase();
      
      // æ£€æŸ¥commandNameæ˜¯å¦åŒ…å«ä»»ä½•å±é™©å‘½ä»¤çš„key
      return dangerousCommands.some(dangerousKey => 
        commandNameLower.includes(dangerousKey.toLowerCase())
      );
    }

    // æ˜¾ç¤ºå±é™©å‘½ä»¤ç¡®è®¤å¯¹è¯æ¡†ï¼ˆæ”¯æŒå¤šIPæ¨¡å¼ï¼‰
    function showDangerousCommandConfirm(commandName, url, ipList, callback) {
      // ä½¿ç”¨åŸç”Ÿconfirmå¯¹è¯æ¡†
      let message = `${t('ui_msg_warning_command')}\n\n${t('ui_msg_warning_command_desc')}\n${commandName}`;
      if (ipList && ipList.length > 1) {
        message += `\n\n${t('ui_msg_warning_command_multi_camera').replace('{count}', ipList.length)}`;
      }
      message += `\n\n${t('ui_msg_warning_command_confirm')}`;
      
      const confirmed = confirm(message);
      callback(confirmed);
    }

    // å¤šIPæ‰§è¡Œå‡½æ•°
    async function executeCommandMultiIP(urlTemplate, commandName, ipList) {
      const timeout = HTTP_REQUEST_TIMEOUT;
      const results = [];

      // ä¸ºæ¯ä¸ªIPåˆ›å»ºè¯·æ±‚Promise
      const promises = ipList.map(async (ip) => {
        const url = replaceIPInURL(urlTemplate, ip);
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), timeout);

        try {
          const response = await fetch(url, {
            signal: controller.signal
          });

          clearTimeout(timeoutId);
          const contentType = response.headers.get('content-type');
          let responseText = await response.text();
          let isSuccess = true;

          // å°è¯•è§£æJSONå¹¶æ£€æŸ¥codeå€¼
          if (contentType && contentType.includes('application/json')) {
            try {
              const jsonObj = JSON.parse(responseText);
              if (jsonObj.code !== undefined && jsonObj.code !== 0) {
                isSuccess = false;
              }
              responseText = formatJSON(responseText);
            } catch (e) {
              // JSONè§£æå¤±è´¥ï¼Œä¿æŒåŸæ–‡æœ¬
            }
          }

          if (!response.ok) {
            isSuccess = false;
            responseText = `${t('ui_error_http')}${response.status} ${response.statusText}`;
          }

          return {
            ip,
            url,
            responseText,
            isSuccess,
            error: null
          };
        } catch (error) {
          clearTimeout(timeoutId);
          let errorText = '';
          if (error.name === 'AbortError') {
            errorText = `${t('ui_error_timeout')}${timeout / 1000}${t('ui_error_timeout_suffix')}`;
          } else {
            errorText = `${t('ui_error_network')}${error.message}`;
          }

          return {
            ip,
            url,
            responseText: errorText,
            isSuccess: false,
            error: error
          };
        }
      });

      // ä½¿ç”¨Promise.allSettledç¡®ä¿æ‰€æœ‰è¯·æ±‚éƒ½å®Œæˆ
      const settledResults = await Promise.allSettled(promises);
      
      // å¤„ç†ç»“æœ
      settledResults.forEach((result, index) => {
        if (result.status === 'fulfilled') {
          results.push(result.value);
        } else {
          // å¦‚æœPromiseè¢«æ‹’ç»ï¼Œåˆ›å»ºä¸€ä¸ªé”™è¯¯ç»“æœ
          results.push({
            ip: ipList[index],
            url: replaceIPInURL(urlTemplate, ipList[index]),
            responseText: `${t('ui_error_network')}${result.reason?.message || 'Unknown error'}`,
            isSuccess: false,
            error: result.reason
          });
        }
      });

      return results;
    }

    // æ·»åŠ å¤šIPå‘½ä»¤å“åº”
    function addCommandResponseMultiIP(commandName, ipList, results) {
      const timestamp = new Date().toLocaleString(getTimestampLocale());
      
      // ç»Ÿè®¡æˆåŠŸå’Œå¤±è´¥æ•°é‡
      const successCount = results.filter(r => r.isSuccess).length;
      const failCount = results.length - successCount;
      const totalCount = results.length;

      // åˆ›å»ºæ±‡æ€»å“åº”é¡¹
      const summaryItem = document.createElement('div');
      summaryItem.className = 'response-item response-summary';
      summaryItem.innerHTML = `
        <div class="response-summary-header">
          <div>
            <span class="response-command-name">${commandName}</span>
            <span class="response-timestamp">${timestamp}</span>
          </div>
          <div class="response-summary-stats">
            <span class="response-summary-stat">æ€»è®¡: ${totalCount}</span>
            <span class="response-summary-stat success">æˆåŠŸ: ${successCount}</span>
            <span class="response-summary-stat error">å¤±è´¥: ${failCount}</span>
            <span class="response-summary-expand">â–¶</span>
          </div>
        </div>
        <div class="response-details">
          ${results.map(result => {
            const statusClass = result.isSuccess ? 'success' : 'error';
            const statusText = result.isSuccess ? 'æˆåŠŸ' : 'å¤±è´¥';
            return `
              <div class="response-detail-item ${statusClass}">
                <div class="response-detail-item-header">
                  <span class="response-detail-ip">${result.ip}</span>
                  <span class="response-detail-status ${statusClass}">${statusText}</span>
                </div>
                <div class="response-url">
                  <span class="response-url-text">${result.url}</span>
                  <button class="response-copy-url-btn" onclick="copyToClipboard('${result.url.replace(/'/g, "\\'")}')" title="${t('ui_copy_url_tooltip')}">ğŸ“‹</button>
                </div>
                <div class="response-data"><pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word;">${result.responseText.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre></div>
              </div>
            `;
          }).join('')}
        </div>
      `;

      // æ·»åŠ å±•å¼€/æ”¶èµ·åŠŸèƒ½
      summaryItem.addEventListener('click', (e) => {
        // å¦‚æœç‚¹å‡»çš„æ˜¯å¤åˆ¶æŒ‰é’®ï¼Œä¸è§¦å‘å±•å¼€/æ”¶èµ·
        if (e.target.closest('.response-copy-url-btn')) {
          return;
        }
        summaryItem.classList.toggle('expanded');
      });

      // æ·»åŠ åˆ°å“åº”é¢æ¿å¼€å¤´
      responseContent.insertBefore(summaryItem, responseContent.firstChild);
      responseContent.scrollTop = 0;
    }

    // æ‰§è¡ŒHTTPè¯·æ±‚å¹¶æ˜¾ç¤ºå“åº”ï¼ˆæ”¯æŒå•IPå’Œå¤šIPæ¨¡å¼ï¼‰
    async function executeCommand(url, commandName) {
      const mode = getCurrentIPMode();
      const ipList = parseIPList();

      // å¦‚æœæ˜¯å•IPæ¨¡å¼æˆ–åªæœ‰ä¸€ä¸ªIPï¼Œä½¿ç”¨åŸæœ‰é€»è¾‘
      if (mode === 'single' || ipList.length === 1) {
        // æ£€æŸ¥æ˜¯å¦æ˜¯å±é™©å‘½ä»¤
        if (isDangerousCommand(commandName)) {
          showDangerousCommandConfirm(commandName, url, ipList, (confirmed) => {
            if (confirmed) {
              // ç”¨æˆ·ç¡®è®¤åæ‰§è¡Œå‘½ä»¤
              executeCommandInternal(url, commandName);
            }
          });
          return;
        }

        // ç›´æ¥æ‰§è¡Œå‘½ä»¤
        executeCommandInternal(url, commandName);
        return;
      }

      // å¤šIPæ¨¡å¼
      if (ipList.length === 0) {
        alert(t('ui_error_no_valid_ip'));
        return;
      }

      // ä»URLä¸­æå–ç›¸å¯¹è·¯å¾„ä½œä¸ºæ¨¡æ¿
      let urlTemplate = url;
      if (url.startsWith('http://') || url.startsWith('https://')) {
        // æå–ç›¸å¯¹è·¯å¾„éƒ¨åˆ†
        const urlObj = new URL(url);
        urlTemplate = urlObj.pathname + urlObj.search;
      }

      // æ£€æŸ¥æ˜¯å¦æ˜¯å±é™©å‘½ä»¤
      if (isDangerousCommand(commandName)) {
        showDangerousCommandConfirm(commandName, url, ipList, (confirmed) => {
          if (confirmed) {
            // ç”¨æˆ·ç¡®è®¤åæ‰§è¡Œå¤šIPå‘½ä»¤
            executeCommandMultiIPInternal(urlTemplate, commandName, ipList);
          }
        });
        return;
      }

      // ç›´æ¥æ‰§è¡Œå¤šIPå‘½ä»¤
      executeCommandMultiIPInternal(urlTemplate, commandName, ipList);
    }

    // å¤šIPæ‰§è¡Œå†…éƒ¨å‡½æ•°
    async function executeCommandMultiIPInternal(urlTemplate, commandName, ipList) {
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      const loadingItem = document.createElement('div');
      loadingItem.className = 'response-item response-loading';
      loadingItem.innerHTML = `
        <div class="response-item-header">
          <span class="response-command-name">${commandName}</span>
          <span class="response-timestamp">${t('ui_btn_executing')}</span>
        </div>
        <div class="response-url">
          <span class="response-url-text">${t('ui_msg_executing_multi_ip').replace('{count}', ipList.length)}</span>
        </div>
        <div class="response-data">
          <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
            ğŸ”„ ${t('ui_msg_executing')} ${t('ui_msg_executing_multi_camera').replace('{count}', ipList.length)}
          </div>
        </div>
      `;

      responseContent.insertBefore(loadingItem, responseContent.firstChild);
      responseContent.scrollTop = 0;

      try {
        // æ‰§è¡Œå¤šIPå‘½ä»¤
        const results = await executeCommandMultiIP(urlTemplate, commandName, ipList);

        // ç§»é™¤åŠ è½½é¡¹
        if (loadingItem.parentNode) {
          responseContent.removeChild(loadingItem);
        }

        // æ·»åŠ æ±‡æ€»å“åº”
        addCommandResponseMultiIP(commandName, ipList, results);
      } catch (error) {
        // ç§»é™¤åŠ è½½é¡¹
        if (loadingItem.parentNode) {
          responseContent.removeChild(loadingItem);
        }

        // æ·»åŠ é”™è¯¯å“åº”
        const timestamp = new Date().toLocaleString(getTimestampLocale());
        addCommandResponse(commandName, urlTemplate, `${t('ui_error_network')}${error.message}`, false, timestamp);
      }
    }

    // å†…éƒ¨æ‰§è¡Œå‘½ä»¤å‡½æ•°
    async function executeCommandInternal(url, commandName) {
      // ä½¿ç”¨å…¨å±€é…ç½®çš„è¶…æ—¶æ—¶é—´
      const timeout = HTTP_REQUEST_TIMEOUT;
      let loadingItem = null;
      let timeoutId = null;

      try {
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        loadingItem = document.createElement('div');
        loadingItem.className = 'response-item response-loading';
        loadingItem.innerHTML = `
            <div class="response-item-header">
              <span class="response-command-name">${commandName}</span>
              <span class="response-timestamp">${t('ui_btn_executing')}</span>
            </div>
            <div class="response-url">
              <span class="response-url-text">${url}</span>
              <button class="response-copy-url-btn" onclick="copyToClipboard('${url}')" title="${t('ui_copy_url_tooltip')}">ğŸ“‹</button>
            </div>
            <div class="response-data">
              <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                ğŸ”„ ${t('ui_msg_executing')}
              </div>
            </div>
          `;

        // å°†åŠ è½½é¡¹æ·»åŠ åˆ°å¼€å¤´
        responseContent.insertBefore(loadingItem, responseContent.firstChild);
        responseContent.scrollTop = 0;

        // åˆ›å»ºå¸¦è¶…æ—¶çš„fetchè¯·æ±‚
        const controller = new AbortController();
        timeoutId = setTimeout(() => controller.abort(), timeout);

        // æ‰§è¡ŒHTTPè¯·æ±‚
        const response = await fetch(url, {
          signal: controller.signal
        });

        clearTimeout(timeoutId); // æ¸…é™¤è¶…æ—¶å®šæ—¶å™¨
        const contentType = response.headers.get('content-type');

        if (response.ok) {
          let responseText = await response.text();
          let isSuccess = true;

          // å°è¯•è§£æJSONå¹¶æ£€æŸ¥codeå€¼
          if (contentType && contentType.includes('application/json')) {
            try {
              const jsonObj = JSON.parse(responseText);
              if (jsonObj.code !== undefined && jsonObj.code !== 0) {
                isSuccess = false;
              }
              responseText = formatJSON(responseText);
            } catch (e) {
              // JSONè§£æå¤±è´¥ï¼Œä¿æŒåŸæ–‡æœ¬
            }
          }

          // ç§»é™¤åŠ è½½é¡¹ï¼Œæ·»åŠ å®é™…å“åº”
          responseContent.removeChild(loadingItem);
          const timestamp = new Date().toLocaleString(getTimestampLocale());
          addCommandResponse(commandName, url, responseText, isSuccess, timestamp);
        } else {
          const errorText = `${t('ui_error_http')}${response.status} ${response.statusText}`;

          // ç§»é™¤åŠ è½½é¡¹ï¼Œæ·»åŠ é”™è¯¯å“åº”
          responseContent.removeChild(loadingItem);
          const timestamp = new Date().toLocaleString(getTimestampLocale());
          addCommandResponse(commandName, url, errorText, false, timestamp);
        }
      } catch (error) {
        let errorText = '';

        // æ£€æŸ¥æ˜¯å¦æ˜¯è¶…æ—¶é”™è¯¯
        if (error.name === 'AbortError') {
          errorText = `${t('ui_error_timeout')}${timeout / 1000}${t('ui_error_timeout_suffix')}`;
        } else {
          errorText = `${t('ui_error_network')}${error.message}`;
        }

        // æ¸…ç†è¶…æ—¶å®šæ—¶å™¨
        if (timeoutId) {
          clearTimeout(timeoutId);
        }

        // ç§»é™¤åŠ è½½é¡¹ï¼Œæ·»åŠ é”™è¯¯å“åº”
        if (loadingItem && loadingItem.parentNode) {
          responseContent.removeChild(loadingItem);
        }
        const timestamp = new Date().toLocaleString(getTimestampLocale());
        addCommandResponse(commandName, url, errorText, false, timestamp);
      } finally {
        // ç¡®ä¿æ¸…ç†è¶…æ—¶å®šæ—¶å™¨
        if (timeoutId) {
          clearTimeout(timeoutId);
        }
      }
    }

    // æœç´¢åŠŸèƒ½ - åŒæ—¶æœç´¢å‘½ä»¤çš„keyã€descriptionå’Œurlï¼Œæ”¯æŒå¤šè¯­è¨€æè¿°æœç´¢
    function searchCommands(query) {
      query = query.toLowerCase();
      const currentIP = getCurrentIP();

      // é¦–å…ˆå°è¯•å¸¸è§„æœç´¢ï¼ˆkeyã€å½“å‰è¯­è¨€çš„descriptionå’Œurlï¼‰
      let results = commands.filter(c => {
        // æ£€æŸ¥keyå’Œdescription
        const keyMatch = c.key.toLowerCase().includes(query);
        const descMatch = c.description && c.description.toLowerCase().includes(query);
        
        // æ£€æŸ¥åŸå§‹urlï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
        const urlMatch = c.url.toLowerCase().includes(query);
        
        // æ£€æŸ¥å®Œæ•´URLï¼ˆåŒ…å«IPåœ°å€ï¼‰
        const fullURL = replaceIPInURL(c.url, currentIP);
        const fullURLMatch = fullURL.toLowerCase().includes(query);
        
        return keyMatch || descMatch || urlMatch || fullURLMatch;
      });

      // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç»“æœï¼Œå°è¯•é€šè¿‡å¤šè¯­è¨€æè¿°æœç´¢
      if (results.length === 0 && typeof searchWithDescription === 'function') {
        const descriptionResults = searchWithDescription(query);
        if (descriptionResults.length > 0) {
          // å°†å¤šè¯­è¨€æœç´¢ç»“æœè½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
          results = descriptionResults.map(cmd => ({
            ...cmd,
            // ä½¿ç”¨åŒ¹é…åˆ°çš„æè¿°ä½œä¸ºæ˜¾ç¤ºæè¿°
            displayDescription: cmd.matchedDescription || cmd.description
          }));
        }
      }

      // ä¸ºæ‰€æœ‰ç»“æœæ·»åŠ åŠ¨æ€URL
      return results.map(cmd => ({
        ...cmd,
        url: replaceIPInURL(cmd.url, currentIP)
      }));
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        // åˆ›å»ºä¸´æ—¶æç¤º
        const toast = document.createElement('div');
        toast.textContent = t('ui_msg_copied');
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: var(--success-color);
          color: #000;
          padding: 12px 20px;
          border-radius: 6px;
          font-weight: 500;
          z-index: 1000;
          animation: slideIn 0.3s ease;
        `;
        document.body.appendChild(toast);

        setTimeout(() => {
          toast.remove();
        }, 2000);
      }).catch(err => {
        alert(`${t('ui_msg_copy_failed')}${err}`);
      });
    }

    function showResults(list) {
      results.innerHTML = "";

      if (list.length === 0) {
        results.innerHTML = `<div class="no-results">${t('ui_msg_no_results')}</div>`;
        return;
      }

      list.forEach(cmd => {
        const li = document.createElement("li");

        // å‘½ä»¤å†…å®¹åŒºåŸŸ - 2è¡Œæ˜¾ç¤º
        const commandContent = document.createElement("div");
        commandContent.className = "command-content";
        
        // ç¬¬ä¸€è¡Œï¼šå‘½ä»¤æè¿°
        const description = document.createElement("div");
        description.className = "command-description";
        // å¦‚æœæœ‰åŒ¹é…åˆ°çš„å¤šè¯­è¨€æè¿°ï¼Œä¼˜å…ˆæ˜¾ç¤ºå®ƒ
        const displayDescription = cmd.displayDescription || cmd.description || cmd.key;
        description.textContent = displayDescription;
        
        // ç¬¬äºŒè¡Œï¼šå‘½ä»¤è·¯å¾„ï¼ˆå¦‚æœå¤ªé•¿ä¼šæ˜¾ç¤º...ï¼‰
        const url = document.createElement("div");
        url.className = "command-url";
        url.textContent = cmd.url;
        url.title = cmd.url; // å®Œæ•´URLä½œä¸ºtooltip
        
        commandContent.appendChild(description);
        commandContent.appendChild(url);
        
        // ç‚¹å‡»å‘½ä»¤å†…å®¹å°†URLå¡«å…¥æœç´¢æ¡†
        // ä½¿ç”¨ mousedown äº‹ä»¶ï¼Œå› ä¸ºå®ƒåœ¨ blur äº‹ä»¶ä¹‹å‰è§¦å‘ï¼Œå¯ä»¥é¿å…è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶æ¸…ç©ºç»“æœåˆ—è¡¨
        commandContent.onmousedown = (e) => {
          // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹
          e.preventDefault();
          
          // å°†å®Œæ•´URLå¡«å…¥æœç´¢æ¡†
          input.value = cmd.url;

          // Select all URL text, like browser address bar
          input.select();

          // æ¸…ç©ºæœç´¢ç»“æœ
          results.innerHTML = "";

          // å°†å®Œæ•´URLæ·»åŠ åˆ°å†å²è®°å½•
          addSearchHistory(cmd.url);
          
          // æ›´æ–°æ‰§è¡ŒæŒ‰é’®çŠ¶æ€
          updateExecuteButtonState();
          
          // ä¿æŒè¾“å…¥æ¡†ç„¦ç‚¹
          input.focus();
        };

        // å¤åˆ¶æŒ‰é’® - å›¾æ ‡æ ·å¼
        const copyBtn = document.createElement("button");
        copyBtn.innerHTML = "ğŸ“‹"; // ä½¿ç”¨å¤åˆ¶å›¾æ ‡
        copyBtn.className = "copy-btn-icon";
        copyBtn.title = t('ui_btn_copy'); // tooltipæç¤º
        copyBtn.onclick = (e) => {
          e.stopPropagation();
          copyToClipboard(cmd.url);
        };

        li.appendChild(commandContent);
        li.appendChild(copyBtn);
        results.appendChild(li);
      });
    }

    // æ¸…ç©ºå“åº”æŒ‰é’®äº‹ä»¶
    clearResponseBtn.addEventListener("click", () => {
      commandResponses = [];
      responseContent.innerHTML = `<div class="no-response">${t('ui_no_response')}</div>`;
      // æ¸…ç©ºæœ¬åœ°å­˜å‚¨çš„å“åº”å†å²
      localStorage.removeItem(RESPONSE_HISTORY_STORAGE_KEY);
    });



    // IPæ¨¡å¼åˆ‡æ¢äº‹ä»¶ - æ ‡ç­¾é¡µç‚¹å‡»
    ipModeTabs.forEach(tab => {
      tab.addEventListener('click', (e) => {
        const mode = tab.getAttribute('data-mode');
        
        // æ›´æ–°æ ‡ç­¾é¡µactiveçŠ¶æ€
        ipModeTabs.forEach(t => {
          if (t === tab) {
            t.classList.add('active');
          } else {
            t.classList.remove('active');
          }
        });
        
        // åˆ‡æ¢æ¨¡å¼ï¼ˆå†…éƒ¨ä¼šä¿å­˜å½“å‰æ¨¡å¼å¹¶åŠ è½½æ–°æ¨¡å¼çš„å€¼ï¼‰
        switchIPMode(mode);
        
        // é‡æ–°æ¸²æŸ“å¸¸ç”¨å‘½ä»¤æŒ‰é’®
        renderFavorites();
        
        // å¦‚æœå½“å‰æœ‰æœç´¢ç»“æœï¼Œä¹Ÿé‡æ–°æ˜¾ç¤º
        const query = input.value.trim();
        if (query !== "") {
          showResults(searchCommands(query));
        }

        // å¦‚æœå†å²è®°å½•é¢æ¿æ­£åœ¨æ˜¾ç¤ºï¼Œé‡æ–°æ˜¾ç¤ºä»¥æ›´æ–°URL
        const historyContainer = document.querySelector('.search-history-container');
        if (historyContainer) {
          showSearchHistory();
        }
      });
    });

    // IPåœ°å€å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“å¸¸ç”¨å‘½ä»¤æŒ‰é’®ï¼ˆæ”¯æŒä¸‰ç§æ¨¡å¼ï¼‰
    function handleIPInputChange() {
      // ä¿å­˜IPåœ°å€åˆ°æœ¬åœ°å­˜å‚¨
      saveIPToStorage();

      renderFavorites();
      // å¦‚æœå½“å‰æœ‰æœç´¢ç»“æœï¼Œä¹Ÿé‡æ–°æ˜¾ç¤º
      const query = input.value.trim();
      if (query !== "") {
        showResults(searchCommands(query));
      }

      // å¦‚æœå†å²è®°å½•é¢æ¿æ­£åœ¨æ˜¾ç¤ºï¼Œé‡æ–°æ˜¾ç¤ºä»¥æ›´æ–°URL
      const historyContainer = document.querySelector('.search-history-container');
      if (historyContainer) {
        showSearchHistory();
      }
    }

    // ä¸ºæ‰€æœ‰IPè¾“å…¥æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬
    if (ipInputSingle) {
      ipInputSingle.addEventListener("input", handleIPInputChange);
    }
    if (ipInputStart) {
      ipInputStart.addEventListener("input", handleIPInputChange);
    }
    if (ipInputEnd) {
      ipInputEnd.addEventListener("input", handleIPInputChange);
      
      // ç»“æŸIPè¾“å…¥æ¡†çš„å¢å‡æ§åˆ¶æŒ‰é’®äº‹ä»¶
      const ipEndIncrease = document.getElementById('ip-end-increase');
      const ipEndDecrease = document.getElementById('ip-end-decrease');
      
      if (ipEndIncrease) {
        ipEndIncrease.addEventListener('click', (e) => {
          e.preventDefault();
          const currentValue = parseInt(ipInputEnd.value, 10) || 200;
          const maxValue = parseInt(ipInputEnd.max, 10) || 255;
          if (currentValue < maxValue) {
            ipInputEnd.value = currentValue + 1;
            handleIPInputChange();
          }
        });
      }
      
      if (ipEndDecrease) {
        ipEndDecrease.addEventListener('click', (e) => {
          e.preventDefault();
          const currentValue = parseInt(ipInputEnd.value, 10) || 200;
          const minValue = parseInt(ipInputEnd.min, 10) || 1;
          if (currentValue > minValue) {
            ipInputEnd.value = currentValue - 1;
            handleIPInputChange();
          }
        });
      }
    }
    if (ipInputDiscrete) {
      ipInputDiscrete.addEventListener("input", handleIPInputChange);
    }

    // å…¨å±€ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ï¼Œç”¨äºå…³é—­å‘½ä»¤åˆ—è¡¨ï¼ˆå½“ç‚¹å‡»å¤–éƒ¨æ—¶ï¼‰
    let resultsClickHandler = null;
    
    function setupResultsClickOutsideHandler() {
      // ç§»é™¤æ—§çš„ç›‘å¬å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      if (resultsClickHandler) {
        document.removeEventListener('click', resultsClickHandler);
        resultsClickHandler = null;
      }
      
      // æ·»åŠ æ–°çš„ç‚¹å‡»ç›‘å¬å™¨
      resultsClickHandler = (event) => {
        const resultsContainer = document.querySelector('.results-container');
        
        // åªè¦å‘½ä»¤åˆ—è¡¨æœ‰å†…å®¹ï¼Œå°±æ£€æŸ¥ç‚¹å‡»ä½ç½®ï¼ˆé€‚ç”¨äºæ‰€æœ‰æƒ…å†µï¼š?ã€å…³é”®å­—æœç´¢ç­‰ï¼‰
        if (resultsContainer && results.children.length > 0) {
          const isClickInsideResults = resultsContainer.contains(event.target) ||
                                       event.target === input ||
                                       input.contains(event.target) ||
                                       event.target.closest('.search-input-group');
          
          // å¦‚æœç‚¹å‡»ä¸åœ¨å‘½ä»¤åˆ—è¡¨å†…ï¼Œä¸”ä¸åœ¨è¾“å…¥æ¡†ç»„å†…ï¼Œåˆ™æ¸…ç©ºå‘½ä»¤åˆ—è¡¨
          if (!isClickInsideResults) {
            results.innerHTML = "";
            // ç§»é™¤ç›‘å¬å™¨
            document.removeEventListener('click', resultsClickHandler);
            resultsClickHandler = null;
          }
        }
      };
      
      // å»¶è¿Ÿæ·»åŠ ç›‘å¬å™¨ï¼Œç¡®ä¿å½“å‰ç‚¹å‡»äº‹ä»¶å…ˆå¤„ç†
      setTimeout(() => {
        document.addEventListener('click', resultsClickHandler);
      }, 0);
    }

    // æ›´æ–°æ‰§è¡ŒæŒ‰é’®çŠ¶æ€ï¼ˆæ ¹æ®è¾“å…¥æ¡†å†…å®¹ï¼‰
    function updateExecuteButtonState() {
      const executeBtn = document.getElementById('btn-execute-command');
      if (executeBtn) {
        const query = input.value.trim();
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆçš„å®Œæ•´å‘½ä»¤
        let isValidCommand = false;
        
        if (query !== "") {
          // å¿…é¡»æ˜¯å®Œæ•´çš„URLæ ¼å¼ï¼ˆhttp:// æˆ– https:// å¼€å¤´ï¼‰
          if (query.startsWith('http://') || query.startsWith('https://')) {
            // æ£€æŸ¥æ˜¯å¦åŒ…å«æœªå¡«å†™çš„å‚æ•°ï¼ˆ$ å¼€å¤´çš„å‚æ•°å ä½ç¬¦ï¼‰
            const hasUnfilledParams = /\$([^/&?]+)/.test(query);
            if (!hasUnfilledParams) {
              isValidCommand = true;
            }
          }
        }
        
        executeBtn.disabled = !isValidCommand; // åªæœ‰æœ‰æ•ˆçš„å®Œæ•´å‘½ä»¤æ‰å¯ç”¨æŒ‰é’®
      }
    }

    // æœç´¢æ¡†è¾“å…¥äº‹ä»¶
    input.addEventListener("input", () => {
      const query = input.value.trim();
      
      // æ›´æ–°æ‰§è¡ŒæŒ‰é’®çŠ¶æ€
      updateExecuteButtonState();
      
      if (query === "") {
        results.innerHTML = "";
        // ç§»é™¤å‘½ä»¤åˆ—è¡¨çš„ç‚¹å‡»å¤–éƒ¨å…³é—­ç›‘å¬å™¨
        if (resultsClickHandler) {
          document.removeEventListener('click', resultsClickHandler);
          resultsClickHandler = null;
        }
        // å½“è¾“å…¥æ¡†ä¸ºç©ºæ—¶ï¼Œæ˜¾ç¤ºå†å²è®°å½•
        showSearchHistory();
      } else if (query === "?" || query === "ï¼Ÿ") {
        // å½“è¾“å…¥é—®å·æ—¶ï¼Œæ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤ï¼ˆæ”¯æŒä¸­è‹±æ–‡é—®å·ï¼‰
        showResults(commands.map(cmd => ({
          ...cmd,
          url: replaceIPInURL(cmd.url, getCurrentIP())
        })));
        hideSearchHistory(); // éšè—å†å²è®°å½•
        // è®¾ç½®ç‚¹å‡»å¤–éƒ¨å…³é—­å‘½ä»¤åˆ—è¡¨çš„ç›‘å¬å™¨
        setupResultsClickOutsideHandler();
      } else {
        showResults(searchCommands(query));
        hideSearchHistory(); // éšè—å†å²è®°å½•
        // è®¾ç½®ç‚¹å‡»å¤–éƒ¨å…³é—­å‘½ä»¤åˆ—è¡¨çš„ç›‘å¬å™¨ï¼ˆå…³é”®å­—æœç´¢æ—¶ä¹Ÿéœ€è¦ï¼‰
        setupResultsClickOutsideHandler();
      }
    });

    // æœç´¢æ¡†å¤±å»ç„¦ç‚¹æ—¶ï¼Œå¦‚æœæ˜¯å®Œæ•´URLåˆ™æ·»åŠ åˆ°å†å²è®°å½•
    input.addEventListener("blur", () => {
      const query = input.value.trim();
      if (query !== "" && query !== "?" && query !== "ï¼Ÿ" &&
        (query.startsWith('http://') || query.startsWith('https://'))) {
        addSearchHistory(query);
      }

      // å»¶è¿Ÿéšè—å‘½ä»¤åˆ—è¡¨ï¼Œè®©ç‚¹å‡»äº‹ä»¶å…ˆè§¦å‘ï¼ˆmousedown äº‹ä»¶åœ¨ blur ä¹‹å‰è§¦å‘ï¼‰
      // å¦‚æœå‘½ä»¤åˆ—è¡¨æœ‰å†…å®¹ï¼Œå»¶è¿Ÿéšè—å‘½ä»¤åˆ—è¡¨ï¼ˆé€‚ç”¨äºæ‰€æœ‰æƒ…å†µï¼š?ã€å…³é”®å­—æœç´¢ç­‰ï¼‰
      if (results.children.length > 0) {
        setTimeout(() => {
          // å†æ¬¡æ£€æŸ¥ï¼Œé¿å…åœ¨ç‚¹å‡»äº‹ä»¶æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«æ¸…ç©º
          if (results.children.length > 0) {
            results.innerHTML = "";
            // ç§»é™¤ç‚¹å‡»å¤–éƒ¨å…³é—­å‘½ä»¤åˆ—è¡¨çš„ç›‘å¬å™¨
            if (resultsClickHandler) {
              document.removeEventListener('click', resultsClickHandler);
              resultsClickHandler = null;
            }
          }
        }, 100);
      }

      // å»¶è¿Ÿéšè—å†å²è®°å½•ï¼Œè®©ç‚¹å‡»äº‹ä»¶å…ˆè§¦å‘
      // å¢åŠ å»¶è¿Ÿæ—¶é—´ï¼Œç¡®ä¿ç‚¹å‡»äº‹ä»¶èƒ½å¤Ÿæ­£å¸¸å¤„ç†
      setTimeout(() => {
        hideSearchHistory();
      }, 500);
    });

    // æœç´¢æ¡†è·å¾—ç„¦ç‚¹æ—¶æ˜¾ç¤ºå†å²è®°å½•æˆ–å‘½ä»¤åˆ—è¡¨
    input.addEventListener("focus", () => {
      console.log('Search input focused, current value:', input.value.trim());
      // ç¦ç”¨æµè§ˆå™¨çš„é»˜è®¤å†å²è®°å½•
      input.setAttribute('autocomplete', 'off');
      input.setAttribute('list', '');

      const query = input.value.trim();
      if (query === "") {
        console.log('Search input is empty, showing history');
        showSearchHistory();
      } else if (query === "?" || query === "ï¼Ÿ") {
        // å½“è¾“å…¥æ¡†å†…å®¹ä¸º ? æˆ– ï¼Ÿ æ—¶ï¼Œæ˜¾ç¤ºå‘½ä»¤åˆ—è¡¨
        console.log('Search input is question mark, showing command list');
        showResults(commands.map(cmd => ({
          ...cmd,
          url: replaceIPInURL(cmd.url, getCurrentIP())
        })));
        hideSearchHistory(); // éšè—å†å²è®°å½•
        // è®¾ç½®ç‚¹å‡»å¤–éƒ¨å…³é—­å‘½ä»¤åˆ—è¡¨çš„ç›‘å¬å™¨
        setupResultsClickOutsideHandler();
      } else {
        console.log('Search input has content, not showing history');
      }
    });

    // çª—å£å¤±å»ç„¦ç‚¹æ—¶ï¼ˆåˆ‡æ¢åˆ°å…¶ä»–çª—å£æˆ–æ ‡ç­¾é¡µï¼‰è‡ªåŠ¨éšè—å†å²è®°å½•å’Œå‘½ä»¤åˆ—è¡¨
    window.addEventListener("blur", () => {
      // éšè—å†å²è®°å½•
      hideSearchHistory();
      // éšè—å‘½ä»¤åˆ—è¡¨
      results.innerHTML = "";
      // ç§»é™¤ç‚¹å‡»å¤–éƒ¨å…³é—­å‘½ä»¤åˆ—è¡¨çš„ç›‘å¬å™¨
      if (resultsClickHandler) {
        document.removeEventListener('click', resultsClickHandler);
        resultsClickHandler = null;
      }
    });

    // IPåœ°å€è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶ä¿å­˜IPåœ°å€ï¼ˆæ”¯æŒä¸‰ç§æ¨¡å¼ï¼‰
    if (ipInputSingle) {
      ipInputSingle.addEventListener("blur", () => {
        saveIPToStorage();
      });
    }
    if (ipInputStart) {
      ipInputStart.addEventListener("blur", () => {
        saveIPToStorage();
      });
    }
    if (ipInputEnd) {
      ipInputEnd.addEventListener("blur", () => {
        saveIPToStorage();
      });
    }
    if (ipInputDiscrete) {
      ipInputDiscrete.addEventListener("blur", () => {
        saveIPToStorage();
      });
    }

    // æœç´¢æ¡†å¤±å»ç„¦ç‚¹æ—¶éšè—å†å²è®°å½•ï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼Œè®©ç‚¹å‡»äº‹ä»¶å…ˆè§¦å‘ï¼‰
    // æ³¨æ„ï¼šè¿™ä¸ªäº‹ä»¶ç›‘å¬å™¨å·²ç»åœ¨ä¸Šé¢åˆå¹¶åˆ°æ–°çš„bluräº‹ä»¶ä¸­äº†

    // æ£€æŸ¥URLä¸­æ˜¯å¦éœ€è¦å¡«å†™å‚æ•°
    function checkURLParameters(url) {
      // ä½¿ç”¨æ›´ç²¾ç¡®çš„æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…å‚æ•°
      // åŒ¹é… $ åé¢è·Ÿç€é /ã€&ã€? çš„å­—ç¬¦åºåˆ—
      const dollarMatches = url.match(/\$([^/&?]+)/g);
      if (dollarMatches && dollarMatches.length > 0) {
        // ä¿ç•™å®Œæ•´çš„å‚æ•°åç§°ï¼ˆåŒ…æ‹¬$ç¬¦å·ï¼‰ï¼Œç”¨æ¢è¡Œç¬¦åˆ†éš”
        const parameterList = dollarMatches.join('\n');
        
        // æ˜¾ç¤ºå¤šè¯­è¨€å‚æ•°æé†’
        alert(`${t('ui_msg_parameters_required')}\n${parameterList}\n\n${t('ui_msg_parameters_instruction')}`);
        return false; // è¿”å›falseè¡¨ç¤ºéœ€è¦å¡«å†™å‚æ•°
      }
      return true; // è¿”å›trueè¡¨ç¤ºå¯ä»¥æ‰§è¡Œ
    }

    // æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°ï¼ˆä¾›å›è½¦å’Œæ‰§è¡ŒæŒ‰é’®è°ƒç”¨ï¼‰
    function executeCommandFromInput() {
      const query = input.value.trim();

      // æ£€æŸ¥æ˜¯å¦æ˜¯URLæ ¼å¼
      if (query.startsWith('http://') || query.startsWith('https://')) {
        // æ£€æŸ¥æ˜¯å¦éœ€è¦å¡«å†™å‚æ•°
        if (checkURLParameters(query)) {
          // æ˜¯URLï¼Œæ‰§è¡Œå‘½ä»¤å¹¶æ·»åŠ åˆ°å†å²è®°å½•
          const commandName = extractCommandNameFromURL(query);
          executeCommand(query, commandName);
          addSearchHistory(query);
        }
      }
    }

    // æŒ‰å›è½¦é”®æ—¶æ‰§è¡Œå‘½ä»¤æˆ–æ·»åŠ æœç´¢å†å²
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        executeCommandFromInput();
      }
    });

    // æ‰§è¡ŒæŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿DOMå·²åŠ è½½ï¼‰
    setTimeout(() => {
      const executeBtn = document.getElementById('btn-execute-command');
      if (executeBtn) {
        // åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€ï¼ˆè¾“å…¥æ¡†ä¸ºç©ºæ—¶ç¦ç”¨ï¼‰
        updateExecuteButtonState();
        
        executeBtn.addEventListener("click", () => {
          executeCommandFromInput();
        });
      }
    }, 0);

    // å¸¸ç”¨å‘½ä»¤æŒ‰é’®ç”Ÿæˆ
    function renderFavorites() {
      // æ¸…ç©ºç°æœ‰æŒ‰é’®
      favButtons.innerHTML = "";

      favorites.forEach(favKey => {
        const cmd = commands.find(c => c.key === favKey);
        if (cmd) {
          const btn = document.createElement("button");
          btn.textContent = cmd.description;
          btn.onclick = () => {
            const currentIP = getCurrentIP();
            const dynamicURL = replaceIPInURL(cmd.url, currentIP);

            // å°†URLå¡«å…¥æœç´¢æ¡†
            input.value = dynamicURL;
            input.focus();

            // å…¨é€‰URLæ–‡æœ¬ï¼Œå°±åƒæµè§ˆå™¨åœ°å€æ é‚£æ ·
            input.select();

            // æ¸…ç©ºæœç´¢ç»“æœ
            results.innerHTML = "";

            // æ›´æ–°æ‰§è¡ŒæŒ‰é’®çŠ¶æ€
            updateExecuteButtonState();

            // æ‰§è¡Œå‘½ä»¤ï¼ˆexecuteCommandFromInput ä¼šå¤„ç†å‚æ•°æ£€æŸ¥å’Œå†å²è®°å½•æ·»åŠ ï¼‰
            executeCommandFromInput();
          };
          favButtons.appendChild(btn);
        }
      });
    }

    // ç¡®ä¿æœç´¢æ¡†ç¦ç”¨æµè§ˆå™¨é»˜è®¤å†å²è®°å½•
    input.setAttribute('autocomplete', 'off');
    input.setAttribute('list', '');

    // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œé‡æ–°è°ƒæ•´å†å²è®°å½•é¢æ¿é«˜åº¦
    window.addEventListener('resize', () => {
      const historyContainer = document.querySelector('.search-history-container');
      if (historyContainer) {
        adjustHistoryPanelHeight(historyContainer);
      }
    });

    // åº”ç”¨è¯­è¨€åˆ°é¡µé¢
    applyLanguage();

    // åˆå§‹åŒ–è¯­è¨€åˆ‡æ¢å™¨
    initLanguageSwitcher();

    // åˆå§‹åŒ–IP tooltipåŠŸèƒ½ï¼ˆå‚è€ƒmulti-camera-index.htmlçš„å®ç°ï¼‰
    function initIPTooltip() {
      // åœ¨å‡½æ•°å†…éƒ¨è·å–tooltipå®¹å™¨ï¼Œç¡®ä¿DOMå·²åŠ è½½
      const tooltipPopup = document.getElementById('ip-tooltip-popup');
      if (!tooltipPopup) {
        console.warn('Tooltip container not found');
        return;
      }
      
      // å¼ºåˆ¶æ›´æ–°tooltipæ–‡æœ¬
      const tooltipText = t('ui_ip_hint_tip');
      const tooltipElements = document.querySelectorAll('.ip-tooltip');
      console.log('Initializing tooltip, found elements:', tooltipElements.length);
      
      tooltipElements.forEach(element => {
        // å¼ºåˆ¶è®¾ç½®data-tooltip
        element.setAttribute('data-tooltip', tooltipText);
        console.log('Tooltip text set for element:', element, 'text:', tooltipText);

        // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨ï¼ˆé€šè¿‡é‡æ–°ç»‘å®šï¼‰
        const newElement = element.cloneNode(true);
        element.parentNode.replaceChild(newElement, element);

        newElement.addEventListener('mouseenter', (e) => {
          let text = newElement.getAttribute('data-tooltip');
          if (!text || text.trim() === '') {
            text = t('ui_ip_hint_tip');
            newElement.setAttribute('data-tooltip', text);
          }
          if (text && tooltipPopup) {
            tooltipPopup.textContent = text;
            tooltipPopup.classList.add('show');
            // åˆå§‹ä½ç½®è®¾ç½®
            tooltipPopup.style.left = (e.clientX + 10) + 'px';
            tooltipPopup.style.top = (e.clientY + 10) + 'px';
            console.log('Tooltip shown');
          }
        });
        
        newElement.addEventListener('mousemove', (e) => {
          if (tooltipPopup && tooltipPopup.classList.contains('show')) {
            // æ˜¾ç¤ºåœ¨é¼ æ ‡ä½ç½®çš„å³ä¸‹è§’ï¼Œåç§»10px
            const offsetX = 10;
            const offsetY = 10;
            let left = e.clientX + offsetX;
            let top = e.clientY + offsetY;
            
            // å…ˆè®¾ç½®ä½ç½®ï¼Œç„¶åæ£€æŸ¥è¾¹ç•Œ
            tooltipPopup.style.left = left + 'px';
            tooltipPopup.style.top = top + 'px';
            
            // æ£€æŸ¥æ˜¯å¦è¶…å‡ºå³è¾¹ç•Œï¼Œå¦‚æœè¶…å‡ºåˆ™æ˜¾ç¤ºåœ¨å·¦ä¾§
            const tooltipRect = tooltipPopup.getBoundingClientRect();
            if (tooltipRect.right > window.innerWidth) {
              left = e.clientX - tooltipRect.width - offsetX;
              tooltipPopup.style.left = left + 'px';
            }
            
            // æ£€æŸ¥æ˜¯å¦è¶…å‡ºä¸‹è¾¹ç•Œï¼Œå¦‚æœè¶…å‡ºåˆ™æ˜¾ç¤ºåœ¨ä¸Šæ–¹
            if (tooltipRect.bottom > window.innerHeight) {
              top = e.clientY - tooltipRect.height - offsetY;
              tooltipPopup.style.top = top + 'px';
            }
          }
        });
        
        newElement.addEventListener('mouseleave', () => {
          if (tooltipPopup) {
            tooltipPopup.classList.remove('show');
          }
        });
      });
    }

    // åˆå§‹åŒ–å‘½ä»¤æè¿°
    if (typeof initializeCommandDescriptions === 'function') {
      initializeCommandDescriptions();
      console.log('Command descriptions initialized');
    }

    console.log("Starting to render favorite buttons");
    renderFavorites();

    // åˆå§‹åŒ–IP tooltipï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿DOMå®Œå…¨åŠ è½½ï¼‰
    setTimeout(() => {
      initIPTooltip();
    }, 0);

    console.log("Page initialization completed");

    // è®¾ç½®GitHubé“¾æ¥
    const githubLink = document.getElementById('github-link');
    if (githubLink) {
      // è¿™é‡Œæ‚¨å¯ä»¥è®¾ç½®æ‚¨çš„GitHubä»“åº“åœ°å€
      githubLink.href = 'https://github.com/Jack-vexel-ws/zcamhttp';
      console.log('GitHub button initialized');
    }

    // è®¾ç½®ZCAMæ–‡æ¡£é“¾æ¥
    const zcamDocLink = document.getElementById('zcam-doc-btn');
    if (zcamDocLink) {
      // è¿™é‡Œæ‚¨å¯ä»¥è®¾ç½®ZCAMå®˜æ–¹HTTPæ–‡æ¡£åœ°å€
      zcamDocLink.href = 'https://github.com/imaginevision/Z-Camera-Doc/blob/master/E2/protocol/http/http.md';
      console.log('ZCAM Doc button initialized');
    }

    // è®¾ç½®æŒ‰é’®çš„titleä¸ºå¤šè¯­è¨€
    const githubBtn = document.getElementById('github-link');
    if (githubBtn) {
      githubBtn.title = t('ui_github_btn_title');
    }

    if (zcamDocLink) {
      zcamDocLink.title = t('ui_zcam_doc_btn_title');
    }

    // æ‰“å¼€ç›¸æœºåå°æ§åˆ¶é¡µé¢
    function openCameraAdmin() {
      const currentIP = getCurrentIP();
      const adminURL = `http://${currentIP}/www/index.html`;
      
      // åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€ç›¸æœºåå°æ§åˆ¶é¡µé¢
      window.open(adminURL, '_blank');
      
      console.log('Opening camera admin panel:', adminURL);
    }

    // å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä¾›HTML onclickäº‹ä»¶è°ƒç”¨
    window.selectHistoryItem = selectHistoryItem;
    window.removeHistoryItem = removeHistoryItem;
    window.clearSearchHistory = clearSearchHistory;
    window.openCameraAdmin = openCameraAdmin;
    window.isDangerousCommand = isDangerousCommand;
    window.showDangerousCommandConfirm = showDangerousCommandConfirm;
    window.executeCommandInternal = executeCommandInternal;
    window.saveIPToStorage = saveIPToStorage; 
    window.loadIPFromStorage = loadIPFromStorage;
  </script>
  
  <!-- IPè¾“å…¥æç¤ºtooltipå®¹å™¨ -->
  <div class="ip-tooltip-popup" id="ip-tooltip-popup"></div>
</body>

</html>